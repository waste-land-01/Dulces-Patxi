<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dulces Patxi</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#5C3B28">
  <link rel="icon" type="image/png" href="icon-192.png">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --fondo: #FCF8F3;
      --texto: #2E1A14;
      --titulo: #5C3B28;
      --bienvenida: #7D5D49;
      --byyahya: #3A7BD5;
      --categoria: #5C3B28;
      --categoria-bg: #f3e2d0;
      --cat-bold: #8B5A3E;
      --receta-list: #7D5D49;
      --receta-list-bg: #E9DCCF;
      --receta-final: #8B5A3E;
      --receta-final-bg: #FFFBE5;
      --receta-txt: #2E1A14;
      --elaboracion-txt: #2E1A14;
      --hover: #E9DCCF;
      --borde: #D4C2B3;
      --btn-bg: #8B5A3E;
      --btn-text: white;
      --calc-bg: #e9dccf;
      --calc-bold: #8B5A3E;
      --input-bg: #fff;
      --font-main: 'Segoe UI', 'Arial', sans-serif;
      --transition: all 0.3s cubic-bezier(.68,-0.55,.27,1.55);
      --nota-bg: #FFFBE5;
      --nota-txt: #5C3B28;
      --nota-border: #B8860B;
      --nota-shadow: 0 3px 24px 0 #0005;
      --byyahya-shadow: #3A7BD5;
    }
    .modo-oscuro {
      --fondo: #20150F;
      --texto: #E9DCCF;
      --titulo: #C7B299;
      --bienvenida: #E9DCCF;
      --byyahya: #69AAFF;
      --categoria: #C7B299;
      --categoria-bg: #392A1F;
      --cat-bold: #C47E43;
      --receta-list: #C7B299;
      --receta-list-bg: #2D2119;
      --receta-final: #C47E43;
      --receta-final-bg: #392A1F;
      --receta-txt: #E9DCCF;
      --elaboracion-txt: #FFD6B0;
      --hover: #4C3322;
      --borde: #C47E43;
      --btn-bg: #312015;
      --btn-text: #FFD6B0;
      --calc-bg: #2D2119;
      --calc-bold: #FFD6B0;
      --input-bg: #392A1F;
      --nota-bg: #392A1F;
      --nota-txt: #FFD6B0;
      --nota-border: #C47E43;
      --nota-shadow: 0 3px 24px 0 #0005;
      --byyahya-shadow: #69AAFF;
    }
    body {
      background-color: var(--fondo);
      color: var(--texto);
      font-family: var(--font-main);
      transition: var(--transition);
    }
    header {
      background: var(--fondo);
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
      position: sticky;
      top: 0;
      z-index: 100;
      padding: 16px 0 0 0;
      text-align: center;
      border-bottom: 1.5px solid var(--borde);
      transition: var(--transition);
    }
    .titulo-app {
      font-size: 2.2em;
      font-family: var(--font-main);
      font-weight: 900;
      color: var(--titulo);
      margin-bottom: 2px;
      letter-spacing: 0.04em;
      border-radius: 6px;
      padding: 2px 16px;
      border-bottom: 2.5px solid var(--cat-bold);
      display: inline-block;
      transition: var(--transition);
      text-shadow: 0 2px 8px #0002;
    }
    .bienvenida {
      font-size: 1.15em;
      font-family: var(--font-main);
      font-weight: 700;
      color: var(--bienvenida);
      margin-bottom: 4px;
      letter-spacing: 0.01em;
      border-radius: 6px;
      padding: 2px 14px;
      display: inline-block;
      transition: var(--transition);
      text-shadow: 0 2px 8px #0002;
    }
    .by-yahya {
      font-size: 1.13em;
      font-weight: bold;
      color: var(--byyahya);
      margin-bottom: 7px;
      letter-spacing: 0.09em;
      border-radius: 6px;
      padding: 2px 11px;
      display: inline-block;
      transition: var(--transition);
      text-shadow: 0 2px 8px var(--byyahya-shadow);
    }
    #buscador {
      width: 80%;
      margin: 10px auto 7px auto;
      display: block;
      padding: 10px;
      border: 1.5px solid var(--borde);
      border-radius: 8px;
      font-size: 1.09em;
      background: var(--input-bg);
      color: var(--texto);
      box-shadow: 0 0 4px #0002;
      font-family: var(--font-main);
    }
    #btn-buscador-inteligente {
      display:block;
      margin: 0 auto 10px auto;
      font-size: 0.8em;
      font-weight: 700;
      background: var(--cat-bold);
      color: var(--btn-text);
      border-radius: 8px;
      border: none;
      padding: 7px 12px;
      width: 27%;
      max-width: 180px;
      min-width: 80px;
      box-shadow: 0 1px 6px #00000012;
      cursor: pointer;
      transition: var(--transition);
    }
    .modo-oscuro #btn-buscador-inteligente {
      background: #312015;
      color: #FFD6B0;
    }
    .menu-filtros-inteligente {
      background: var(--categoria-bg);
      box-shadow: 0 3px 8px #0002;
      margin: 0 auto 14px auto;
      border-radius: 12px;
      padding: 13px 0;
      width: 80%;
      max-width: 370px;
      animation: fadeIn 0.3s;
    }
    .menu-filtros-inteligente button {
      display:block;
      width:90%;
      margin:8px auto;
      font-size:1.1em;
      font-weight:700;
      background: var(--btn-bg);
      color: var(--btn-text);
      border-radius: 8px;
      border:none;
      padding: 10px 0;
      cursor:pointer;
      transition: var(--transition);
    }
    .menu-filtros-inteligente button:hover {
      background: var(--hover);
      color: var(--receta-final);
    }
    .modo-oscuro .menu-filtros-inteligente {
      background: var(--receta-list-bg);
    }
    /* ...el resto de estilos se mantienen igual que la versi√≥n anterior... */
    /* Responsive */
    @media (max-width: 600px) {
      .main-content, #panel-temporizadores { max-width: 98vw;}
      #buscador, #btn-buscador-inteligente, .menu-filtros-inteligente { width: 98vw; max-width:98vw;}
      .titulo-app, .bienvenida, .by-yahya {font-size:1.15em;}
    }
  </style>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js');
      });
    }
  </script>
</head>
<body>
  <header>
    <div class="titulo-app">Dulces Patxi</div>
    <div class="bienvenida">Bienvenidos a Dulces de Bachir Krai</div>
    <div class="by-yahya">By Yahya</div>
    <input type="text" id="buscador" placeholder="Buscar receta ..." autocomplete="off"/>
    <button id="btn-buscador-inteligente">Buscador inteligente</button>
    <div id="menu-filtros-inteligente" style="display:none;"></div>
    <div class="toolbar">
      <button id="btn-menu" class="btn-menu">Men√∫</button>
      <button id="btn-favoritos" class="btn-favoritos">‚≠ê Recetas estrella</button>
      <button id="btn-atras" class="btn-atras" style="display:none;">‚Üê Atr√°s</button>
      <button id="btn-oscuro" class="btn-oscuro">üåô Modo</button>
      <button id="btn-ultima-receta" class="btn-ultima-receta" style="display:none;">√öltima receta</button>
    </div>
    <div id="menu-categorias" class="menu-categorias"></div>
  </header>
  <main id="receta-detalle" class="main-content"></main>
  <div id="panel-temporizadores"></div>
  <div class="controls">
    <label>Calculadora de porciones:
      <select id="selector-personas">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="4" selected>4</option>
        <option value="6">6</option>
        <option value="8">8</option>
        <option value="10">10</option>
        <option value="12">12</option>
        <option value="16">16</option>
        <option value="20">20</option>
      </select>
    </label>
  </div>
  <button class="btn-temp-personalizado" id="btn-temp-personalizado">‚è≤Ô∏è Temporizador personalizado</button>
  



 <script>
    // === DATOS DE LAS RECETAS ===
    const recetas = [
           // === TARTAS DEL AYER ===
      {
        "id": "VARIOS 142",
        "nombre": "Tarta de Manzana",
        "categoria": "Tartas del Ayer",
        "ingredientes": [
          { "nombre": "Pasta sableaux o hojaldre", "cantidad": 1, "unidad": "masa" },
          { "nombre": "Crema pastelera", "cantidad": 250, "unidad": "gr" },
          { "nombre": "Manzanas reinetas", "cantidad": 4, "unidad": "unidades" },
          { "nombre": "Az√∫car grano", "cantidad": 50, "unidad": "gr" },
          { "nombre": "Gelatina de manzana", "cantidad": 1, "unidad": "sobre" }
        ],
        "elaboracion": [
          "Rellenar un molde con pasta sableux y cocer en blanco con alubias.",
          "Retirar las alubias y rellenar con crema pastelera.",
          "Colocar manzana pelada y fileteada de forma decorativa.",
          "Espolvorear con az√∫car y hornear a 190¬∞C durante 35 minutos.",
          "Una vez fr√≠a, abrillantar con gelatina de manzana."
        ],
        "temperatura": 190,
        "tiempo": 35
      },
      {
        "id": "VARIOS 143",
        "nombre": "Tarta San Marcos",
        "categoria": "Tartas del Ayer",
        "ingredientes": [
          { "nombre": "Bizcocho corriente", "cantidad": 1, "unidad": "plancha" },
          { "nombre": "Alm√≠bar para emborrachar", "cantidad": 200, "unidad": "ml" },
          { "nombre": "Nata montada", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Yema pastelera", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Az√∫car en grano", "cantidad": 50, "unidad": "gr" },
          { "nombre": "Gelatina de manzana", "cantidad": 1, "unidad": "sobre" }
        ],
        "elaboracion": [
          "Montar la tarta: disco de bizcocho emborrachado.",
          "Capa de yema pastelera.",
          "Disco de bizcocho emborrachado.",
          "Capa de nata montada.",
          "Disco de bizcocho emborrachado.",
          "Extender yema pastelera, rociar con az√∫car y quemar con soplete.",
          "Decorar laterales con nata y almendra granillo tostada.",
          "Abrillantar con gelatina de manzana."
        ]
      },
      {
        "id": "VARIOS 144",
        "nombre": "Tarta Tatin",
        "categoria": "Tartas del Ayer",
        "ingredientes": [
          { "nombre": "Az√∫car", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 100, "unidad": "ml" },
          { "nombre": "Manzanas reinetas", "cantidad": 1, "unidad": "kg" },
          { "nombre": "Recortes de hojaldre", "cantidad": 1, "unidad": "cantidad suficiente" }
        ],
        "elaboracion": [
          "Ba√±o de caramelo en molde: derretir az√∫car con agua.",
          "Pelar, descorazonar y cortar manzanas por la mitad.",
          "Colocarlas en el molde con parte convexa hacia abajo.",
          "Cubrir con l√°mina de hojaldre, pinchar y hornear a 180¬∞C."
        ],
        "temperatura": 180,
        "tiempo": 40
      },
      {
        "id": "VARIOS 146",
        "nombre": "Tarta de Queso",
        "categoria": "Tartas del Ayer",
        "ingredientes": [
          { "nombre": "Queso tipo Philadelphia", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Huevos", "cantidad": 4, "unidad": "unidades" },
          { "nombre": "Nata l√≠quida", "cantidad": 200, "unidad": "ml" },
          { "nombre": "Galletas trituradas", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Mantequilla", "cantidad": 100, "unidad": "gr" }
        ],
        "elaboracion": [
          "Mezclar galletas con mantequilla derretida y formar base.",
          "Batir queso con az√∫car, a√±adir huevos uno a uno.",
          "Incorporar nata y verter sobre la base.",
          "Hornear a ba√±o Mar√≠a a 160¬∞C durante 50 minutos.",
          "Enfriar y refrigerar toda la noche."
        ],
        "temperatura": 160,
        "tiempo": 50
      },
      {
        "id": "VARIOS 147",
        "nombre": "Tarta de Yema Quemada",
        "categoria": "Tartas del Ayer",
        "ingredientes": [
          { "nombre": "Pasta sableaux", "cantidad": 1, "unidad": "masa" },
          { "nombre": "Yemas de huevo", "cantidad": 20, "unidad": "unidades" },
          { "nombre": "Az√∫car", "cantidad": 600, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 250, "unidad": "ml" }
        ],
        "elaboracion": [
          "Preparar alm√≠bar con az√∫car y agua hasta punto de hebra fina.",
          "Incorporar yemas poco a poco sin dejar de remover.",
          "Verter sobre la masa sableaux previamente cocida.",
          "Cocer al horno suave hasta dorar ligeramente."
        ],
        "temperatura": 170,
        "tiempo": 25
      },
      {
        "id": "VARIOS 150",
        "nombre": "Tarta Sagarroz",
        "categoria": "Tartas del Ayer",
        "ingredientes": [
          { "nombre": "Bizcocho corriente", "cantidad": 1, "unidad": "plancha" },
          { "nombre": "Alm√≠bar aromatizado con sidra", "cantidad": 200, "unidad": "ml" },
          { "nombre": "Nata montada", "cantidad": 400, "unidad": "gr" },
          { "nombre": "Compota de manzana", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Sidra", "cantidad": 100, "unidad": "ml" },
          { "nombre": "Gelatina de manzana", "cantidad": 1, "unidad": "sobre" }
        ],
        "elaboracion": [
          "Emborrar el bizcocho con alm√≠bar de sidra.",
          "Rellenar con capas alternas de nata y compota.",
          "Cubrir con nata y abrillantar con gelatina."
        ]
      },
      {
        "id": "VARIOS 161",
        "nombre": "Tarta de Almendra",
        "categoria": "Tartas del Ayer",
        "ingredientes": [
          { "nombre": "Pasta quebrada", "cantidad": 1, "unidad": "masa" },
          { "nombre": "Az√∫car", "cantidad": 250, "unidad": "gr" },
          { "nombre": "Almendra molida", "cantidad": 250, "unidad": "gr" },
          { "nombre": "Ralladura de lim√≥n", "cantidad": 1, "unidad": "unidad" },
          { "nombre": "Huevos", "cantidad": 3, "unidad": "unidades" },
          { "nombre": "Mantequilla", "cantidad": 250, "unidad": "gr" }
        ],
        "elaboracion": [
          "Forrar molde con pasta quebrada.",
          "Mezclar almendra, az√∫car, ralladura, huevos y mantequilla.",
          "Verter sobre la base y hornear a 180¬∞C durante 45 minutos."
        ],
        "temperatura": 180,
        "tiempo": 45
      },
      {
        "id": "VARIOS 158",
        "nombre": "Tarta de Frutas",
        "categoria": "Tartas del Ayer",
        "ingredientes": [
          { "nombre": "Dos discos de bizcocho", "cantidad": 2, "unidad": "unidades" },
          { "nombre": "Alm√≠bar de emborrachar", "cantidad": 200, "unidad": "ml" },
          { "nombre": "Nata montada", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Yema de naranja", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Frutas variadas", "cantidad": 500, "unidad": "gr" }
        ],
        "elaboracion": [
          "Colocar un disco de bizcocho en molde de aro.",
          "Emborrarlo m√≠nimamente.",
          "Rellenar abundantemente de nata.",
          "Colocar encima el otro disco de bizcocho y emborracharlo.",
          "Extender yema de naranja, rociar con az√∫car y quemar.",
          "Abrillantar con gelatina de manzana.",
          "Colocar frutas decorativamente y abrillantar."
        ]
      },
      // === TARTAS PREMIUM ===
      {
        "id": "VARIOS 148",
        "nombre": "Tronco Navide√±o",
        "categoria": "Tartas Premium",
        "ingredientes": [
          { "nombre": "Bizcocho plancha", "cantidad": 1, "unidad": "unidad" },
          { "nombre": "Trufa", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Alm√≠bar", "cantidad": 150, "unidad": "ml" },
          { "nombre": "Cobertura", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Mantequilla", "cantidad": 50, "unidad": "gr" },
          { "nombre": "Hojas de chocolate", "cantidad": 1, "unidad": "cantidad" },
          { "nombre": "Az√∫car glass", "cantidad": 30, "unidad": "gr" },
          { "nombre": "Canela en polvo", "cantidad": 5, "unidad": "gr" }
        ],
        "elaboracion": [
          "Empapar el bizcocho con alm√≠bar.",
          "Untar con trufa y enrollar con ayuda de papel sulfurizado.",
          "Abrillantar con cobertura mezclada con mantequilla.",
          "Crear textura de corteza con tenedor.",
          "Decorar con hojas de chocolate y canela."
        ]
      },
      {
        "id": "VARIOS 149",
        "nombre": "Tarta Selva Negra",
        "categoria": "Tartas Premium",
        "ingredientes": [
          { "nombre": "Bizcocho de chocolate", "cantidad": 1, "unidad": "plancha" },
          { "nombre": "Cherovia", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Kirsch", "cantidad": 200, "unidad": "ml" },
          { "nombre": "Nata montada", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Cacao en polvo", "cantidad": 50, "unidad": "gr" },
          { "nombre": "Cerezas en alm√≠bar", "cantidad": 1, "unidad": "lata" }
        ],
        "elaboracion": [
          "Cortar el bizcocho en tres discos.",
          "Emborrar cada disco con Kirsch.",
          "Alternar capas de cherovia, nata y cerezas.",
          "Cubrir exterior con nata y espolvorear cacao.",
          "Decorar con cerezas y virutas de chocolate."
        ]
      },
      {
        "id": "VARIOS 151",
        "nombre": "Tarta Mart√≠nica",
        "categoria": "Tartas Premium",
        "ingredientes": [
          { "nombre": "Pasta sableaux", "cantidad": 1, "unidad": "masa" },
          { "nombre": "Crema pastelera", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Pi√±a natural", "cantidad": 1, "unidad": "unidad" },
          { "nombre": "Ron", "cantidad": 50, "unidad": "ml" },
          { "nombre": "Nata montada", "cantidad": 200, "unidad": "gr" }
        ],
        "elaboracion": [
          "Forrar molde con pasta sableaux y cocer en blanco.",
          "Rellenar con crema pastelera y pi√±a macerada en ron.",
          "Cubrir con nata y decorar con trozos de pi√±a."
        ]
      },
      {
        "id": "VARIOS 152",
        "nombre": "Tarta de Moka",
        "categoria": "Tartas Premium",
        "ingredientes": [
          { "nombre": "Bizcocho genov√©s", "cantidad": 1, "unidad": "plancha" },
          { "nombre": "Caf√© expreso", "cantidad": 200, "unidad": "ml" },
          { "nombre": "Mascarpone", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Az√∫car glass", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Chocolate negro", "cantidad": 100, "unidad": "gr" }
        ],
        "elaboracion": [
          "Emborrar el bizcocho con caf√©.",
          "Mezclar mascarpone con az√∫car y cubrir el bizcocho.",
          "Rallar chocolate y espolvorear por encima."
        ]
      },
      {
        "id": "VARIOS 153",
        "nombre": "Tarta √ìpera",
        "categoria": "Tartas Premium",
        "ingredientes": [
          { "nombre": "Bizcocho joconde", "cantidad": 3, "unidad": "discos" },
          { "nombre": "Caf√© concentrado", "cantidad": 150, "unidad": "ml" },
          { "nombre": "Crema de moka", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Cobertura de chocolate", "cantidad": 200, "unidad": "gr" }
        ],
        "elaboracion": [
          "Alternar capas de bizcocho empapado en caf√© y crema de moka.",
          "Cubrir con cobertura de chocolate brillante."
        ]
      },
      {
        "id": "VARIOS 154",
        "nombre": "Tarta Ponche Genov√©s",
        "categoria": "Tartas Premium",
        "ingredientes": [
          { "nombre": "Bizcocho genov√©s", "cantidad": 1, "unidad": "plancha" },
          { "nombre": "Alm√≠bar de vino de M√°laga", "cantidad": 200, "unidad": "ml" },
          { "nombre": "Crema pastelera", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Nata montada", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Chantilly", "cantidad": 200, "unidad": "gr" }
        ],
        "elaboracion": [
          "Cortar el bizcocho en dos capas.",
          "Emborrar con alm√≠bar de vino de M√°laga.",
          "Rellenar con crema pastelera y nata.",
          "Cubrir con chantilly y decorar con guindas."
        ]
      },
      {
        "id": "VARIOS 155",
        "nombre": "Tarta Mascota",
        "categoria": "Tartas Premium",
        "ingredientes": [
          { "nombre": "Bizcocho molde", "cantidad": 1, "unidad": "unidad" },
          { "nombre": "Alm√≠bar de emborrachar", "cantidad": 200, "unidad": "ml" },
          { "nombre": "Crema de mantequilla", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Almendra fileteada", "cantidad": 100, "unidad": "gr" }
        ],
        "elaboracion": [
          "Partimos de un bizcocho relleno de crema de mantequilla.",
          "Cubrimos la superficie y los laterales con crema de mantequilla.",
          "Aplanamos con esp√°tula.",
          "Decoramos con almendra fileteada."
        ]
      },
      {
        "id": "VARIOS 156",
        "nombre": "Terrina de Frutas",
        "categoria": "Tartas Premium",
        "ingredientes": [
          { "nombre": "Plancha de bizcocho", "cantidad": 1, "unidad": "unidad" },
          { "nombre": "Mantequilla", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Az√∫car lustre", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Almendra molida", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Nata l√≠quida", "cantidad": 300, "unidad": "ml" },
          { "nombre": "Kiwi", "cantidad": 3, "unidad": "unidades" },
          { "nombre": "Fresas", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Melocot√≥n en alm√≠bar", "cantidad": 200, "unidad": "gr" }
        ],
        "elaboracion": [
          "Forrar molde con film transparente.",
          "Colocar capa de bizcocho.",
          "Rellenar con mezcla de mantequilla, az√∫car, almendra y nata.",
          "A√±adir frutas cortadas.",
          "Congelar y desmoldar."
        ]
      },
      {
        "id": "VARIOS 157",
        "nombre": "Tarta de Enrejado",
        "categoria": "Tartas Premium",
        "ingredientes": [
          { "nombre": "Recortes de hojaldre", "cantidad": 1, "unidad": "masa" },
          { "nombre": "Crema pastelera", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Frambuesas", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Gelatina de manzana", "cantidad": 1, "unidad": "sobre" }
        ],
        "elaboracion": [
          "Forrar molde con hojaldre.",
          "Rellenar con crema pastelera.",
          "Colocar frambuesas.",
          "Hacer rejilla con tiras de hojaldre.",
          "Hornear a 180¬∞C.",
          "Abrillantar con gelatina."
        ],
        "temperatura": 180,
        "tiempo": 35
      },
      {
        "id": "VARIOS 159",
        "nombre": "Tarta de Chocolatina",
        "categoria": "Tartas Premium",
        "ingredientes": [
          { "nombre": "Bizcocho genov√©s", "cantidad": 1, "unidad": "plancha" },
          { "nombre": "Alm√≠bar de caf√©", "cantidad": 200, "unidad": "ml" },
          { "nombre": "Trufa negra", "cantidad": 400, "unidad": "gr" },
          { "nombre": "Virutas de chocolate", "cantidad": 100, "unidad": "gr" }
        ],
        "elaboracion": [
          "Cortar bizcocho en dos capas.",
          "Emborrar con alm√≠bar de caf√©.",
          "Rellenar con trufa negra.",
          "Cubrir con trufa y decorar con virutas."
        ]
      },
      // === BIZCOCHOS, MAGDALENAS & MUFFINS ===
      {
        "id": "VARIOS 67",
        "nombre": "Sobao Pasiego",
        "categoria": "Bizcochos, Magdalenas & Muffins",
        "ingredientes": [
          { "nombre": "Mantequilla", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Az√∫car glas√©", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Huevos", "cantidad": 15, "unidad": "unidades" },
          { "nombre": "Ron", "cantidad": 50, "unidad": "ml" },
          { "nombre": "Harina floja", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Impulsor", "cantidad": 10, "unidad": "gr" }
        ],
        "elaboracion": [
          "Batir mantequilla con az√∫car, a√±adir huevos uno a uno.",
          "Incorporar harina con impulsor, ron y mezclar delicadamente.",
          "Hornear a 180¬∞C."
        ],
        "temperatura": 180,
        "tiempo": 30
      },
      {
        "id": "VARIOS 202",
        "nombre": "San Blas",
        "categoria": "Bizcochos, Magdalenas & Muffins",
        "ingredientes": [
          { "nombre": "Harina", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 250, "unidad": "gr" },
          { "nombre": "Huevos", "cantidad": 5, "unidad": "unidades" },
          { "nombre": "Mantequilla", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Leche", "cantidad": 100, "unidad": "ml" },
          { "nombre": "Impulsor", "cantidad": 10, "unidad": "gr" }
        ],
        "elaboracion": [
          "Batir mantequilla con az√∫car, a√±adir huevos uno a uno.",
          "Incorporar harina con impulsor y leche.",
          "Hornear a 180¬∞C durante 25 minutos."
        ],
        "temperatura": 180,
        "tiempo": 25
      },
      {
        "id": "VARIOS 58",
        "nombre": "Bizcocho de Chocolate",
        "categoria": "Bizcochos, Magdalenas & Muffins",
        "ingredientes": [
          { "nombre": "Huevos", "cantidad": 4, "unidad": "unidades" },
          { "nombre": "Az√∫car", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Harina", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Cacao en polvo", "cantidad": 50, "unidad": "gr" },
          { "nombre": "Mantequilla", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Leche", "cantidad": 100, "unidad": "ml" },
          { "nombre": "Impulsor", "cantidad": 10, "unidad": "gr" }
        ],
        "elaboracion": [
          "Batir huevos con az√∫car hasta doblar volumen.",
          "A√±adir harina, cacao, mantequilla derretida, leche e impulsor.",
          "Hornear a 180¬∞C durante 30 minutos."
        ],
        "temperatura": 180,
        "tiempo": 30
      },
      {
        "id": "VARIOS 59",
        "nombre": "Bizcocho de Naranja",
        "categoria": "Bizcochos, Magdalenas & Muffins",
        "ingredientes": [
          { "nombre": "Huevos", "cantidad": 4, "unidad": "unidades" },
          { "nombre": "Az√∫car", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Harina", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Zumo de naranja", "cantidad": 100, "unidad": "ml" },
          { "nombre": "Ralladura de naranja", "cantidad": 1, "unidad": "unidad" },
          { "nombre": "Mantequilla", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Impulsor", "cantidad": 10, "unidad": "gr" }
        ],
        "elaboracion": [
          "Batir huevos con az√∫car hasta doblar volumen.",
          "A√±adir harina, zumo, ralladura, mantequilla derretida e impulsor.",
          "Hornear a 180¬∞C durante 30 minutos."
        ],
        "temperatura": 180,
        "tiempo": 30
      },
      {
        "id": "VARIOS 68",
        "nombre": "Magdalenas",
        "categoria": "Bizcochos, Magdalenas & Muffins",
        "ingredientes": [
          { "nombre": "Huevos", "cantidad": 10, "unidad": "unidades" },
          { "nombre": "Az√∫car", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Harina", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Mantequilla", "cantidad": 250, "unidad": "gr" },
          { "nombre": "Leche", "cantidad": 100, "unidad": "ml" },
          { "nombre": "Impulsor", "cantidad": 10, "unidad": "gr" }
        ],
        "elaboracion": [
          "Batir huevos con az√∫car hasta doblar volumen.",
          "Incorporar harina, mantequilla derretida, leche e impulsor.",
          "Escudillar en moldes y hornear a 180¬∞C durante 20 minutos."
        ],
        "temperatura": 180,
        "tiempo": 20
      },
      {
        "id": "VARIOS 61",
        "nombre": "Bizcocho de Manzana",
        "categoria": "Bizcochos, Magdalenas & Muffins",
        "ingredientes": [
          { "nombre": "Huevos", "cantidad": 4, "unidad": "unidades" },
          { "nombre": "Az√∫car", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Harina", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Manzanas", "cantidad": 2, "unidad": "unidades" },
          { "nombre": "Mantequilla", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Impulsor", "cantidad": 10, "unidad": "gr" }
        ],
        "elaboracion": [
          "Batir huevos con az√∫car hasta doblar volumen.",
          "A√±adir harina, manzana rallada, mantequilla derretida e impulsor.",
          "Hornear a 180¬∞C durante 30 minutos."
        ],
        "temperatura": 180,
        "tiempo": 30
      },
      {
        "id": "VARIOS 60",
        "nombre": "Bizcocho de Coco",
        "categoria": "Bizcochos, Magdalenas & Muffins",
        "ingredientes": [
          { "nombre": "Huevos", "cantidad": 4, "unidad": "unidades" },
          { "nombre": "Az√∫car", "cantidad": 400, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 200, "unidad": "cc" },
          { "nombre": "Harina", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Levadura royal", "cantidad": 1, "unidad": "sobre" },
          { "nombre": "Coco rallado", "cantidad": 50, "unidad": "gr" }
        ],
        "elaboracion": [
          "Batir huevos con az√∫car, agregar agua hirviendo, harina, levadura y coco.",
          "Verter en molde engrasado y enharinado.",
          "Hornear a fuego lento los primeros 10 minutos, luego aumentar temperatura."
        ],
        "tiempo": 50
      },
      {
        "id": "VARIOS 195",
        "nombre": "Coquitos",
        "categoria": "Bizcochos, Magdalenas & Muffins",
        "ingredientes": [
          { "nombre": "Huevos", "cantidad": 3, "unidad": "unidades" },
          { "nombre": "Az√∫car", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Coco rallado", "cantidad": 250, "unidad": "gr" }
        ],
        "elaboracion": [
          "Mezclar ingredientes y dejar reposar en frigor√≠fico.",
          "Formar bolas peque√±as y hornear a horno fuerte 20 minutos."
        ],
        "temperatura": 190,
        "tiempo": 20
      },
      {
        "id": "VARIOS 196",
        "nombre": "Macarr√≥n de Almendra",
        "categoria": "Bizcochos, Magdalenas & Muffins",
        "ingredientes": [
          { "nombre": "Almendra molida", "cantidad": 480, "unidad": "gr" },
          { "nombre": "Az√∫car grano", "cantidad": 400, "unidad": "gr" },
          { "nombre": "Claritas", "cantidad": 180, "unidad": "gr" }
        ],
        "elaboracion": [
          "Mezclar todos los ingredientes hasta formar una masa homog√©nea.",
          "Escudillar con manga sobre placa.",
          "Secar a 40-50¬∞C durante varias horas.",
          "Cocer a 140¬∞C cuando est√©n secos."
        ],
        "temperatura": 140,
        "tiempo": 15
      },
      {
        "id": "VARIOS 199",
        "nombre": "Empi√±onadas",
        "categoria": "Bizcochos, Magdalenas & Muffins",
        "ingredientes": [
          { "nombre": "Almendra molida", "cantidad": 250, "unidad": "gr" },
          { "nombre": "Az√∫car lustre", "cantidad": 225, "unidad": "gr" },
          { "nombre": "Claras de huevo", "cantidad": 1, "unidad": "cantidad" },
          { "nombre": "Pi√±ones", "cantidad": 100, "unidad": "gr" }
        ],
        "elaboracion": [
          "Mezclar almendra, az√∫car y claras.",
          "Formar bolas, rebozar con pi√±ones.",
          "Cocer a horno a 180-200¬∞C."
        ],
        "temperatura": 190,
        "tiempo": 18
      },
      // === DULCES & CONFITES ===
      {
        "id": "VARIOS 173",
        "nombre": "Trufa Negra",
        "categoria": "Dulces & Confites",
        "ingredientes": [
          { "nombre": "Nata", "cantidad": 350, "unidad": "gr" },
          { "nombre": "Cobertura negra", "cantidad": 650, "unidad": "gr" },
          { "nombre": "Cognac", "cantidad": 2, "unidad": "cda" }
        ],
        "elaboracion": [
          "Calentar la nata y verter sobre la cobertura.",
          "Disolver con esp√°tula, a√±adir cognac.",
          "Dejar enfriar, hacer bolas y ba√±ar en cobertura o cacao."
        ]
      },
      {
        "id": "VARIOS 48",
        "nombre": "Trufa Cocida",
        "categoria": "Dulces & Confites",
        "ingredientes": [
          { "nombre": "Nata l√≠quida", "cantidad": 1000, "unidad": "ml" },
          { "nombre": "Cobertura negra", "cantidad": 140, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 150, "unidad": "gr" }
        ],
        "elaboracion": [
          "Mezclar todos los ingredientes y llevar al fuego hasta disolver la cobertura.",
          "Enfriar en c√°mara toda la noche.",
          "Al d√≠a siguiente, montar con varilla hasta obtener textura cremosa.",
          "Formar bolas y rodar en cacao en polvo."
        ]
      },
      {
        "id": "VARIOS 49",
        "nombre": "Trufa Cocida Blanca",
        "categoria": "Dulces & Confites",
        "ingredientes": [
          { "nombre": "Nata l√≠quida", "cantidad": 1000, "unidad": "ml" },
          { "nombre": "Cobertura blanca", "cantidad": 400, "unidad": "gr" }
        ],
        "elaboracion": [
          "Cocer de v√≠spera la nata con la cobertura.",
          "Enfriar en c√°mara y al d√≠a siguiente proceder a montarla."
        ]
      },
      {
        "id": "VARIOS 50",
        "nombre": "Toffe",
        "categoria": "Dulces & Confites",
        "ingredientes": [
          { "nombre": "Nata l√≠quida", "cantidad": 1000, "unidad": "ml" },
          { "nombre": "Az√∫car", "cantidad": 250, "unidad": "gr" }
        ],
        "elaboracion": [
          "Hacer caramelo rubio con az√∫car.",
          "A√±adir nata caliente con cuidado.",
          "Hervir hasta disoluci√≥n completa.",
          "Usar como salsa o montar al d√≠a siguiente."
        ]
      },
      {
        "id": "VARIOS 178",
        "nombre": "Mazap√°n",
        "categoria": "Dulces & Confites",
        "ingredientes": [
          { "nombre": "Almendra molida", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 200, "unidad": "ml" },
          { "nombre": "Glucosa", "cantidad": 100, "unidad": "gr" }
        ],
        "elaboracion": [
          "Mezclar todos los ingredientes hasta formar una masa homog√©nea.",
          "Amasar y moldear como se desee.",
          "Secar al aire o en horno muy bajo."
        ]
      },
      {
        "id": "VARIOS 180",
        "nombre": "Turr√≥n de Yema",
        "categoria": "Dulces & Confites",
        "ingredientes": [
          { "nombre": "Nata", "cantidad": 125, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 125, "unidad": "gr" },
          { "nombre": "Yemas", "cantidad": 9, "unidad": "unidades" },
          { "nombre": "Alm√≠bar", "cantidad": 1, "unidad": "kilo" },
          { "nombre": "Almendra molida", "cantidad": 1, "unidad": "kilo" },
          { "nombre": "Glucosa", "cantidad": 50, "unidad": "gr" },
          { "nombre": "Vainillina", "cantidad": 1, "unidad": "cda" }
        ],
        "elaboracion": [
          "Elaborar alm√≠bar a punto de bola floja.",
          "Mezclar con yemas, nata, almendra y glucosa.",
          "Moldear y enfriar."
        ]
      },
      {
        "id": "VARIOS 182",
        "nombre": "Turr√≥n de Coco",
        "categoria": "Dulces & Confites",
        "ingredientes": [
          { "nombre": "Alm√≠bar", "cantidad": 1, "unidad": "kilo" },
          { "nombre": "Agua", "cantidad": 350, "unidad": "gr" },
          { "nombre": "Coco rallado", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Almendra molida", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Glucosa", "cantidad": 125, "unidad": "gr" }
        ],
        "elaboracion": [
          "Hacer alm√≠bar con az√∫car, agua y glucosa.",
          "A√±adir coco y almendra.",
          "Verter en molde, enfriar y cortar."
        ]
      },
      {
        "id": "VARIOS 183",
        "nombre": "Turr√≥n de Pistachos",
        "categoria": "Dulces & Confites",
        "ingredientes": [
          { "nombre": "Alm√≠bar", "cantidad": 1, "unidad": "kilo" },
          { "nombre": "Agua", "cantidad": 330, "unidad": "gr" },
          { "nombre": "Pistachos molidos", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Almendra molida", "cantidad": 500, "unidad": "gr" }
        ],
        "elaboracion": [
          "Hacer alm√≠bar a punto de hebra floja.",
          "Mezclar con pistachos y almendra.",
          "Moldear, prensar y reposar."
        ]
      },
      {
        "id": "VARIOS 184",
        "nombre": "Guirlache",
        "categoria": "Dulces & Confites",
        "ingredientes": [
          { "nombre": "Az√∫car", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Manteca de cerdo", "cantidad": 10, "unidad": "gr" },
          { "nombre": "Canela", "cantidad": 5, "unidad": "gr" },
          { "nombre": "Zumo de lim√≥n", "cantidad": 1, "unidad": "chorro" },
          { "nombre": "Almendras marcona", "cantidad": 450, "unidad": "gr" }
        ],
        "elaboracion": [
          "Hacer caramelo rubio con az√∫car, manteca, canela y lim√≥n.",
          "A√±adir almendras tostadas.",
          "Extender sobre m√°rmol engrasado.",
          "Cortar en barritas antes de enfriar."
        ]
      },
      {
        "id": "VARIOS 181",
        "nombre": "Turr√≥n de Nata Nuez",
        "categoria": "Dulces & Confites",
        "ingredientes": [
          { "nombre": "Nata", "cantidad": 400, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 1125, "unidad": "gr" },
          { "nombre": "Almendra molida", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Nueces", "cantidad": 750, "unidad": "gr" },
          { "nombre": "Vainillina", "cantidad": 1, "unidad": "cda" }
        ],
        "elaboracion": [
          "Hervir nata con az√∫car, a√±adir almendra, nueces y vainillina.",
          "Moldear, prensar y dejar reposar m√≠nimo un d√≠a."
        ]
      },
      // === MASAS & PASTELES ===
      {
        "id": "VARIOS 75",
        "nombre": "Hojaldre (F√≥rmula Tradicional)",
        "categoria": "Masas & Pasteles",
        "ingredientes": [
          { "nombre": "Harina fuerte", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 600, "unidad": "gr" },
          { "nombre": "Sal", "cantidad": 20, "unidad": "gr" },
          { "nombre": "Manteca de cerdo o mantequilla", "cantidad": 600, "unidad": "gr" }
        ],
        "elaboracion": [
          "Mezclar harina, agua y sal. Formar un plast√≥n.",
          "Enfriar 30 minutos.",
          "Estirar y colocar la grasa en el centro. Doblar como libro.",
          "Repetir 3-4 vueltas simples, refrigerando entre cada una."
        ]
      },
      {
        "id": "VARIOS 83",
        "nombre": "Palmeras",
        "categoria": "Masas & Pasteles",
        "ingredientes": [
          { "nombre": "Plast√≥n de hojaldre", "cantidad": 1, "unidad": "masa" },
          { "nombre": "Az√∫car en grano", "cantidad": 200, "unidad": "gr" }
        ],
        "elaboracion": [
          "Hacer una masa de hojaldre a la que se dan 6 pliegues sencillos.",
          "En el √∫ltimo pliegue espolvorear con az√∫car en grano y estirar.",
          "Se monta la masa tres veces por cada lado, juntar y cortar en palmeras.",
          "Hornear a 200-210¬∞C hasta dorar."
        ],
        "temperatura": 205,
        "tiempo": 22
      },
      {
        "id": "VARIOS 187",
        "nombre": "Cigarrillos Rusos",
        "categoria": "Masas & Pasteles",
        "ingredientes": [
          { "nombre": "Hojaldre", "cantidad": 1, "unidad": "masa" },
          { "nombre": "Az√∫car glass", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Clara de huevo", "cantidad": 1, "unidad": "unidad" }
        ],
        "elaboracion": [
          "Estirar el hojaldre muy fino y pintar con clara de huevo.",
          "Espolvorear con az√∫car glass.",
          "Enrollar como si fuera un brazo de gitano y cortar en rodajas finas.",
          "Hornear a 200¬∞C hasta dorar."
        ],
        "temperatura": 200,
        "tiempo": 15
      },
      {
        "id": "VARIOS 190",
        "nombre": "Lenguas de Gato",
        "categoria": "Masas & Pasteles",
        "ingredientes": [
          { "nombre": "Mantequilla", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Az√∫car glass", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Harina", "cantidad": 200, "unidad": "gr" }
        ],
        "elaboracion": [
          "Batir mantequilla con az√∫car glass.",
          "Incorporar harina con esp√°tula.",
          "Escudillar en boquilla rizada.",
          "Hornear a 180¬∞C sin abrir el horno."
        ],
        "temperatura": 180,
        "tiempo": 12
      },
      // === POSTRES FR√çOS ===
      {
        "id": "VARIOS 13",
        "nombre": "Flan de Chocolate",
        "categoria": "Postres Fr√≠os",
        "ingredientes": [
          { "nombre": "Leche", "cantidad": 250, "unidad": "ml" },
          { "nombre": "Nata l√≠quida", "cantidad": 250, "unidad": "ml" },
          { "nombre": "Az√∫car", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Cobertura negra", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Huevos", "cantidad": 6, "unidad": "unidades" },
          { "nombre": "Salsa de caramelo", "cantidad": 1, "unidad": "cantidad" }
        ],
        "elaboracion": [
          "Mezclar leche, nata, az√∫car y cobertura fundida.",
          "A√±adir huevos batidos.",
          "Verter en moldes con caramelo.",
          "Cocer al ba√±o Mar√≠a a 160¬∞C durante 45 minutos.",
          "Enfriar y desmoldar."
        ],
        "temperatura": 160,
        "tiempo": 45
      },
      {
        "id": "VARIOS 25",
        "nombre": "Compota de Manzana",
        "categoria": "Postres Fr√≠os",
        "ingredientes": [
          { "nombre": "Manzanas", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Vino blanco", "cantidad": 250, "unidad": "ml" },
          { "nombre": "Orejones", "cantidad": 50, "unidad": "gr" },
          { "nombre": "Pasas", "cantidad": 30, "unidad": "gr" }
        ],
        "elaboracion": [
          "Pelar y cortar manzanas.",
          "Cocer con az√∫car, vino y frutas secas.",
          "Dejar enfriar antes de servir."
        ]
      },
      {
        "id": "VARIOS 26",
        "nombre": "Peras en Alm√≠bar",
        "categoria": "Postres Fr√≠os",
        "ingredientes": [
          { "nombre": "Peras", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Vino blanco", "cantidad": 500, "unidad": "ml" },
          { "nombre": "Az√∫car", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 500, "unidad": "ml" },
          { "nombre": "Canela en rama", "cantidad": 1, "unidad": "unidad" },
          { "nombre": "C√°scara de lim√≥n", "cantidad": 1, "unidad": "unidad" }
        ],
        "elaboracion": [
          "Pelar peras y mantener en agua con lim√≥n.",
          "Hervir agua, vino, az√∫car, canela y lim√≥n.",
          "A√±adir peras y cocer a fuego lento 20-30 min.",
          "Dejar enfriar en el alm√≠bar."
        ],
        "tiempo": 25
      },
      {
        "id": "VARIOS 27",
        "nombre": "Arroz con Leche",
        "categoria": "Postres Fr√≠os",
        "ingredientes": [
          { "nombre": "Arroz", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Leche", "cantidad": 1000, "unidad": "ml" },
          { "nombre": "Az√∫car", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Canela en rama", "cantidad": 1, "unidad": "unidad" },
          { "nombre": "C√°scara de lim√≥n", "cantidad": 1, "unidad": "unidad" },
          { "nombre": "Vainilla", "cantidad": 1, "unidad": "unidad" }
        ],
        "elaboracion": [
          "Cocer el arroz en leche con az√∫car, canela, lim√≥n y vainilla.",
          "Dejar enfriar y servir fr√≠o con canela por encima."
        ]
      },
      {
        "id": "VARIOS 28",
        "nombre": "Leche Frita",
        "categoria": "Postres Fr√≠os",
        "ingredientes": [
          { "nombre": "Leche", "cantidad": 1000, "unidad": "ml" },
          { "nombre": "Harina", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Canela", "cantidad": 10, "unidad": "gr" },
          { "nombre": "Aceite para fre√≠r", "cantidad": 500, "unidad": "ml" }
        ],
        "elaboracion": [
          "Cocer leche con az√∫car, canela y harina hasta espesar.",
          "Enfriar, cortar en dados y fre√≠r.",
          "Espolvorear con az√∫car y canela."
        ]
      },
      {
        "id": "VARIOS 29",
        "nombre": "Torrijas",
        "categoria": "Postres Fr√≠os",
        "ingredientes": [
          { "nombre": "Pan de brioche", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Leche", "cantidad": 500, "unidad": "ml" },
          { "nombre": "Huevos", "cantidad": 3, "unidad": "unidades" },
          { "nombre": "Az√∫car", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Canela", "cantidad": 10, "unidad": "gr" },
          { "nombre": "Aceite", "cantidad": 300, "unidad": "ml" }
        ],
        "elaboracion": [
          "Remojar pan en leche con canela y az√∫car.",
          "Pasar por huevo y fre√≠r.",
          "Espolvorear con az√∫car y canela."
        ]
      },
      {
        "id": "VARIOS 30",
        "nombre": "Goxua",
        "categoria": "Postres Fr√≠os",
        "ingredientes": [
          { "nombre": "Bizcocho corriente", "cantidad": 1, "unidad": "plancha" },
          { "nombre": "Crema pastelera", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Nata montada", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Caramelo", "cantidad": 100, "unidad": "gr" }
        ],
        "elaboracion": [
          "Cortar el bizcocho en cuadrados.",
          "Rellenar con crema y nata.",
          "Ba√±o de caramelo por encima."
        ]
      },
      {
        "id": "VARIOS 31",
        "nombre": "Pastel Vasco",
        "categoria": "Postres Fr√≠os",
        "ingredientes": [
          { "nombre": "Harina", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Mantequilla", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Huevos", "cantidad": 4, "unidad": "unidades" },
          { "nombre": "Crema pastelera", "cantidad": 400, "unidad": "gr" }
        ],
        "elaboracion": [
          "Mezclar harina, az√∫car, mantequilla y huevos hasta formar masa.",
          "Forrar molde y rellenar con crema pastelera.",
          "Hornear a 180¬∞C durante 40 minutos."
        ],
        "temperatura": 180,
        "tiempo": 40
      },
      // === HELADOS & SORBETES ===
      {
        "id": "VARIOS 100",
        "nombre": "Sorbete de Lim√≥n al Champ√°n",
        "categoria": "Helados & Sorbetes",
        "ingredientes": [
          { "nombre": "Alm√≠bar a 28¬∞Brix", "cantidad": 1, "unidad": "litro" },
          { "nombre": "Zumo de lim√≥n", "cantidad": 1, "unidad": "litro" }
        ],
        "elaboracion": [
          "Mezclar ambos ingredientes y enfriar bien.",
          "Introducir en heladora y dejar congelar."
        ]
      },
      {
        "id": "VARIOS 105",
        "nombre": "Sorbete de Lim√≥n",
        "categoria": "Helados & Sorbetes",
        "ingredientes": [
          { "nombre": "Zumo de lim√≥n", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Glucosa", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Maicena", "cantidad": 20, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 480, "unidad": "gr" }
        ],
        "elaboracion": [
          "Mezclar sacarosa con maicena, a√±adir agua y cocer.",
          "Enfriar, a√±adir zumo y helar."
        ]
      },
      {
        "id": "VARIOS 118",
        "nombre": "Mousse de Cava",
        "categoria": "Helados & Sorbetes",
        "ingredientes": [
          { "nombre": "Cava", "cantidad": 750, "unidad": "ml" },
          { "nombre": "Az√∫car", "cantidad": 360, "unidad": "gr" },
          { "nombre": "Gelatina", "cantidad": 24, "unidad": "gr" },
          { "nombre": "Yemas", "cantidad": 3, "unidad": "unidades" },
          { "nombre": "Nata l√≠quida", "cantidad": 400, "unidad": "ml" }
        ],
        "elaboracion": [
          "Calentar cava con az√∫car y gelatina.",
          "A√±adir yemas, enfriar y mezclar con nata montada.",
          "Congelar."
        ]
      },
      {
        "id": "VARIOS 97",
        "nombre": "Sorbete de Naranja",
        "categoria": "Helados & Sorbetes",
        "ingredientes": [
          { "nombre": "Agua", "cantidad": 250, "unidad": "ml" },
          { "nombre": "Az√∫car", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Ralladura de naranja", "cantidad": 1, "unidad": "cantidad" },
          { "nombre": "Zumo de naranja", "cantidad": 500, "unidad": "ml" },
          { "nombre": "Clara de huevo", "cantidad": 1, "unidad": "unidad" }
        ],
        "elaboracion": [
          "Hacer alm√≠bar con agua y az√∫car.",
          "A√±adir ralladura, zumo y clara batida.",
          "Congelar en heladora."
        ]
      },
      {
        "id": "VARIOS 106",
        "nombre": "Bavarois de Chocolate",
        "categoria": "Helados & Sorbetes",
        "ingredientes": [
          { "nombre": "Chocolate negro", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Leche", "cantidad": 500, "unidad": "ml" },
          { "nombre": "Az√∫car", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Huevos", "cantidad": 4, "unidad": "unidades" },
          { "nombre": "Gelatina", "cantidad": 10, "unidad": "gr" }
        ],
        "elaboracion": [
          "Derretir chocolate con leche y az√∫car.",
          "A√±adir yemas, gelatina reblandecida.",
          "Montar claras y nata, incorporar.",
          "Enmoldar y refrigerar."
        ]
      },
      // === RELLENOS & COBERTURAS ===
      {
        "id": "VARIOS 221",
        "nombre": "Coulis de Frutos Rojos",
        "categoria": "Rellenos & Coberturas",
        "ingredientes": [
          { "nombre": "Fruta roja", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 400, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 250, "unidad": "ml" }
        ],
        "elaboracion": [
          "Hervir todos los ingredientes hasta densidad media.",
          "Triturar y colar por chino fino."
        ]
      },
      {
        "id": "VARIOS 215",
        "nombre": "Glassa Antihumedad",
        "categoria": "Decoraci√≥n & Acabados",
        "ingredientes": [
          { "nombre": "Az√∫car glass", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Clara de huevo deshidratada", "cantidad": 20, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 100, "unidad": "ml" }
        ],
        "elaboracion": [
          "Mezclar todos los ingredientes hasta homogeneidad.",
          "Dejar reposar 12 horas tapado.",
          "Ideal para decorar tartas sin que se humedezcan."
        ]
      },
      {
        "id": "VARIOS 223",
        "nombre": "Coulis de Manzana",
        "categoria": "Rellenos & Coberturas",
        "ingredientes": [
          { "nombre": "Manzanas", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 375, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 75, "unidad": "gr" },
          { "nombre": "Zumo de lim√≥n", "cantidad": 1, "unidad": "unidad" },
          { "nombre": "Vainilla", "cantidad": 0.25, "unidad": "vaina" }
        ],
        "elaboracion": [
          "Cocer manzanas con resto de ingredientes.",
          "Triturar, colar y ajustar espesor."
        ]
      },
      {
        "id": "VARIOS 224",
        "nombre": "Coulis de Kiwi",
        "categoria": "Rellenos & Coberturas",
        "ingredientes": [
          { "nombre": "Kiwi", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 100, "unidad": "ml" }
        ],
        "elaboracion": [
          "Pelar y triturar kiwi.",
          "A√±adir az√∫car y agua.",
          "Cocer ligeramente y colar."
        ]
      },
      {
        "id": "VARIOS 216",
        "nombre": "Ba√±o de Cobertura",
        "categoria": "Decoraci√≥n & Acabados",
        "ingredientes": [
          { "nombre": "Cobertura negra", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Mantequilla", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Glucosa", "cantidad": 2, "unidad": "cda" }
        ],
        "elaboracion": [
          "Derretir cobertura con mantequilla y glucosa.",
          "Usar como ba√±o para tartas y bombones."
        ]
      },
      // === DECORACI√ìN & ACABADOS ===
      {
        "id": "VARIOS 225",
        "nombre": "Merengue Italiano",
        "categoria": "Decoraci√≥n & Acabados",
        "ingredientes": [
          { "nombre": "Claras de huevo", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 50, "unidad": "ml" },
          { "nombre": "Az√∫car invertido", "cantidad": 10, "unidad": "gr" }
        ],
        "elaboracion": [
          "Calentar az√∫car, agua y az√∫car invertido hasta 118¬∞C.",
          "Verter sobre claras batidas a punto de nieve.",
          "Seguir batiendo hasta enfriar."
        ]
      },
      {
        "id": "VARIOS 226",
        "nombre": "Salsa de Fresa",
        "categoria": "Decoraci√≥n & Acabados",
        "ingredientes": [
          { "nombre": "Fresas", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 100, "unidad": "ml" },
          { "nombre": "Glucosa", "cantidad": 50, "unidad": "gr" },
          { "nombre": "Lim√≥n", "cantidad": 1, "unidad": "unidad" }
        ],
        "elaboracion": [
          "Cocer fresas con az√∫car, agua, glucosa y lim√≥n.",
          "Triturar y colar."
        ]
      },
      {
        "id": "VARIOS 227",
        "nombre": "Salsa de M√≥dena",
        "categoria": "Decoraci√≥n & Acabados",
        "ingredientes": [
          { "nombre": "Vinagre de m√≥dena", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 400, "unidad": "gr" },
          { "nombre": "Zumo de lim√≥n", "cantidad": 1, "unidad": "chorro" },
          { "nombre": "Agua", "cantidad": 1, "unidad": "chorro" }
        ],
        "elaboracion": [
          "Reducir vinagre. Hacer caramelo rubio con az√∫car.",
          "Mezclar ambas elaboraciones. Debe quedar meloso."
        ]
      },
      // === NUEVAS RECETAS ADICIONALES PARA COMPLETAR 73 ===
      {
        "id": "VARIOS 174",
        "nombre": "Trufa con Leche",
        "categoria": "Dulces & Confites",
        "ingredientes": [
          { "nombre": "Nata", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Cobertura blanca", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Leche condensada", "cantidad": 100, "unidad": "gr" }
        ],
        "elaboracion": [
          "Calentar nata, a√±adir cobertura blanca y leche condensada.",
          "Dejar enfriar, hacer bolas y rodar en cacao."
        ]
      },
      {
        "id": "VARIOS 197",
        "nombre": "Marquesas",
        "categoria": "Bizcochos, Magdalenas & Muffins",
        "ingredientes": [
          { "nombre": "Huevos", "cantidad": 6, "unidad": "unidades" },
          { "nombre": "Az√∫car", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Harina", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Mantequilla", "cantidad": 50, "unidad": "gr" }
        ],
        "elaboracion": [
          "Batir huevos con az√∫car hasta triplicar volumen.",
          "Incorporar harina y mantequilla derretida con cuidado.",
          "Hornear a 180¬∞C durante 25 minutos."
        ],
        "temperatura": 180,
        "tiempo": 25
      },
      {
        "id": "VARIOS 171",
        "nombre": "San Honore",
        "categoria": "Tartas Premium",
        "ingredientes": [
          { "nombre": "Pasta choux", "cantidad": 1, "unidad": "masa" },
          { "nombre": "Pasta sable", "cantidad": 1, "unidad": "masa" },
          { "nombre": "Crema San Honore", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Caramelo", "cantidad": 100, "unidad": "gr" }
        ],
        "elaboracion": [
          "Elaborar profiteroles con pasta choux.",
          "Montar base con pasta sable.",
          "Rellenar con crema, colocar profiteroles y abrillantar con caramelo."
        ]
      },
      {
        "id": "VARIOS 122",
        "nombre": "Tarta de Frambuesas",
        "categoria": "Tartas del Ayer",
        "ingredientes": [
          { "nombre": "Base de galleta", "cantidad": 1, "unidad": "unidad" },
          { "nombre": "Crema pastelera", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Frambuesas", "cantidad": 400, "unidad": "gr" },
          { "nombre": "Gelatina de frambuesa", "cantidad": 1, "unidad": "sobre" }
        ],
        "elaboracion": [
          "Rellenar base con crema pastelera.",
          "Colocar frambuesas encima.",
          "Abrillantar con gelatina."
        ]
      },
      {
        "id": "VARIOS 129",
        "nombre": "Tarta de Queso (2¬™ Forma)",
        "categoria": "Tartas del Ayer",
        "ingredientes": [
          { "nombre": "Queso crema", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Huevos", "cantidad": 4, "unidad": "unidades" },
          { "nombre": "Galletas", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Mantequilla", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Coulis de fruta", "cantidad": 200, "unidad": "gr" }
        ],
        "elaboracion": [
          "Base con galletas y mantequilla.",
          "Mezclar queso, az√∫car y huevos.",
          "Verter sobre base y hornear al ba√±o Mar√≠a.",
          "Desmoldar y cubrir con coulis."
        ],
        "temperatura": 160,
        "tiempo": 50
      },
      {
        "id": "VARIOS 46",
        "nombre": "Nata Montada",
        "categoria": "Rellenos & Coberturas",
        "ingredientes": [
          { "nombre": "Nata l√≠quida", "cantidad": 1000, "unidad": "ml" },
          { "nombre": "Az√∫car", "cantidad": 125, "unidad": "gr" }
        ],
        "elaboracion": [
          "Batir nata fr√≠a con az√∫car hasta punto firme."
        ]
      },
      {
        "id": "VARIOS 45",
        "nombre": "Merengue R√°pido",
        "categoria": "Decoraci√≥n & Acabados",
        "ingredientes": [
          { "nombre": "Claritas", "cantidad": 400, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 600, "unidad": "gr" }
        ],
        "elaboracion": [
          "Mezclar y calentar al ba√±o Mar√≠a hasta disolver az√∫car.",
          "Batir hasta enfriar y tener cuerpo firme."
        ]
      }
    ];

    // ====== ESTADO GLOBAL ======
    let historialNavegacion = [];
    let ultimaRecetaId = null;
    let temporizadores = [];
    let recetaActual = null;
    let favoritos = JSON.parse(localStorage.getItem('favoritos') || "[]");
    let notas = JSON.parse(localStorage.getItem('notas') || "{}");
    let fuente = 1.15; // accesibilidad
    let pitidoActivo = false;

    // ====== BUSCADOR INTELIGENTE ======
    document.getElementById('btn-buscador-inteligente').onclick = function() {
      const menu = document.getElementById('menu-filtros-inteligente');
      menu.style.display = menu.style.display === 'none' ? '' : 'none';
      menu.innerHTML = `
        <div style="font-size:1.16em;font-weight:900;margin-bottom:10px;color:var(--cat-bold);text-align:center;">Filtrar por:</div>
        <button onclick="filtrarInteligente('ingrediente')">Ingrediente</button>
        <button onclick="filtrarInteligente('tiempo')">Tiempo</button>
        <button onclick="filtrarInteligente('dificultad')">Dificultad</button>
        <button onclick="filtrarInteligente('favoritos')">Favoritos</button>
      `;
    }
    window.filtrarInteligente = function(tipo){
      document.getElementById('menu-filtros-inteligente').style.display='none';
      let q = prompt('Filtrar por '+tipo+':');
      if (!q && tipo!=='favoritos') return;
      let filtradas = recetas;
      if (tipo=='ingrediente')
        filtradas = recetas.filter(r=>r.ingredientes?.some(i=>i.nombre.toLowerCase().includes(q.toLowerCase())));
      else if (tipo=='tiempo')
        filtradas = recetas.filter(r=>(r.tiempo||'') <= parseInt(q));
      else if (tipo=='dificultad')
        filtradas = recetas.filter(r=>(r.dificultad||'').toLowerCase().includes(q.toLowerCase()));
      else if (tipo=='favoritos')
        filtradas = recetas.filter(r=>favoritos.includes(r.id));
      renderBusqueda(filtradas);
    }
    function renderBusqueda(filtradas){
      const main = document.getElementById('receta-detalle');
      main.innerHTML = `<h2 style="color:var(--titulo);font-weight:900;">Resultados</h2>
        <div class="recetas-lista anim-fade"><ul>
          ${filtradas.map(r=>`<li onclick="navegarA('receta','${r.id}')">${r.nombre} <span style="font-size:0.9em;color:var(--cat-bold);">(${r.categoria})</span></li>`).join('')}
        </ul></div>`;
    }

    // ====== FAVORITOS Y NOTAS ======
    function toggleFavorito(id) {
      if (favoritos.includes(id)) {
        favoritos = favoritos.filter(f => f !== id);
      } else {
        favoritos.push(id);
      }
      localStorage.setItem('favoritos', JSON.stringify(favoritos));
      renderVista('receta', id);
    }
    function renderFavoritos() {
      const main = document.getElementById('receta-detalle');
      const lista = recetas.filter(r=>favoritos.includes(r.id));
      main.innerHTML = `<h2 style="color:var(--titulo);font-weight:900;">Mis recetas estrella</h2>
        <div class="recetas-lista anim-fade"><ul>
          ${lista.length ? lista.map(r=>`<li onclick="navegarA('receta','${r.id}')">${r.nombre}</li>`).join('') : '<li>No tienes recetas favoritas a√∫n.</li>'}
        </ul></div>`;
      mostrarPanelTemporizadores();
    }
    document.getElementById('btn-favoritos').onclick = function(){
      renderFavoritos();
    };

    // ====== NOTAS Y OBSERVACIONES ======
    function renderNotas(recetaId, ampliado=false, volverRecetaDirecto=false) {
      const main = document.getElementById('receta-detalle');
      let nota = document.getElementById('nota-txt')?.value || notas[recetaId] || "";
      let cont = document.createElement('div');
      cont.className = ampliado ? 'nota-ampliada' : 'nota-seccion anim-fade';
      cont.innerHTML = `
        <label>Notas y Observaciones</label>
        <textarea id="nota-txt" style="font-size:${fuente}em;">${nota}</textarea>
        <div class="nota-btns">
          <button class="nota-btn" onclick="guardarNota('${recetaId}',${ampliado})">Guardar</button>
          <button class="nota-btn nota-btn-copiar" onclick="copiarNota('${recetaId}',${ampliado})">Copiar</button>
          <button class="nota-btn nota-btn-borrar" onclick="borrarNota('${recetaId}',${ampliado})">Borrar</button>
          <button class="nota-btn nota-btn-ampliar" ${ampliado?'style="display:none;"':''} onclick="renderNotas('${recetaId}',true)">Ampliar</button>
          <button class="nota-btn nota-btn-atras" onclick="renderNotas('${recetaId}',${!ampliado})">Atr√°s</button>
          <button class="nota-btn nota-btn-compartir" onclick="compartirNota('${recetaId}')">Compartir</button>
        </div>
        <div style="margin-top:9px;display:flex;align-items:center;gap:12px;">
          <span style="font-size:1em;">Fuente: </span>
          <button class="nota-btn" onclick="ajustaFuente(0.1)">A+</button>
          <button class="nota-btn" onclick="ajustaFuente(-0.1)">A-</button>
        </div>
      `;
      main.innerHTML = '';
      main.appendChild(cont);
      document.getElementById('nota-txt').focus();
      if (volverRecetaDirecto) setTimeout(()=>renderVista('receta', recetaId), 600);
    }
    window.guardarNota = function(id,ampliado){
      notas[id] = document.getElementById('nota-txt').value;
      localStorage.setItem('notas', JSON.stringify(notas));
      mostrarMensaje('Nota guardada');
      setTimeout(()=>{ renderVista('receta', id); }, 800);
    };
    window.copiarNota = function(id,ampliado){
      navigator.clipboard.writeText(document.getElementById('nota-txt').value);
      mostrarMensaje('Nota copiada');
    };
    window.borrarNota = function(id,ampliado){
      if(confirm('¬øSeguro que quieres borrar la nota?')){
        notas[id] = '';
        localStorage.setItem('notas', JSON.stringify(notas));
        document.getElementById('nota-txt').value = '';
        mostrarMensaje('Nota borrada');
      }
    };
    window.compartirNota = function(id){
      const txt = document.getElementById('nota-txt').value;
      if (navigator.share){
        navigator.share({title:'Nota de receta',text:txt});
      } else {
        mostrarMensaje('Tu dispositivo no soporta compartir nativo. Copiando texto al portapapeles.');
        navigator.clipboard.writeText(txt);
      }
    };
    window.ajustaFuente = function(delta){
      fuente = Math.max(1.05, Math.min(2.5, fuente+delta));
      document.getElementById('nota-txt').style.fontSize = fuente+"em";
    };
    function mostrarMensaje(txt){
      let m = document.createElement('div');
      m.innerHTML = txt;
      m.style.position='fixed';
      m.style.top='50%';
      m.style.left='50%';
      m.style.transform='translate(-50%,-50%)';
      m.style.background='var(--receta-final-bg)';
      m.style.color='var(--receta-final)';
      m.style.padding='18px 28px';
      m.style.fontSize='1.3em';
      m.style.fontWeight='bold';
      m.style.borderRadius='18px';
      m.style.boxShadow='0 2px 18px #0004';
      m.style.zIndex=9999;
      document.body.appendChild(m);
      setTimeout(()=>m.remove(),600);
    }

    // ====== TEMPORIZADORES MULTIPLES Y PITIDO ======
    function mostrarPanelTemporizadores() {
      const panel = document.getElementById('panel-temporizadores');
      panel.innerHTML = '';
      if (temporizadores.length === 0) {
        panel.style.display = 'none';
        return;
      }
      temporizadores.forEach((temp, idx) => {
        const restante = Math.max(0, Math.floor((temp.fin - Date.now())/1000));
        temp.tiempoRestante = restante;
        const div = document.createElement('div');
        div.className = 'panel-temporizador-item';
        div.innerHTML = `
          <span><strong>${temp.nombre}</strong> (${formatearTiempo(restante)})</span>
          <span class="panel-temporizador-btns">
            <button onclick="modificarTemporizador(${idx})">Modificar</button>
            <button onclick="cancelarTemporizador(${idx})">Cancelar</button>
            <button onclick="cerrarAvisoTemporizador(${idx})" ${temp.aviso ? '' : 'disabled'}>Cerrar aviso</button>
          </span>
        `;
        panel.appendChild(div);
      });
      if (pitidoActivo) {
        let btn = document.createElement('button');
        btn.innerText = "Detener pitido";
        btn.style = "margin-top:3px;font-size:1em;padding:7px 14px;background:#3A7BD5;color:white;border-radius:8px;border:none;";
        btn.onclick = detenerPitido;
        panel.appendChild(btn);
      }
      panel.style.display = 'block';
    }
    function formatearTiempo(segundos) {
      const min = Math.floor(segundos / 60);
      const sec = segundos % 60;
      return `${min}m ${sec}s`;
    }
    function crearTemporizador(minutos, recetaId) {
      const nombre = recetaId ? (recetas.find(r=>r.id===recetaId)?.nombre || "Temporizador") : "Temporizador";
      const seg = minutos * 60;
      const fin = Date.now() + seg*1000;
      const idx = temporizadores.length;
      temporizadores.push({
        id: Date.now() + "_" + Math.random().toString(36).slice(2),
        nombre, tiempoRestante: seg, recetaId, fin, aviso:false,
        interval: setInterval(() => tickTemporizador(idx), 1000)
      });
      guardarTemporizadores();
      mostrarPanelTemporizadores();
    }
    function tickTemporizador(idx) {
      if (!temporizadores[idx]) return;
      const restante = Math.max(0, Math.floor((temporizadores[idx].fin - Date.now())/1000));
      temporizadores[idx].tiempoRestante = restante;
      if (restante <= 0 && !temporizadores[idx].aviso) {
        temporizadores[idx].aviso = true;
        pitidoActivo = true;
        mostrarPanelTemporizadores();
        pitidoContinuo();
        mostrarMensaje(`¬°Tiempo terminado para: ${temporizadores[idx].nombre}!`);
      }
      mostrarPanelTemporizadores();
      guardarTemporizadores();
    }
    function modificarTemporizador(idx) {
      if (!temporizadores[idx]) return;
      let nuevo = prompt("¬øNuevo tiempo en minutos?", Math.ceil(temporizadores[idx].tiempoRestante/60));
      if (nuevo && !isNaN(nuevo)) {
        temporizadores[idx].fin = Date.now() + parseInt(nuevo)*60*1000;
        temporizadores[idx].tiempoRestante = parseInt(nuevo)*60;
        temporizadores[idx].aviso = false;
        guardarTemporizadores();
        mostrarPanelTemporizadores();
      }
    }
    function cancelarTemporizador(idx) {
      if (temporizadores[idx]) {
        clearInterval(temporizadores[idx].interval);
        temporizadores.splice(idx, 1);
        guardarTemporizadores();
        mostrarPanelTemporizadores();
      }
    }
    function cerrarAvisoTemporizador(idx) {
      if (temporizadores[idx]) {
        temporizadores[idx].aviso = false;
        pitidoActivo = false;
        detenerPitido();
        guardarTemporizadores();
        mostrarPanelTemporizadores();
      }
    }
    window.modificarTemporizador = modificarTemporizador;
    window.cancelarTemporizador = cancelarTemporizador;
    window.cerrarAvisoTemporizador = cerrarAvisoTemporizador;

    function pitidoContinuo(){
      if (!pitidoActivo) return;
      try {
        window._beepCtx = new (window.AudioContext || window.webkitAudioContext)();
        window._beepOsc = window._beepCtx.createOscillator();
        window._beepGain = window._beepCtx.createGain();
        window._beepOsc.type = "sine";
        window._beepOsc.frequency.value = 880;
        window._beepGain.gain.value = 0.3;
        window._beepOsc.connect(window._beepGain).connect(window._beepCtx.destination);
        window._beepOsc.start();
      } catch(e){}
    }
    function detenerPitido(){
      pitidoActivo = false;
      try{
        window._beepGain.gain.value = 0.0;
        window._beepOsc.stop();
        window._beepCtx.close();
      }catch(e){}
      mostrarPanelTemporizadores();
    }

    function guardarTemporizadores() {
      const toSave = temporizadores.map(t => ({
        id:t.id,
        nombre:t.nombre,
        tiempoRestante:t.tiempoRestante,
        recetaId:t.recetaId,
        aviso:t.aviso,
        fin:t.fin
      }));
      localStorage.setItem("temporizadores", JSON.stringify(toSave));
    }
    function cargarTemporizadores() {
      temporizadores = JSON.parse(localStorage.getItem("temporizadores") || "[]");
      temporizadores.forEach((t,idx) => {
        if (!t.interval) {
          t.interval = setInterval(() => tickTemporizador(idx), 1000);
        }
      });
      mostrarPanelTemporizadores();
    }

    // ====== TEMPORIZADOR PERSONALIZADO (DESPLEGABLE) ======
    function mostrarDesplegableTemporizador(recetaId) {
      let div = document.createElement('div');
      div.style.position = "fixed";
      div.style.top = "35%";
      div.style.left = "50%";
      div.style.transform = "translate(-50%,-50%)";
      div.style.background = "var(--fondo)";
      div.style.color = "var(--texto)";
      div.style.border = "2px solid var(--cat-bold)";
      div.style.zIndex = 5000;
      div.style.padding = "24px";
      div.style.borderRadius = "12px";
      div.innerHTML = `
        <div style="font-weight:900;font-size:1.2em;color:var(--cat-bold);margin-bottom:12px;">¬øCu√°ntos minutos quieres para el temporizador?</div>
        <select id="minutos-temp" style="font-size:1.15em;width:100%;margin-bottom:14px;">
          ${Array.from({length:90}, (_,i) => `<option value="${i+1}">${i+1} minutos</option>`).join('')}
        </select>
        <button onclick="crearTempDesdeDesplegable('${recetaId}')"
          style="width:100%;font-size:1.12em;padding:8px;background:var(--btn-bg);color:var(--btn-text);border-radius:8px;font-weight:900;margin-bottom:8px;">Crear temporizador</button>
        <button onclick="this.parentElement.remove()" style="width:100%;font-size:1em;padding:5px;background:#eee;color:var(--cat-bold);border-radius:8px;">Cancelar</button>
      `;
      document.body.appendChild(div);
    }
    function crearTempDesdeDesplegable(recetaId) {
      let min = parseInt(document.getElementById('minutos-temp').value);
      document.getElementById('minutos-temp').parentElement.remove();
      crearTemporizador(min, recetaId);
    }
    window.mostrarDesplegableTemporizador = mostrarDesplegableTemporizador;
    window.crearTempDesdeDesplegable = crearTempDesdeDesplegable;

    document.getElementById('btn-temp-personalizado').onclick = function() {
      mostrarDesplegableTemporizador(null);
    };

    // ====== RENDER PRINCIPAL Y RECETA ======
    function renderVista(pagina, id = null) {
      historialNavegacion.push({pagina, id});
      const main = document.getElementById('receta-detalle');
      let html = "";
      if(pagina === 'receta') {
        ultimaRecetaId = id;
        recetaActual = recetas.find(r => r.id === id);
        if (!recetaActual) { main.innerHTML = "<h2>Receta no encontrada</h2>"; return; }
        const personas = parseInt(document.getElementById('selector-personas').value);
        html += `
          <div class="receta-nombre">${recetaActual.nombre}
            <button class="favorito-btn ${favoritos.includes(id)?'fav':''}" onclick="toggleFavorito('${id}')">${favoritos.includes(id)?'‚òÖ':'‚òÜ'}</button>
          </div>
          <div class="info-extra">${recetaActual.categoria}</div>
          <div style="margin:8px 0 10px 0;">
            <button class="btn-timer" onclick="mostrarDesplegableTemporizador('${recetaActual.id}')">Temporizador de receta</button>
            <button class="btn-timer" onclick="compartirNota('${recetaActual.id}')">Compartir</button>
          </div>
          <div style="margin:14px 0 6px 0;font-weight:900;font-size:1.13em;">Ingredientes:</div>
          <ul class="ingredientes-lista" style="font-size:${fuente}em;">
            ${recetaActual.ingredientes?.map(i=>{
              let cantidad = i.cantidad * (personas/(recetaActual.porciones || 4 || 1));
              let textoCantidad = (Math.round(cantidad*100)/100) + " " + (i.unidad||"");
              return `<li>${i.nombre} <span style="color:var(--cat-bold);font-weight:900;">(${textoCantidad})</span></li>`;
            }).join('')}
          </ul>
          <div style="margin:14px 0 6px 0;font-weight:900;font-size:1.13em;">Elaboraci√≥n:</div>
          <ol class="elaboracion-lista" style="font-size:${fuente+0.07}em;">${recetaActual.elaboracion?.map(e=>`<li>${e}</li>`).join('')}</ol>
          <button class="btn-timer" onclick="renderNotas('${recetaActual.id}')">Notas personales</button>
        `;
        main.innerHTML = html;
        mostrarPanelTemporizadores();
      } else if (pagina === 'recetas') {
        const lista = recetas.filter(r => r.categoria === id);
        html += `<div class="categoria-nombre">${id}</div>
          <div class="recetas-lista anim-fade"><ul>
            ${lista.map(r=>`<li onclick="navegarA('receta','${r.id}')">${r.nombre}</li>`).join('')}
          </ul></div>`;
        main.innerHTML = html;
        mostrarPanelTemporizadores();
      } else if (pagina === 'categorias') {
        const categorias = [...new Set(recetas.map(r=>r.categoria))];
        html += `<h2 style="color:var(--titulo);font-weight:900;">Categor√≠as</h2>
          <div class="recetas-lista anim-fade"><ul>
            ${categorias.map(c=>`<li style="color:var(--cat-bold);" onclick="navegarA('recetas','${c}')">${c}</li>`).join('')}
          </ul></div>`;
        main.innerHTML = html;
        mostrarPanelTemporizadores();
      } else {
        main.innerHTML = `<h2 style="color:var(--titulo);font-weight:900;">Dulces Patxi</h2>
          <p class="bienvenida">Bienvenido. Selecciona una categor√≠a para comenzar.</p>
          <div class="by-yahya">By Yahya</div>`;
        mostrarPanelTemporizadores();
      }
      actualizarBotones();
    }
    window.navegarA = renderVista; // Para onclicks

    // ====== ATR√ÅS, ULTIMA RECETA, MENU, ACCESIBILIDAD ======
    document.getElementById('btn-menu').onclick = function() {
      renderVista('categorias');
    };
    document.getElementById('btn-atras').onclick = function() {
      if (historialNavegacion.length <= 1) return;
      historialNavegacion.pop();
      const last = historialNavegacion[historialNavegacion.length-1];
      renderVista(last.pagina, last.id);
      actualizarBotones();
    };
    document.getElementById('btn-ultima-receta').onclick = function() {
      if (ultimaRecetaId) renderVista('receta', ultimaRecetaId);
    };
    document.getElementById('selector-personas').onchange = function() {
      if (recetaActual) renderVista('receta', recetaActual.id);
    };
    document.getElementById('btn-oscuro').onclick = function() {
      document.body.classList.toggle('modo-oscuro');
    };
    function actualizarBotones() {
      document.getElementById('btn-atras').style.display = historialNavegacion.length > 1 ? '' : 'none';
      document.getElementById('btn-ultima-receta').style.display = ultimaRecetaId ? '' : 'none';
    }

    // ====== INICIO ======
    window.onload = function() {
      cargarTemporizadores();
      renderVista('categorias');
      actualizarBotones();
    };

    // ====== ACCESIBILIDAD: Fuente ajustable, modo alto contraste, teclado ======
    document.addEventListener('keydown',function(e){
      if (e.ctrlKey && e.key==='=') { fuente = Math.min(2.5, fuente+0.1); if(recetaActual) renderVista('receta', recetaActual.id);}
      if (e.ctrlKey && e.key==='-') { fuente = Math.max(1.05, fuente-0.1); if(recetaActual) renderVista('receta', recetaActual.id);}
      if(e.altKey && e.key==='m') { document.body.classList.toggle('modo-oscuro'); }
    });
  </script>
</body>
</html>

