<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dulces Patxi</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
  <style>
    :root{
      --fondo:#f6f4ff; --texto:#574b36; --primario:#6c3b8e; --accent:#f7b563;
      --input-bg:#fff; --input-txt:#222; --shadow:0 8px 30px rgba(0,0,0,.12);
    }
    .modo-oscuro{
      --fondo:#181621; --texto:#fffbe5; --primario:#b36f3c; --accent:#c47e43;
      --input-bg:#292542; --input-txt:#fff;
    }
    html,body{height:100%;margin:0;background:var(--fondo);color:var(--texto);font-family:Inter,Segoe UI,Arial,sans-serif;-webkit-font-smoothing:antialiased}
    .pantalla,.view{max-width:520px;margin:0 auto;width:100%;min-height:100vh;box-sizing:border-box;padding:22px 18px;display:flex;flex-direction:column;align-items:stretch;gap:12px}
    .titulo{font-weight:900;font-size:1.9rem;text-align:center;margin-top:8px;color:var(--primario)}
    .bienvenida{white-space:pre-line;text-align:center;font-weight:700}
    .buscador-row{position:relative;margin:6px 0}
    #buscador{width:100%;padding:12px 44px 12px 14px;border-radius:14px;border:2px solid rgba(0,0,0,.06);background:var(--input-bg);color:var(--input-txt);box-shadow:var(--shadow);font-weight:700}
    .icon-search{position:absolute;right:14px;top:12px;color:rgba(0,0,0,.35)}
    .btn{width:100%;padding:14px;border-radius:12px;border:0;font-weight:900;cursor:pointer;box-shadow:var(--shadow);font-size:1.03rem}
    .btn-prim{background:var(--primario);color:#fff}
    .btn-accent{background:var(--accent);color:#fff}
    .btn-mode{background:#3498db;color:#fff}
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.28);display:flex;align-items:center;justify-content:center;z-index:12000}
    .card{background:var(--input-bg);color:var(--input-txt);border-radius:12px;padding:16px;max-width:92vw;box-shadow:0 14px 44px rgba(0,0,0,.25)}
    .card h3{margin:0 0 10px}
    .modal-list{display:flex;flex-direction:column;gap:10px;margin:8px 0}
    .view{position:fixed;inset:0;overflow:auto;background:var(--fondo);padding:24px 18px;z-index:11000}
    .view-inner{max-width:520px;margin:0 auto}
    .view-back{display:inline-block;margin-bottom:12px;background:var(--primario);color:#fff;padding:8px 12px;border-radius:10px;border:0;font-weight:900;cursor:pointer}
    .view-title{font-weight:900;font-size:1.2rem;margin-bottom:8px;text-align:center}
    .section-card{background:var(--input-bg);padding:12px;border-radius:10px;box-shadow:var(--shadow)}
    .ingredientes-lista,.elaboracion-lista{padding:12px;border-radius:8px;box-shadow:var(--shadow);margin-bottom:10px}
    .temporizador-row{display:flex;gap:8px;align-items:center;justify-content:flex-end}
    .temporizador-dropdown{padding:6px 8px;border-radius:8px;border:1px solid rgba(0,0,0,.08);background:var(--input-bg);color:var(--input-txt)}
    .temporizador-controls{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
    .notas-footer{margin-top:20px;text-align:center}
    textarea{width:100%;min-height:260px;padding:10px;border-radius:10px;border:1px solid rgba(0,0,0,.06);resize:vertical}
    @media (max-width:560px){ .titulo{font-size:1.5rem} .btn{font-size:0.98rem} }
  </style>
</head>
<body>
  <div class="pantalla" id="pantalla-principal" aria-live="polite">
    <div class="titulo">Dulces Patxi</div>
    <div class="bienvenida">
Bienvenidos en Dulces de Bachir Krai
By  Yahya
    </div>

    <div class="buscador-row">
      <input id="buscador" placeholder="Buscar receta . . ." aria-label="Buscar receta" />
      <span class="icon-search"><i class="fas fa-search"></i></span>
    </div>

    <button id="btn-modo" class="btn btn-mode">Modo</button>
    <button id="btn-buscador-inteligente" class="btn btn-accent">Buscador inteligente</button>
    <button id="btn-menu" class="btn btn-prim">Menú</button>
    <button id="btn-favoritos" class="btn" style="background:#b36f3c;color:#fff">Recetas estrella</button>
    <button id="btn-notas" class="btn" style="background:#3cb36f;color:#fff">Notas personales</button>
  </div>

  



 <script>
    // === DATOS DE LAS RECETAS ===
    const recetas = [
           // === TARTAS DEL AYER ===
      {
        "id": "VARIOS 142",
        "nombre": "Tarta de Manzana",
        "categoria": "Tartas del Ayer",
        "ingredientes": [
          { "nombre": "Pasta sableaux o hojaldre", "cantidad": 1, "unidad": "masa" },
          { "nombre": "Crema pastelera", "cantidad": 250, "unidad": "gr" },
          { "nombre": "Manzanas reinetas", "cantidad": 4, "unidad": "unidades" },
          { "nombre": "Azúcar grano", "cantidad": 50, "unidad": "gr" },
          { "nombre": "Gelatina de manzana", "cantidad": 1, "unidad": "sobre" }
        ],
        "elaboracion": [
          "Rellenar un molde con pasta sableux y cocer en blanco con alubias.",
          "Retirar las alubias y rellenar con crema pastelera.",
          "Colocar manzana pelada y fileteada de forma decorativa.",
          "Espolvorear con azúcar y hornear a 190°C durante 35 minutos.",
          "Una vez fría, abrillantar con gelatina de manzana."
        ],
        "temperatura": 190,
        "tiempo": 35
      },
      {
        "id": "VARIOS 143",
        "nombre": "Tarta San Marcos",
        "categoria": "Tartas del Ayer",
        "ingredientes": [
          { "nombre": "Bizcocho corriente", "cantidad": 1, "unidad": "plancha" },
          { "nombre": "Almíbar para emborrachar", "cantidad": 200, "unidad": "ml" },
          { "nombre": "Nata montada", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Yema pastelera", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Azúcar en grano", "cantidad": 50, "unidad": "gr" },
          { "nombre": "Gelatina de manzana", "cantidad": 1, "unidad": "sobre" }
        ],
        "elaboracion": [
          "Montar la tarta: disco de bizcocho emborrachado.",
          "Capa de yema pastelera.",
          "Disco de bizcocho emborrachado.",
          "Capa de nata montada.",
          "Disco de bizcocho emborrachado.",
          "Extender yema pastelera, rociar con azúcar y quemar con soplete.",
          "Decorar laterales con nata y almendra granillo tostada.",
          "Abrillantar con gelatina de manzana."
        ]
      },
      {
        "id": "VARIOS 144",
        "nombre": "Tarta Tatin",
        "categoria": "Tartas del Ayer",
        "ingredientes": [
          { "nombre": "Azúcar", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 100, "unidad": "ml" },
          { "nombre": "Manzanas reinetas", "cantidad": 1, "unidad": "kg" },
          { "nombre": "Recortes de hojaldre", "cantidad": 1, "unidad": "cantidad suficiente" }
        ],
        "elaboracion": [
          "Baño de caramelo en molde: derretir azúcar con agua.",
          "Pelar, descorazonar y cortar manzanas por la mitad.",
          "Colocarlas en el molde con parte convexa hacia abajo.",
          "Cubrir con lámina de hojaldre, pinchar y hornear a 180°C."
        ],
        "temperatura": 180,
        "tiempo": 40
      },
      {
        "id": "VARIOS 146",
        "nombre": "Tarta de Queso",
        "categoria": "Tartas del Ayer",
        "ingredientes": [
          { "nombre": "Queso tipo Philadelphia", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Azúcar", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Huevos", "cantidad": 4, "unidad": "unidades" },
          { "nombre": "Nata líquida", "cantidad": 200, "unidad": "ml" },
          { "nombre": "Galletas trituradas", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Mantequilla", "cantidad": 100, "unidad": "gr" }
        ],
        "elaboracion": [
          "Mezclar galletas con mantequilla derretida y formar base.",
          "Batir queso con azúcar, añadir huevos uno a uno.",
          "Incorporar nata y verter sobre la base.",
          "Hornear a baño María a 160°C durante 50 minutos.",
          "Enfriar y refrigerar toda la noche."
        ],
        "temperatura": 160,
        "tiempo": 50
      },
      {
        "id": "VARIOS 147",
        "nombre": "Tarta de Yema Quemada",
        "categoria": "Tartas del Ayer",
        "ingredientes": [
          { "nombre": "Pasta sableaux", "cantidad": 1, "unidad": "masa" },
          { "nombre": "Yemas de huevo", "cantidad": 20, "unidad": "unidades" },
          { "nombre": "Azúcar", "cantidad": 600, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 250, "unidad": "ml" }
        ],
        "elaboracion": [
          "Preparar almíbar con azúcar y agua hasta punto de hebra fina.",
          "Incorporar yemas poco a poco sin dejar de remover.",
          "Verter sobre la masa sableaux previamente cocida.",
          "Cocer al horno suave hasta dorar ligeramente."
        ],
        "temperatura": 170,
        "tiempo": 25
      },
      {
        "id": "VARIOS 150",
        "nombre": "Tarta Sagarroz",
        "categoria": "Tartas del Ayer",
        "ingredientes": [
          { "nombre": "Bizcocho corriente", "cantidad": 1, "unidad": "plancha" },
          { "nombre": "Almíbar aromatizado con sidra", "cantidad": 200, "unidad": "ml" },
          { "nombre": "Nata montada", "cantidad": 400, "unidad": "gr" },
          { "nombre": "Compota de manzana", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Sidra", "cantidad": 100, "unidad": "ml" },
          { "nombre": "Gelatina de manzana", "cantidad": 1, "unidad": "sobre" }
        ],
        "elaboracion": [
          "Emborrar el bizcocho con almíbar de sidra.",
          "Rellenar con capas alternas de nata y compota.",
          "Cubrir con nata y abrillantar con gelatina."
        ]
      },
      {
        "id": "VARIOS 161",
        "nombre": "Tarta de Almendra",
        "categoria": "Tartas del Ayer",
        "ingredientes": [
          { "nombre": "Pasta quebrada", "cantidad": 1, "unidad": "masa" },
          { "nombre": "Azúcar", "cantidad": 250, "unidad": "gr" },
          { "nombre": "Almendra molida", "cantidad": 250, "unidad": "gr" },
          { "nombre": "Ralladura de limón", "cantidad": 1, "unidad": "unidad" },
          { "nombre": "Huevos", "cantidad": 3, "unidad": "unidades" },
          { "nombre": "Mantequilla", "cantidad": 250, "unidad": "gr" }
        ],
        "elaboracion": [
          "Forrar molde con pasta quebrada.",
          "Mezclar almendra, azúcar, ralladura, huevos y mantequilla.",
          "Verter sobre la base y hornear a 180°C durante 45 minutos."
        ],
        "temperatura": 180,
        "tiempo": 45
      },
      {
        "id": "VARIOS 158",
        "nombre": "Tarta de Frutas",
        "categoria": "Tartas del Ayer",
        "ingredientes": [
          { "nombre": "Dos discos de bizcocho", "cantidad": 2, "unidad": "unidades" },
          { "nombre": "Almíbar de emborrachar", "cantidad": 200, "unidad": "ml" },
          { "nombre": "Nata montada", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Yema de naranja", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Frutas variadas", "cantidad": 500, "unidad": "gr" }
        ],
        "elaboracion": [
          "Colocar un disco de bizcocho en molde de aro.",
          "Emborrarlo mínimamente.",
          "Rellenar abundantemente de nata.",
          "Colocar encima el otro disco de bizcocho y emborracharlo.",
          "Extender yema de naranja, rociar con azúcar y quemar.",
          "Abrillantar con gelatina de manzana.",
          "Colocar frutas decorativamente y abrillantar."
        ]
      },
      // === TARTAS PREMIUM ===
      {
        "id": "VARIOS 148",
        "nombre": "Tronco Navideño",
        "categoria": "Tartas Premium",
        "ingredientes": [
          { "nombre": "Bizcocho plancha", "cantidad": 1, "unidad": "unidad" },
          { "nombre": "Trufa", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Almíbar", "cantidad": 150, "unidad": "ml" },
          { "nombre": "Cobertura", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Mantequilla", "cantidad": 50, "unidad": "gr" },
          { "nombre": "Hojas de chocolate", "cantidad": 1, "unidad": "cantidad" },
          { "nombre": "Azúcar glass", "cantidad": 30, "unidad": "gr" },
          { "nombre": "Canela en polvo", "cantidad": 5, "unidad": "gr" }
        ],
        "elaboracion": [
          "Empapar el bizcocho con almíbar.",
          "Untar con trufa y enrollar con ayuda de papel sulfurizado.",
          "Abrillantar con cobertura mezclada con mantequilla.",
          "Crear textura de corteza con tenedor.",
          "Decorar con hojas de chocolate y canela."
        ]
      },
      {
        "id": "VARIOS 149",
        "nombre": "Tarta Selva Negra",
        "categoria": "Tartas Premium",
        "ingredientes": [
          { "nombre": "Bizcocho de chocolate", "cantidad": 1, "unidad": "plancha" },
          { "nombre": "Cherovia", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Kirsch", "cantidad": 200, "unidad": "ml" },
          { "nombre": "Nata montada", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Cacao en polvo", "cantidad": 50, "unidad": "gr" },
          { "nombre": "Cerezas en almíbar", "cantidad": 1, "unidad": "lata" }
        ],
        "elaboracion": [
          "Cortar el bizcocho en tres discos.",
          "Emborrar cada disco con Kirsch.",
          "Alternar capas de cherovia, nata y cerezas.",
          "Cubrir exterior con nata y espolvorear cacao.",
          "Decorar con cerezas y virutas de chocolate."
        ]
      },
      {
        "id": "VARIOS 151",
        "nombre": "Tarta Martínica",
        "categoria": "Tartas Premium",
        "ingredientes": [
          { "nombre": "Pasta sableaux", "cantidad": 1, "unidad": "masa" },
          { "nombre": "Crema pastelera", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Piña natural", "cantidad": 1, "unidad": "unidad" },
          { "nombre": "Ron", "cantidad": 50, "unidad": "ml" },
          { "nombre": "Nata montada", "cantidad": 200, "unidad": "gr" }
        ],
        "elaboracion": [
          "Forrar molde con pasta sableaux y cocer en blanco.",
          "Rellenar con crema pastelera y piña macerada en ron.",
          "Cubrir con nata y decorar con trozos de piña."
        ]
      },
      {
        "id": "VARIOS 152",
        "nombre": "Tarta de Moka",
        "categoria": "Tartas Premium",
        "ingredientes": [
          { "nombre": "Bizcocho genovés", "cantidad": 1, "unidad": "plancha" },
          { "nombre": "Café expreso", "cantidad": 200, "unidad": "ml" },
          { "nombre": "Mascarpone", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Azúcar glass", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Chocolate negro", "cantidad": 100, "unidad": "gr" }
        ],
        "elaboracion": [
          "Emborrar el bizcocho con café.",
          "Mezclar mascarpone con azúcar y cubrir el bizcocho.",
          "Rallar chocolate y espolvorear por encima."
        ]
      },
      {
        "id": "VARIOS 153",
        "nombre": "Tarta Ópera",
        "categoria": "Tartas Premium",
        "ingredientes": [
          { "nombre": "Bizcocho joconde", "cantidad": 3, "unidad": "discos" },
          { "nombre": "Café concentrado", "cantidad": 150, "unidad": "ml" },
          { "nombre": "Crema de moka", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Cobertura de chocolate", "cantidad": 200, "unidad": "gr" }
        ],
        "elaboracion": [
          "Alternar capas de bizcocho empapado en café y crema de moka.",
          "Cubrir con cobertura de chocolate brillante."
        ]
      },
      {
        "id": "VARIOS 154",
        "nombre": "Tarta Ponche Genovés",
        "categoria": "Tartas Premium",
        "ingredientes": [
          { "nombre": "Bizcocho genovés", "cantidad": 1, "unidad": "plancha" },
          { "nombre": "Almíbar de vino de Málaga", "cantidad": 200, "unidad": "ml" },
          { "nombre": "Crema pastelera", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Nata montada", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Chantilly", "cantidad": 200, "unidad": "gr" }
        ],
        "elaboracion": [
          "Cortar el bizcocho en dos capas.",
          "Emborrar con almíbar de vino de Málaga.",
          "Rellenar con crema pastelera y nata.",
          "Cubrir con chantilly y decorar con guindas."
        ]
      },
      {
        "id": "VARIOS 155",
        "nombre": "Tarta Mascota",
        "categoria": "Tartas Premium",
        "ingredientes": [
          { "nombre": "Bizcocho molde", "cantidad": 1, "unidad": "unidad" },
          { "nombre": "Almíbar de emborrachar", "cantidad": 200, "unidad": "ml" },
          { "nombre": "Crema de mantequilla", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Almendra fileteada", "cantidad": 100, "unidad": "gr" }
        ],
        "elaboracion": [
          "Partimos de un bizcocho relleno de crema de mantequilla.",
          "Cubrimos la superficie y los laterales con crema de mantequilla.",
          "Aplanamos con espátula.",
          "Decoramos con almendra fileteada."
        ]
      },
      {
        "id": "VARIOS 156",
        "nombre": "Terrina de Frutas",
        "categoria": "Tartas Premium",
        "ingredientes": [
          { "nombre": "Plancha de bizcocho", "cantidad": 1, "unidad": "unidad" },
          { "nombre": "Mantequilla", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Azúcar lustre", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Almendra molida", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Nata líquida", "cantidad": 300, "unidad": "ml" },
          { "nombre": "Kiwi", "cantidad": 3, "unidad": "unidades" },
          { "nombre": "Fresas", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Melocotón en almíbar", "cantidad": 200, "unidad": "gr" }
        ],
        "elaboracion": [
          "Forrar molde con film transparente.",
          "Colocar capa de bizcocho.",
          "Rellenar con mezcla de mantequilla, azúcar, almendra y nata.",
          "Añadir frutas cortadas.",
          "Congelar y desmoldar."
        ]
      },
      {
        "id": "VARIOS 157",
        "nombre": "Tarta de Enrejado",
        "categoria": "Tartas Premium",
        "ingredientes": [
          { "nombre": "Recortes de hojaldre", "cantidad": 1, "unidad": "masa" },
          { "nombre": "Crema pastelera", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Frambuesas", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Gelatina de manzana", "cantidad": 1, "unidad": "sobre" }
        ],
        "elaboracion": [
          "Forrar molde con hojaldre.",
          "Rellenar con crema pastelera.",
          "Colocar frambuesas.",
          "Hacer rejilla con tiras de hojaldre.",
          "Hornear a 180°C.",
          "Abrillantar con gelatina."
        ],
        "temperatura": 180,
        "tiempo": 35
      },
      {
        "id": "VARIOS 159",
        "nombre": "Tarta de Chocolatina",
        "categoria": "Tartas Premium",
        "ingredientes": [
          { "nombre": "Bizcocho genovés", "cantidad": 1, "unidad": "plancha" },
          { "nombre": "Almíbar de café", "cantidad": 200, "unidad": "ml" },
          { "nombre": "Trufa negra", "cantidad": 400, "unidad": "gr" },
          { "nombre": "Virutas de chocolate", "cantidad": 100, "unidad": "gr" }
        ],
        "elaboracion": [
          "Cortar bizcocho en dos capas.",
          "Emborrar con almíbar de café.",
          "Rellenar con trufa negra.",
          "Cubrir con trufa y decorar con virutas."
        ]
      },
      // === BIZCOCHOS, MAGDALENAS & MUFFINS ===
      {
        "id": "VARIOS 67",
        "nombre": "Sobao Pasiego",
        "categoria": "Bizcochos, Magdalenas & Muffins",
        "ingredientes": [
          { "nombre": "Mantequilla", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Azúcar glasé", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Huevos", "cantidad": 15, "unidad": "unidades" },
          { "nombre": "Ron", "cantidad": 50, "unidad": "ml" },
          { "nombre": "Harina floja", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Impulsor", "cantidad": 10, "unidad": "gr" }
        ],
        "elaboracion": [
          "Batir mantequilla con azúcar, añadir huevos uno a uno.",
          "Incorporar harina con impulsor, ron y mezclar delicadamente.",
          "Hornear a 180°C."
        ],
        "temperatura": 180,
        "tiempo": 30
      },
      {
        "id": "VARIOS 202",
        "nombre": "San Blas",
        "categoria": "Bizcochos, Magdalenas & Muffins",
        "ingredientes": [
          { "nombre": "Harina", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Azúcar", "cantidad": 250, "unidad": "gr" },
          { "nombre": "Huevos", "cantidad": 5, "unidad": "unidades" },
          { "nombre": "Mantequilla", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Leche", "cantidad": 100, "unidad": "ml" },
          { "nombre": "Impulsor", "cantidad": 10, "unidad": "gr" }
        ],
        "elaboracion": [
          "Batir mantequilla con azúcar, añadir huevos uno a uno.",
          "Incorporar harina con impulsor y leche.",
          "Hornear a 180°C durante 25 minutos."
        ],
        "temperatura": 180,
        "tiempo": 25
      },
      {
        "id": "VARIOS 58",
        "nombre": "Bizcocho de Chocolate",
        "categoria": "Bizcochos, Magdalenas & Muffins",
        "ingredientes": [
          { "nombre": "Huevos", "cantidad": 4, "unidad": "unidades" },
          { "nombre": "Azúcar", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Harina", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Cacao en polvo", "cantidad": 50, "unidad": "gr" },
          { "nombre": "Mantequilla", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Leche", "cantidad": 100, "unidad": "ml" },
          { "nombre": "Impulsor", "cantidad": 10, "unidad": "gr" }
        ],
        "elaboracion": [
          "Batir huevos con azúcar hasta doblar volumen.",
          "Añadir harina, cacao, mantequilla derretida, leche e impulsor.",
          "Hornear a 180°C durante 30 minutos."
        ],
        "temperatura": 180,
        "tiempo": 30
      },
      {
        "id": "VARIOS 59",
        "nombre": "Bizcocho de Naranja",
        "categoria": "Bizcochos, Magdalenas & Muffins",
        "ingredientes": [
          { "nombre": "Huevos", "cantidad": 4, "unidad": "unidades" },
          { "nombre": "Azúcar", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Harina", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Zumo de naranja", "cantidad": 100, "unidad": "ml" },
          { "nombre": "Ralladura de naranja", "cantidad": 1, "unidad": "unidad" },
          { "nombre": "Mantequilla", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Impulsor", "cantidad": 10, "unidad": "gr" }
        ],
        "elaboracion": [
          "Batir huevos con azúcar hasta doblar volumen.",
          "Añadir harina, zumo, ralladura, mantequilla derretida e impulsor.",
          "Hornear a 180°C durante 30 minutos."
        ],
        "temperatura": 180,
        "tiempo": 30
      },
      {
        "id": "VARIOS 68",
        "nombre": "Magdalenas",
        "categoria": "Bizcochos, Magdalenas & Muffins",
        "ingredientes": [
          { "nombre": "Huevos", "cantidad": 10, "unidad": "unidades" },
          { "nombre": "Azúcar", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Harina", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Mantequilla", "cantidad": 250, "unidad": "gr" },
          { "nombre": "Leche", "cantidad": 100, "unidad": "ml" },
          { "nombre": "Impulsor", "cantidad": 10, "unidad": "gr" }
        ],
        "elaboracion": [
          "Batir huevos con azúcar hasta doblar volumen.",
          "Incorporar harina, mantequilla derretida, leche e impulsor.",
          "Escudillar en moldes y hornear a 180°C durante 20 minutos."
        ],
        "temperatura": 180,
        "tiempo": 20
      },
      {
        "id": "VARIOS 61",
        "nombre": "Bizcocho de Manzana",
        "categoria": "Bizcochos, Magdalenas & Muffins",
        "ingredientes": [
          { "nombre": "Huevos", "cantidad": 4, "unidad": "unidades" },
          { "nombre": "Azúcar", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Harina", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Manzanas", "cantidad": 2, "unidad": "unidades" },
          { "nombre": "Mantequilla", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Impulsor", "cantidad": 10, "unidad": "gr" }
        ],
        "elaboracion": [
          "Batir huevos con azúcar hasta doblar volumen.",
          "Añadir harina, manzana rallada, mantequilla derretida e impulsor.",
          "Hornear a 180°C durante 30 minutos."
        ],
        "temperatura": 180,
        "tiempo": 30
      },
      {
        "id": "VARIOS 60",
        "nombre": "Bizcocho de Coco",
        "categoria": "Bizcochos, Magdalenas & Muffins",
        "ingredientes": [
          { "nombre": "Huevos", "cantidad": 4, "unidad": "unidades" },
          { "nombre": "Azúcar", "cantidad": 400, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 200, "unidad": "cc" },
          { "nombre": "Harina", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Levadura royal", "cantidad": 1, "unidad": "sobre" },
          { "nombre": "Coco rallado", "cantidad": 50, "unidad": "gr" }
        ],
        "elaboracion": [
          "Batir huevos con azúcar, agregar agua hirviendo, harina, levadura y coco.",
          "Verter en molde engrasado y enharinado.",
          "Hornear a fuego lento los primeros 10 minutos, luego aumentar temperatura."
        ],
        "tiempo": 50
      },
      {
        "id": "VARIOS 195",
        "nombre": "Coquitos",
        "categoria": "Bizcochos, Magdalenas & Muffins",
        "ingredientes": [
          { "nombre": "Huevos", "cantidad": 3, "unidad": "unidades" },
          { "nombre": "Azúcar", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Coco rallado", "cantidad": 250, "unidad": "gr" }
        ],
        "elaboracion": [
          "Mezclar ingredientes y dejar reposar en frigorífico.",
          "Formar bolas pequeñas y hornear a horno fuerte 20 minutos."
        ],
        "temperatura": 190,
        "tiempo": 20
      },
      {
        "id": "VARIOS 196",
        "nombre": "Macarrón de Almendra",
        "categoria": "Bizcochos, Magdalenas & Muffins",
        "ingredientes": [
          { "nombre": "Almendra molida", "cantidad": 480, "unidad": "gr" },
          { "nombre": "Azúcar grano", "cantidad": 400, "unidad": "gr" },
          { "nombre": "Claritas", "cantidad": 180, "unidad": "gr" }
        ],
        "elaboracion": [
          "Mezclar todos los ingredientes hasta formar una masa homogénea.",
          "Escudillar con manga sobre placa.",
          "Secar a 40-50°C durante varias horas.",
          "Cocer a 140°C cuando estén secos."
        ],
        "temperatura": 140,
        "tiempo": 15
      },
      {
        "id": "VARIOS 199",
        "nombre": "Empiñonadas",
        "categoria": "Bizcochos, Magdalenas & Muffins",
        "ingredientes": [
          { "nombre": "Almendra molida", "cantidad": 250, "unidad": "gr" },
          { "nombre": "Azúcar lustre", "cantidad": 225, "unidad": "gr" },
          { "nombre": "Claras de huevo", "cantidad": 1, "unidad": "cantidad" },
          { "nombre": "Piñones", "cantidad": 100, "unidad": "gr" }
        ],
        "elaboracion": [
          "Mezclar almendra, azúcar y claras.",
          "Formar bolas, rebozar con piñones.",
          "Cocer a horno a 180-200°C."
        ],
        "temperatura": 190,
        "tiempo": 18
      },
      // === DULCES & CONFITES ===
      {
        "id": "VARIOS 173",
        "nombre": "Trufa Negra",
        "categoria": "Dulces & Confites",
        "ingredientes": [
          { "nombre": "Nata", "cantidad": 350, "unidad": "gr" },
          { "nombre": "Cobertura negra", "cantidad": 650, "unidad": "gr" },
          { "nombre": "Cognac", "cantidad": 2, "unidad": "cda" }
        ],
        "elaboracion": [
          "Calentar la nata y verter sobre la cobertura.",
          "Disolver con espátula, añadir cognac.",
          "Dejar enfriar, hacer bolas y bañar en cobertura o cacao."
        ]
      },
      {
        "id": "VARIOS 48",
        "nombre": "Trufa Cocida",
        "categoria": "Dulces & Confites",
        "ingredientes": [
          { "nombre": "Nata líquida", "cantidad": 1000, "unidad": "ml" },
          { "nombre": "Cobertura negra", "cantidad": 140, "unidad": "gr" },
          { "nombre": "Azúcar", "cantidad": 150, "unidad": "gr" }
        ],
        "elaboracion": [
          "Mezclar todos los ingredientes y llevar al fuego hasta disolver la cobertura.",
          "Enfriar en cámara toda la noche.",
          "Al día siguiente, montar con varilla hasta obtener textura cremosa.",
          "Formar bolas y rodar en cacao en polvo."
        ]
      },
      {
        "id": "VARIOS 49",
        "nombre": "Trufa Cocida Blanca",
        "categoria": "Dulces & Confites",
        "ingredientes": [
          { "nombre": "Nata líquida", "cantidad": 1000, "unidad": "ml" },
          { "nombre": "Cobertura blanca", "cantidad": 400, "unidad": "gr" }
        ],
        "elaboracion": [
          "Cocer de víspera la nata con la cobertura.",
          "Enfriar en cámara y al día siguiente proceder a montarla."
        ]
      },
      {
        "id": "VARIOS 50",
        "nombre": "Toffe",
        "categoria": "Dulces & Confites",
        "ingredientes": [
          { "nombre": "Nata líquida", "cantidad": 1000, "unidad": "ml" },
          { "nombre": "Azúcar", "cantidad": 250, "unidad": "gr" }
        ],
        "elaboracion": [
          "Hacer caramelo rubio con azúcar.",
          "Añadir nata caliente con cuidado.",
          "Hervir hasta disolución completa.",
          "Usar como salsa o montar al día siguiente."
        ]
      },
      {
        "id": "VARIOS 178",
        "nombre": "Mazapán",
        "categoria": "Dulces & Confites",
        "ingredientes": [
          { "nombre": "Almendra molida", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Azúcar", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 200, "unidad": "ml" },
          { "nombre": "Glucosa", "cantidad": 100, "unidad": "gr" }
        ],
        "elaboracion": [
          "Mezclar todos los ingredientes hasta formar una masa homogénea.",
          "Amasar y moldear como se desee.",
          "Secar al aire o en horno muy bajo."
        ]
      },
      {
        "id": "VARIOS 180",
        "nombre": "Turrón de Yema",
        "categoria": "Dulces & Confites",
        "ingredientes": [
          { "nombre": "Nata", "cantidad": 125, "unidad": "gr" },
          { "nombre": "Azúcar", "cantidad": 125, "unidad": "gr" },
          { "nombre": "Yemas", "cantidad": 9, "unidad": "unidades" },
          { "nombre": "Almíbar", "cantidad": 1, "unidad": "kilo" },
          { "nombre": "Almendra molida", "cantidad": 1, "unidad": "kilo" },
          { "nombre": "Glucosa", "cantidad": 50, "unidad": "gr" },
          { "nombre": "Vainillina", "cantidad": 1, "unidad": "cda" }
        ],
        "elaboracion": [
          "Elaborar almíbar a punto de bola floja.",
          "Mezclar con yemas, nata, almendra y glucosa.",
          "Moldear y enfriar."
        ]
      },
      {
        "id": "VARIOS 182",
        "nombre": "Turrón de Coco",
        "categoria": "Dulces & Confites",
        "ingredientes": [
          { "nombre": "Almíbar", "cantidad": 1, "unidad": "kilo" },
          { "nombre": "Agua", "cantidad": 350, "unidad": "gr" },
          { "nombre": "Coco rallado", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Almendra molida", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Glucosa", "cantidad": 125, "unidad": "gr" }
        ],
        "elaboracion": [
          "Hacer almíbar con azúcar, agua y glucosa.",
          "Añadir coco y almendra.",
          "Verter en molde, enfriar y cortar."
        ]
      },
      {
        "id": "VARIOS 183",
        "nombre": "Turrón de Pistachos",
        "categoria": "Dulces & Confites",
        "ingredientes": [
          { "nombre": "Almíbar", "cantidad": 1, "unidad": "kilo" },
          { "nombre": "Agua", "cantidad": 330, "unidad": "gr" },
          { "nombre": "Pistachos molidos", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Almendra molida", "cantidad": 500, "unidad": "gr" }
        ],
        "elaboracion": [
          "Hacer almíbar a punto de hebra floja.",
          "Mezclar con pistachos y almendra.",
          "Moldear, prensar y reposar."
        ]
      },
      {
        "id": "VARIOS 184",
        "nombre": "Guirlache",
        "categoria": "Dulces & Confites",
        "ingredientes": [
          { "nombre": "Azúcar", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Manteca de cerdo", "cantidad": 10, "unidad": "gr" },
          { "nombre": "Canela", "cantidad": 5, "unidad": "gr" },
          { "nombre": "Zumo de limón", "cantidad": 1, "unidad": "chorro" },
          { "nombre": "Almendras marcona", "cantidad": 450, "unidad": "gr" }
        ],
        "elaboracion": [
          "Hacer caramelo rubio con azúcar, manteca, canela y limón.",
          "Añadir almendras tostadas.",
          "Extender sobre mármol engrasado.",
          "Cortar en barritas antes de enfriar."
        ]
      },
      {
        "id": "VARIOS 181",
        "nombre": "Turrón de Nata Nuez",
        "categoria": "Dulces & Confites",
        "ingredientes": [
          { "nombre": "Nata", "cantidad": 400, "unidad": "gr" },
          { "nombre": "Azúcar", "cantidad": 1125, "unidad": "gr" },
          { "nombre": "Almendra molida", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Nueces", "cantidad": 750, "unidad": "gr" },
          { "nombre": "Vainillina", "cantidad": 1, "unidad": "cda" }
        ],
        "elaboracion": [
          "Hervir nata con azúcar, añadir almendra, nueces y vainillina.",
          "Moldear, prensar y dejar reposar mínimo un día."
        ]
      },
      // === MASAS & PASTELES ===
      {
        "id": "VARIOS 75",
        "nombre": "Hojaldre (Fórmula Tradicional)",
        "categoria": "Masas & Pasteles",
        "ingredientes": [
          { "nombre": "Harina fuerte", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 600, "unidad": "gr" },
          { "nombre": "Sal", "cantidad": 20, "unidad": "gr" },
          { "nombre": "Manteca de cerdo o mantequilla", "cantidad": 600, "unidad": "gr" }
        ],
        "elaboracion": [
          "Mezclar harina, agua y sal. Formar un plastón.",
          "Enfriar 30 minutos.",
          "Estirar y colocar la grasa en el centro. Doblar como libro.",
          "Repetir 3-4 vueltas simples, refrigerando entre cada una."
        ]
      },
      {
        "id": "VARIOS 83",
        "nombre": "Palmeras",
        "categoria": "Masas & Pasteles",
        "ingredientes": [
          { "nombre": "Plastón de hojaldre", "cantidad": 1, "unidad": "masa" },
          { "nombre": "Azúcar en grano", "cantidad": 200, "unidad": "gr" }
        ],
        "elaboracion": [
          "Hacer una masa de hojaldre a la que se dan 6 pliegues sencillos.",
          "En el último pliegue espolvorear con azúcar en grano y estirar.",
          "Se monta la masa tres veces por cada lado, juntar y cortar en palmeras.",
          "Hornear a 200-210°C hasta dorar."
        ],
        "temperatura": 205,
        "tiempo": 22
      },
      {
        "id": "VARIOS 187",
        "nombre": "Cigarrillos Rusos",
        "categoria": "Masas & Pasteles",
        "ingredientes": [
          { "nombre": "Hojaldre", "cantidad": 1, "unidad": "masa" },
          { "nombre": "Azúcar glass", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Clara de huevo", "cantidad": 1, "unidad": "unidad" }
        ],
        "elaboracion": [
          "Estirar el hojaldre muy fino y pintar con clara de huevo.",
          "Espolvorear con azúcar glass.",
          "Enrollar como si fuera un brazo de gitano y cortar en rodajas finas.",
          "Hornear a 200°C hasta dorar."
        ],
        "temperatura": 200,
        "tiempo": 15
      },
      {
        "id": "VARIOS 190",
        "nombre": "Lenguas de Gato",
        "categoria": "Masas & Pasteles",
        "ingredientes": [
          { "nombre": "Mantequilla", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Azúcar glass", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Harina", "cantidad": 200, "unidad": "gr" }
        ],
        "elaboracion": [
          "Batir mantequilla con azúcar glass.",
          "Incorporar harina con espátula.",
          "Escudillar en boquilla rizada.",
          "Hornear a 180°C sin abrir el horno."
        ],
        "temperatura": 180,
        "tiempo": 12
      },
      // === POSTRES FRÍOS ===
      {
        "id": "VARIOS 13",
        "nombre": "Flan de Chocolate",
        "categoria": "Postres Fríos",
        "ingredientes": [
          { "nombre": "Leche", "cantidad": 250, "unidad": "ml" },
          { "nombre": "Nata líquida", "cantidad": 250, "unidad": "ml" },
          { "nombre": "Azúcar", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Cobertura negra", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Huevos", "cantidad": 6, "unidad": "unidades" },
          { "nombre": "Salsa de caramelo", "cantidad": 1, "unidad": "cantidad" }
        ],
        "elaboracion": [
          "Mezclar leche, nata, azúcar y cobertura fundida.",
          "Añadir huevos batidos.",
          "Verter en moldes con caramelo.",
          "Cocer al baño María a 160°C durante 45 minutos.",
          "Enfriar y desmoldar."
        ],
        "temperatura": 160,
        "tiempo": 45
      },
      {
        "id": "VARIOS 25",
        "nombre": "Compota de Manzana",
        "categoria": "Postres Fríos",
        "ingredientes": [
          { "nombre": "Manzanas", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Azúcar", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Vino blanco", "cantidad": 250, "unidad": "ml" },
          { "nombre": "Orejones", "cantidad": 50, "unidad": "gr" },
          { "nombre": "Pasas", "cantidad": 30, "unidad": "gr" }
        ],
        "elaboracion": [
          "Pelar y cortar manzanas.",
          "Cocer con azúcar, vino y frutas secas.",
          "Dejar enfriar antes de servir."
        ]
      },
      {
        "id": "VARIOS 26",
        "nombre": "Peras en Almíbar",
        "categoria": "Postres Fríos",
        "ingredientes": [
          { "nombre": "Peras", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Vino blanco", "cantidad": 500, "unidad": "ml" },
          { "nombre": "Azúcar", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 500, "unidad": "ml" },
          { "nombre": "Canela en rama", "cantidad": 1, "unidad": "unidad" },
          { "nombre": "Cáscara de limón", "cantidad": 1, "unidad": "unidad" }
        ],
        "elaboracion": [
          "Pelar peras y mantener en agua con limón.",
          "Hervir agua, vino, azúcar, canela y limón.",
          "Añadir peras y cocer a fuego lento 20-30 min.",
          "Dejar enfriar en el almíbar."
        ],
        "tiempo": 25
      },
      {
        "id": "VARIOS 27",
        "nombre": "Arroz con Leche",
        "categoria": "Postres Fríos",
        "ingredientes": [
          { "nombre": "Arroz", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Leche", "cantidad": 1000, "unidad": "ml" },
          { "nombre": "Azúcar", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Canela en rama", "cantidad": 1, "unidad": "unidad" },
          { "nombre": "Cáscara de limón", "cantidad": 1, "unidad": "unidad" },
          { "nombre": "Vainilla", "cantidad": 1, "unidad": "unidad" }
        ],
        "elaboracion": [
          "Cocer el arroz en leche con azúcar, canela, limón y vainilla.",
          "Dejar enfriar y servir frío con canela por encima."
        ]
      },
      {
        "id": "VARIOS 28",
        "nombre": "Leche Frita",
        "categoria": "Postres Fríos",
        "ingredientes": [
          { "nombre": "Leche", "cantidad": 1000, "unidad": "ml" },
          { "nombre": "Harina", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Azúcar", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Canela", "cantidad": 10, "unidad": "gr" },
          { "nombre": "Aceite para freír", "cantidad": 500, "unidad": "ml" }
        ],
        "elaboracion": [
          "Cocer leche con azúcar, canela y harina hasta espesar.",
          "Enfriar, cortar en dados y freír.",
          "Espolvorear con azúcar y canela."
        ]
      },
      {
        "id": "VARIOS 29",
        "nombre": "Torrijas",
        "categoria": "Postres Fríos",
        "ingredientes": [
          { "nombre": "Pan de brioche", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Leche", "cantidad": 500, "unidad": "ml" },
          { "nombre": "Huevos", "cantidad": 3, "unidad": "unidades" },
          { "nombre": "Azúcar", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Canela", "cantidad": 10, "unidad": "gr" },
          { "nombre": "Aceite", "cantidad": 300, "unidad": "ml" }
        ],
        "elaboracion": [
          "Remojar pan en leche con canela y azúcar.",
          "Pasar por huevo y freír.",
          "Espolvorear con azúcar y canela."
        ]
      },
      {
        "id": "VARIOS 30",
        "nombre": "Goxua",
        "categoria": "Postres Fríos",
        "ingredientes": [
          { "nombre": "Bizcocho corriente", "cantidad": 1, "unidad": "plancha" },
          { "nombre": "Crema pastelera", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Nata montada", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Caramelo", "cantidad": 100, "unidad": "gr" }
        ],
        "elaboracion": [
          "Cortar el bizcocho en cuadrados.",
          "Rellenar con crema y nata.",
          "Baño de caramelo por encima."
        ]
      },
      {
        "id": "VARIOS 31",
        "nombre": "Pastel Vasco",
        "categoria": "Postres Fríos",
        "ingredientes": [
          { "nombre": "Harina", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Azúcar", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Mantequilla", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Huevos", "cantidad": 4, "unidad": "unidades" },
          { "nombre": "Crema pastelera", "cantidad": 400, "unidad": "gr" }
        ],
        "elaboracion": [
          "Mezclar harina, azúcar, mantequilla y huevos hasta formar masa.",
          "Forrar molde y rellenar con crema pastelera.",
          "Hornear a 180°C durante 40 minutos."
        ],
        "temperatura": 180,
        "tiempo": 40
      },
      // === HELADOS & SORBETES ===
      {
        "id": "VARIOS 100",
        "nombre": "Sorbete de Limón al Champán",
        "categoria": "Helados & Sorbetes",
        "ingredientes": [
          { "nombre": "Almíbar a 28°Brix", "cantidad": 1, "unidad": "litro" },
          { "nombre": "Zumo de limón", "cantidad": 1, "unidad": "litro" }
        ],
        "elaboracion": [
          "Mezclar ambos ingredientes y enfriar bien.",
          "Introducir en heladora y dejar congelar."
        ]
      },
      {
        "id": "VARIOS 105",
        "nombre": "Sorbete de Limón",
        "categoria": "Helados & Sorbetes",
        "ingredientes": [
          { "nombre": "Zumo de limón", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Azúcar", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Glucosa", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Maicena", "cantidad": 20, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 480, "unidad": "gr" }
        ],
        "elaboracion": [
          "Mezclar sacarosa con maicena, añadir agua y cocer.",
          "Enfriar, añadir zumo y helar."
        ]
      },
      {
        "id": "VARIOS 118",
        "nombre": "Mousse de Cava",
        "categoria": "Helados & Sorbetes",
        "ingredientes": [
          { "nombre": "Cava", "cantidad": 750, "unidad": "ml" },
          { "nombre": "Azúcar", "cantidad": 360, "unidad": "gr" },
          { "nombre": "Gelatina", "cantidad": 24, "unidad": "gr" },
          { "nombre": "Yemas", "cantidad": 3, "unidad": "unidades" },
          { "nombre": "Nata líquida", "cantidad": 400, "unidad": "ml" }
        ],
        "elaboracion": [
          "Calentar cava con azúcar y gelatina.",
          "Añadir yemas, enfriar y mezclar con nata montada.",
          "Congelar."
        ]
      },
      {
        "id": "VARIOS 97",
        "nombre": "Sorbete de Naranja",
        "categoria": "Helados & Sorbetes",
        "ingredientes": [
          { "nombre": "Agua", "cantidad": 250, "unidad": "ml" },
          { "nombre": "Azúcar", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Ralladura de naranja", "cantidad": 1, "unidad": "cantidad" },
          { "nombre": "Zumo de naranja", "cantidad": 500, "unidad": "ml" },
          { "nombre": "Clara de huevo", "cantidad": 1, "unidad": "unidad" }
        ],
        "elaboracion": [
          "Hacer almíbar con agua y azúcar.",
          "Añadir ralladura, zumo y clara batida.",
          "Congelar en heladora."
        ]
      },
      {
        "id": "VARIOS 106",
        "nombre": "Bavarois de Chocolate",
        "categoria": "Helados & Sorbetes",
        "ingredientes": [
          { "nombre": "Chocolate negro", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Leche", "cantidad": 500, "unidad": "ml" },
          { "nombre": "Azúcar", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Huevos", "cantidad": 4, "unidad": "unidades" },
          { "nombre": "Gelatina", "cantidad": 10, "unidad": "gr" }
        ],
        "elaboracion": [
          "Derretir chocolate con leche y azúcar.",
          "Añadir yemas, gelatina reblandecida.",
          "Montar claras y nata, incorporar.",
          "Enmoldar y refrigerar."
        ]
      },
      // === RELLENOS & COBERTURAS ===
      {
        "id": "VARIOS 221",
        "nombre": "Coulis de Frutos Rojos",
        "categoria": "Rellenos & Coberturas",
        "ingredientes": [
          { "nombre": "Fruta roja", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Azúcar", "cantidad": 400, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 250, "unidad": "ml" }
        ],
        "elaboracion": [
          "Hervir todos los ingredientes hasta densidad media.",
          "Triturar y colar por chino fino."
        ]
      },
      {
        "id": "VARIOS 215",
        "nombre": "Glassa Antihumedad",
        "categoria": "Decoración & Acabados",
        "ingredientes": [
          { "nombre": "Azúcar glass", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Clara de huevo deshidratada", "cantidad": 20, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 100, "unidad": "ml" }
        ],
        "elaboracion": [
          "Mezclar todos los ingredientes hasta homogeneidad.",
          "Dejar reposar 12 horas tapado.",
          "Ideal para decorar tartas sin que se humedezcan."
        ]
      },
      {
        "id": "VARIOS 223",
        "nombre": "Coulis de Manzana",
        "categoria": "Rellenos & Coberturas",
        "ingredientes": [
          { "nombre": "Manzanas", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 375, "unidad": "gr" },
          { "nombre": "Azúcar", "cantidad": 75, "unidad": "gr" },
          { "nombre": "Zumo de limón", "cantidad": 1, "unidad": "unidad" },
          { "nombre": "Vainilla", "cantidad": 0.25, "unidad": "vaina" }
        ],
        "elaboracion": [
          "Cocer manzanas con resto de ingredientes.",
          "Triturar, colar y ajustar espesor."
        ]
      },
      {
        "id": "VARIOS 224",
        "nombre": "Coulis de Kiwi",
        "categoria": "Rellenos & Coberturas",
        "ingredientes": [
          { "nombre": "Kiwi", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Azúcar", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 100, "unidad": "ml" }
        ],
        "elaboracion": [
          "Pelar y triturar kiwi.",
          "Añadir azúcar y agua.",
          "Cocer ligeramente y colar."
        ]
      },
      {
        "id": "VARIOS 216",
        "nombre": "Baño de Cobertura",
        "categoria": "Decoración & Acabados",
        "ingredientes": [
          { "nombre": "Cobertura negra", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Mantequilla", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Glucosa", "cantidad": 2, "unidad": "cda" }
        ],
        "elaboracion": [
          "Derretir cobertura con mantequilla y glucosa.",
          "Usar como baño para tartas y bombones."
        ]
      },
      // === DECORACIÓN & ACABADOS ===
      {
        "id": "VARIOS 225",
        "nombre": "Merengue Italiano",
        "categoria": "Decoración & Acabados",
        "ingredientes": [
          { "nombre": "Claras de huevo", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Azúcar", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 50, "unidad": "ml" },
          { "nombre": "Azúcar invertido", "cantidad": 10, "unidad": "gr" }
        ],
        "elaboracion": [
          "Calentar azúcar, agua y azúcar invertido hasta 118°C.",
          "Verter sobre claras batidas a punto de nieve.",
          "Seguir batiendo hasta enfriar."
        ]
      },
      {
        "id": "VARIOS 226",
        "nombre": "Salsa de Fresa",
        "categoria": "Decoración & Acabados",
        "ingredientes": [
          { "nombre": "Fresas", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Azúcar", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 100, "unidad": "ml" },
          { "nombre": "Glucosa", "cantidad": 50, "unidad": "gr" },
          { "nombre": "Limón", "cantidad": 1, "unidad": "unidad" }
        ],
        "elaboracion": [
          "Cocer fresas con azúcar, agua, glucosa y limón.",
          "Triturar y colar."
        ]
      },
      {
        "id": "VARIOS 227",
        "nombre": "Salsa de Módena",
        "categoria": "Decoración & Acabados",
        "ingredientes": [
          { "nombre": "Vinagre de módena", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Azúcar", "cantidad": 400, "unidad": "gr" },
          { "nombre": "Zumo de limón", "cantidad": 1, "unidad": "chorro" },
          { "nombre": "Agua", "cantidad": 1, "unidad": "chorro" }
        ],
        "elaboracion": [
          "Reducir vinagre. Hacer caramelo rubio con azúcar.",
          "Mezclar ambas elaboraciones. Debe quedar meloso."
        ]
      },
      // === NUEVAS RECETAS ADICIONALES PARA COMPLETAR 73 ===
      {
        "id": "VARIOS 174",
        "nombre": "Trufa con Leche",
        "categoria": "Dulces & Confites",
        "ingredientes": [
          { "nombre": "Nata", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Cobertura blanca", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Leche condensada", "cantidad": 100, "unidad": "gr" }
        ],
        "elaboracion": [
          "Calentar nata, añadir cobertura blanca y leche condensada.",
          "Dejar enfriar, hacer bolas y rodar en cacao."
        ]
      },
      {
        "id": "VARIOS 197",
        "nombre": "Marquesas",
        "categoria": "Bizcochos, Magdalenas & Muffins",
        "ingredientes": [
          { "nombre": "Huevos", "cantidad": 6, "unidad": "unidades" },
          { "nombre": "Azúcar", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Harina", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Mantequilla", "cantidad": 50, "unidad": "gr" }
        ],
        "elaboracion": [
          "Batir huevos con azúcar hasta triplicar volumen.",
          "Incorporar harina y mantequilla derretida con cuidado.",
          "Hornear a 180°C durante 25 minutos."
        ],
        "temperatura": 180,
        "tiempo": 25
      },
      {
        "id": "VARIOS 171",
        "nombre": "San Honore",
        "categoria": "Tartas Premium",
        "ingredientes": [
          { "nombre": "Pasta choux", "cantidad": 1, "unidad": "masa" },
          { "nombre": "Pasta sable", "cantidad": 1, "unidad": "masa" },
          { "nombre": "Crema San Honore", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Caramelo", "cantidad": 100, "unidad": "gr" }
        ],
        "elaboracion": [
          "Elaborar profiteroles con pasta choux.",
          "Montar base con pasta sable.",
          "Rellenar con crema, colocar profiteroles y abrillantar con caramelo."
        ]
      },
      {
        "id": "VARIOS 122",
        "nombre": "Tarta de Frambuesas",
        "categoria": "Tartas del Ayer",
        "ingredientes": [
          { "nombre": "Base de galleta", "cantidad": 1, "unidad": "unidad" },
          { "nombre": "Crema pastelera", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Frambuesas", "cantidad": 400, "unidad": "gr" },
          { "nombre": "Gelatina de frambuesa", "cantidad": 1, "unidad": "sobre" }
        ],
        "elaboracion": [
          "Rellenar base con crema pastelera.",
          "Colocar frambuesas encima.",
          "Abrillantar con gelatina."
        ]
      },
      {
        "id": "VARIOS 129",
        "nombre": "Tarta de Queso (2ª Forma)",
        "categoria": "Tartas del Ayer",
        "ingredientes": [
          { "nombre": "Queso crema", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Azúcar", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Huevos", "cantidad": 4, "unidad": "unidades" },
          { "nombre": "Galletas", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Mantequilla", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Coulis de fruta", "cantidad": 200, "unidad": "gr" }
        ],
        "elaboracion": [
          "Base con galletas y mantequilla.",
          "Mezclar queso, azúcar y huevos.",
          "Verter sobre base y hornear al baño María.",
          "Desmoldar y cubrir con coulis."
        ],
        "temperatura": 160,
        "tiempo": 50
      },
      {
        "id": "VARIOS 46",
        "nombre": "Nata Montada",
        "categoria": "Rellenos & Coberturas",
        "ingredientes": [
          { "nombre": "Nata líquida", "cantidad": 1000, "unidad": "ml" },
          { "nombre": "Azúcar", "cantidad": 125, "unidad": "gr" }
        ],
        "elaboracion": [
          "Batir nata fría con azúcar hasta punto firme."
        ]
      },
      {
        "id": "VARIOS 45",
        "nombre": "Merengue Rápido",
        "categoria": "Decoración & Acabados",
        "ingredientes": [
          { "nombre": "Claritas", "cantidad": 400, "unidad": "gr" },
          { "nombre": "Azúcar", "cantidad": 600, "unidad": "gr" }
        ],
        "elaboracion": [
          "Mezclar y calentar al baño María hasta disolver azúcar.",
          "Batir hasta enfriar y tener cuerpo firme."
        ]
      }
    ];




  // Estado global
  let favoritos = JSON.parse(localStorage.getItem('favoritos')||"[]");
  let notas = JSON.parse(localStorage.getItem('notas')||"{}");
  let historial = [];          // stack de vistas {view,data}
  let recetaActual = null;
  let ultimaRecetaId = null;

  // Temporizadores globales (soportan múltiples temporizadores)
  // Cada temporizador: {id:uid, recetaId, label, time, remaining, active, interval}
  let temporizadores = [];

  // Utilidades
  function escapeHtml(s){ if(s===null||s===undefined) return ""; return String(s).replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c])); }
  function uid(prefix='t'){ return prefix + Math.random().toString(36).slice(2,9); }
  function clearViews(){ document.querySelectorAll('.view').forEach(n=>n.remove()); document.getElementById('pantalla-principal').style.display='none'; }
  function showPrincipal(){ clearViews(); document.getElementById('pantalla-principal').style.display='flex'; document.getElementById('buscador').value = ""; }
  function pushHistory(view,data){ historial.push({view,data}); }
  function popHistory(){ historial.pop(); return historial[historial.length-1] || null; }

  // NAVEGACIÓN: setView
  function setView(view, data={}, push=true){
    if(push) pushHistory(view,data);
    clearViews();
    const container = document.createElement('div');
    container.className = 'view';
    const inner = document.createElement('div');
    inner.className = 'view-inner';

    const backBtnHtml = `<button class="view-back" onclick="handleBack()">← Atrás</button>`;

    if(view === 'menu'){
      inner.innerHTML = backBtnHtml + `<div class="view-title">Menú</div>
        <div class="section-card">
          <button class="btn btn-prim" onclick="setView('categorias')">Categorías</button>
          <button class="btn" style="background:#b36f3c;color:#fff" onclick="setView('favoritos')">Recetas estrella</button>
          <button class="btn btn-accent" onclick="openUltima()">Última receta</button>
        </div>`;
    }

    else if(view === 'categorias'){
      const cats = [...new Set(recetas.map(r=>r.categoria).filter(Boolean))];
      inner.innerHTML = backBtnHtml + `<div class="view-title">Categorías</div>
        <div class="section-card">${cats.length ? cats.map(c => `<button class="btn" onclick="setView('recetas',{categoria:'${escapeHtml(c)}'})">${escapeHtml(c)}</button>`).join('') : '<div>No hay categorías</div>'}</div>`;
    }

    else if(view === 'recetas'){
      const cat = data.categoria || '';
      const list = recetas.filter(r => r.categoria === cat);
      inner.innerHTML = backBtnHtml + `<div class="view-title">${escapeHtml(cat)}</div>
        <div class="section-card">${list.length ? list.map(r => `<button class="btn" onclick="setView('receta',{id:'${r.id}'})">${escapeHtml(r.nombre)}</button>`).join('') : '<div>No hay recetas en esta categoría</div>'}</div>`;
    }

    else if(view === 'receta'){
      recetaActual = recetas.find(r => r.id === data.id);
      if(!recetaActual){
        inner.innerHTML = backBtnHtml + `<div class="view-title">Receta no encontrada</div>`;
      } else {
        ultimaRecetaId = recetaActual.id;

        // Temporizador personalizado select (1..90) + control abrir panel de temporizadores
        const tempSelectHtml = `<select id="personal-timer-select" class="temporizador-dropdown" aria-label="Temporizador personalizado">
          <option value="">⏱ Personal</option>
          ${Array.from({length:90},(_,i)=>`<option value="${i+1}">${i+1} min</option>`).join('')}
        </select>
        <button id="add-personal-timer" class="btn" style="width:auto;margin-left:8px">Añadir</button>`;

        inner.innerHTML = backBtnHtml + `<div style="display:flex;align-items:center;gap:8px;justify-content:space-between;">
            <div style="font-weight:900">${escapeHtml(recetaActual.nombre)}</div>
            <div style="display:flex;align-items:center;">${tempSelectHtml}</div>
          </div>
          <div style="margin-top:8px;"><strong>Categoría:</strong> ${escapeHtml(recetaActual.categoria||'')}</div>
          <div class="ingredientes-lista"><strong>Ingredientes</strong><ul id="ingredientes-list">${renderIngredientes(recetaActual, recetaActual.porciones||4)}</ul></div>
          <div class="elaboracion-lista"><strong>Elaboración</strong><ol>${(recetaActual.elaboracion||[]).map(p=>`<li>${escapeHtml(p)}</li>`).join('')}</ol></div>

          <div id="timers-panel" class="section-card" style="margin-top:8px">
            <strong>Temporizadores activos</strong>
            <div id="timers-list" style="margin-top:8px"></div>
          </div>

          <div style="margin-top:12px;display:flex;gap:8px">
            <button class="btn btn-accent" onclick="setView('notas',{id:'${recetaActual.id}'})">Notas y observaciones</button>
            <button class="btn" style="background:#2d5b2f;color:#fff" onclick="compartirReceta('${recetaActual.id}')">Compartir</button>
          </div>
        `;

        // append then attach handlers
        setTimeout(()=>{
          document.getElementById('add-personal-timer').addEventListener('click', ()=>{
            const val = document.getElementById('personal-timer-select').value;
            if(!val) return alert('Selecciona minutos');
            createTimerForRecipe(recetaActual.id, parseInt(val), `Personal ${val}m`);
            document.getElementById('personal-timer-select').value = '';
          });
          // show timers if any
          renderTimersPanel();
        }, 0);
      }
    }

    else if(view === 'favoritos'){
      const favs = recetas.filter(r => favoritos.includes(r.id));
      inner.innerHTML = backBtnHtml + `<div class="view-title">Recetas estrella</div>
        <div class="section-card">${favs.length ? favs.map(r => `<button class="btn" onclick="setView('receta',{id:'${r.id}'})">${escapeHtml(r.nombre)}</button>`).join('') : '<div>No tienes recetas marcadas como favoritas.</div>'}</div>`;
    }

    else if(view === 'notas'){
      const id = data.id || Object.keys(notas)[0] || '';
      const txt = notas[id] || '';
      inner.innerHTML = backBtnHtml + `<div class="view-title">Notas y observaciones</div>
        <textarea id="nota-txt">${escapeHtml(txt)}</textarea>
        <div style="display:flex;gap:8px;margin-top:12px">
          <button class="btn btn-accent" onclick="guardarNota('${id}')">Guardar</button>
          <button class="btn" onclick="compartirNota('${id}')">Compartir</button>
        </div>`;
    }

    else {
      inner.innerHTML = backBtnHtml + `<div class="view-title">${escapeHtml(view)}</div>`;
    }

    container.appendChild(inner);
    document.body.appendChild(container);
  }

  // Manejo botón Atrás (historial)
  function handleBack(){
    popHistory();
    const prev = historial[historial.length-1];
    if(prev) setView(prev.view, prev.data, false);
    else showPrincipal();
  }

  // Helpers ingredientes y renderizado
  function renderIngredientes(rec, personas){
    const por = personas / (rec.porciones || 4);
    return (rec.ingredientes || []).map(i=>{
      const cant = Math.round(((i.cantidad||0) * por) * 100)/100;
      return `<li>${escapeHtml(i.nombre)} — ${cant} ${escapeHtml(i.unidad||'')}</li>`;
    }).join('');
  }

  // Notas
  function guardarNota(id){
    if(!id) return alert('No hay receta seleccionada para asociar la nota.');
    const val = document.getElementById('nota-txt')?.value || "";
    notas[id] = val;
    localStorage.setItem('notas', JSON.stringify(notas));
    alert('Nota guardada');
  }
  function compartirNota(id){
    const text = notas[id] || '';
    if(navigator.share) navigator.share({title:'Nota', text});
    else navigator.clipboard.writeText(text).then(()=> alert('Nota copiada al portapapeles'));
  }

  // Compartir receta
  function compartirReceta(id){
    const r = recetas.find(x=>x.id===id); if(!r) return;
    const txt = `Receta: ${r.nombre}\nCategoría: ${r.categoria}\nIngredientes:\n${(r.ingredientes||[]).map(i=>`${i.nombre}: ${i.cantidad} ${i.unidad||''}`).join('\n')}\n\nElaboración:\n${(r.elaboracion||[]).map((p,i)=>`${i+1}. ${p}`).join('\n')}`;
    if(navigator.share) navigator.share({title:r.nombre, text:txt});
    else navigator.clipboard.writeText(txt).then(()=> alert('Receta copiada al portapapeles'));
  }

  // Temporizadores: crear, renderizar, gestionar múltiples temporizadores
  function createTimerForRecipe(recId, minutes, label){
    const id = uid('timer_');
    const t = { id, recetaId:recId, label: label||`${minutes} min`, time: minutes*60, remaining: minutes*60, active:true, interval:null };
    t.interval = setInterval(()=> {
      t.remaining--;
      if(t.remaining <= 0){
        clearInterval(t.interval);
        t.active = false;
        renderTimersPanel();
        try{ new AudioContext && beep(); }catch(e){}
        alert(`Temporizador "${t.label}" finalizado`);
      } else {
        renderTimersPanel();
      }
    }, 1000);
    temporizadores.push(t);
    renderTimersPanel();
  }

  function pauseTimer(id){
    const t = temporizadores.find(x=>x.id===id);
    if(!t) return;
    if(t.active){ clearInterval(t.interval); t.active=false; }
    renderTimersPanel();
  }
  function resumeTimer(id){
    const t = temporizadores.find(x=>x.id===id);
    if(!t) return;
    if(!t.active && t.remaining>0){
      t.interval = setInterval(()=> {
        t.remaining--;
        if(t.remaining <= 0){ clearInterval(t.interval); t.active=false; renderTimersPanel(); alert(`Temporizador "${t.label}" finalizado`); }
        else renderTimersPanel();
      },1000);
      t.active = true;
    }
    renderTimersPanel();
  }
  function cancelTimer(id){
    const idx = temporizadores.findIndex(x=>x.id===id);
    if(idx===-1) return;
    clearInterval(temporizadores[idx].interval);
    temporizadores.splice(idx,1);
    renderTimersPanel();
  }
  function renderTimersPanel(){
    const panel = document.getElementById('timers-list');
    if(!panel) return;
    panel.innerHTML = '';
    const list = temporizadores.filter(t => !recetaActual || t.recetaId === recetaActual.id);
    if(list.length === 0){ panel.innerHTML = '<div style="opacity:.7">No hay temporizadores activos en esta receta.</div>'; return; }
    list.forEach(t=>{
      const el = document.createElement('div');
      el.style.display='flex'; el.style.justifyContent='space-between'; el.style.alignItems='center'; el.style.marginBottom='8px';
      el.innerHTML = `<div style="font-weight:700">${escapeHtml(t.label)} <small style="opacity:.8">[${formatTime(t.remaining)}]</small></div>
        <div style="display:flex;gap:6px">
          ${t.active ? `<button class="btn" style="padding:6px 8px" onclick="pauseTimer('${t.id}')">Pausar</button>` : `<button class="btn" style="padding:6px 8px" onclick="resumeTimer('${t.id}')">Continuar</button>`}
          <button class="btn" style="padding:6px 8px" onclick="cancelTimer('${t.id}')">Cancelar</button>
        </div>`;
      panel.appendChild(el);
    });
  }
  function formatTime(s){ s = Math.max(0, Math.floor(s||0)); const m = Math.floor(s/60), sec = s%60; return `${m<10?'0':''}${m}:${sec<10?'0':''}${sec}`; }
  function beep(){
    try{ const ctx = new (window.AudioContext || window.webkitAudioContext)(); const o = ctx.createOscillator(); const g = ctx.createGain(); o.type='sine'; o.frequency.value=880; g.gain.value=0.2; o.connect(g); g.connect(ctx.destination); o.start(); setTimeout(()=>{ o.stop(); ctx.close(); }, 700);}catch(e){}
  }

  // Buscador: modal resultados
  function showModalBusqueda(items){
    closeModal();
    const m = document.createElement('div'); m.className='modal';
    const card = document.createElement('div'); card.className='card';
    const title = document.createElement('h3'); title.textContent = `Resultados (${items.length})`;
    card.appendChild(title);
    const list = document.createElement('div'); list.className='modal-list';
    if(items.length === 0) list.innerHTML = '<div>No hay resultados</div>';
    else items.forEach(r=>{
      const b = document.createElement('button'); b.className='btn btn-accent'; b.textContent = r.nombre;
      b.onclick = ()=>{ closeModal(); setView('receta',{id:r.id}); };
      list.appendChild(b);
    });
    const closeBtn = document.createElement('button'); closeBtn.className='btn'; closeBtn.textContent='Cerrar'; closeBtn.onclick = closeModal;
    card.appendChild(list); card.appendChild(closeBtn); m.appendChild(card); document.body.appendChild(m);
  }
  function closeModal(){ document.querySelectorAll('.modal').forEach(n=>n.remove()); }

  // Buscador inteligente (mejorado)
  function showBuscadorInteligente(){
    closeModal();
    const m = document.createElement('div'); m.className='modal';
    const card = document.createElement('div'); card.className='card';
    const h = document.createElement('h3'); h.textContent = 'Dulces Patxi quiere saber';
    card.appendChild(h);

    // Ingrediente (input)
    const ingBtn = document.createElement('button'); ingBtn.className='btn btn-accent'; ingBtn.textContent='Filtrar por ingrediente';
    ingBtn.onclick = ()=>{ closeModal(); const q = prompt('¿Qué ingrediente?'); if(!q) return; const res = recetas.filter(r=>(r.ingredientes||[]).some(i=> (i.nombre||'').toLowerCase().includes(q.toLowerCase()))); showModalBusqueda(res); };

    // Tiempo (franjas)
    const timeBtn = document.createElement('button'); timeBtn.className='btn btn-accent'; timeBtn.textContent='Filtrar por tiempo (franjas)';
    timeBtn.onclick = ()=>{ closeModal(); const choice = prompt('Elige franja: 1) 1-20  2) 21-40  3) 41+  (escribe 1,2 o 3)'); if(!choice) return; const ch = choice.trim(); let res=[]; if(ch==='1'){ res = recetas.filter(r=> (r.tiempo||0) <=20 ); } else if(ch==='2'){ res = recetas.filter(r=> (r.tiempo||0) >=21 && (r.tiempo||0) <=40 ); } else if(ch==='3'){ res = recetas.filter(r=> (r.tiempo||0) >=41 ); } showModalBusqueda(res); };

    // Dificultad (select)
    const diffBtn = document.createElement('button'); diffBtn.className='btn btn-accent'; diffBtn.textContent='Filtrar por dificultad';
    diffBtn.onclick = ()=>{ closeModal(); const choice = prompt('Dificultad: fácil / medio / difícil'); if(!choice) return; const ch = choice.toLowerCase(); const res = recetas.filter(r=> ((r.dificultad||'')+'').toLowerCase().includes(ch)); showModalBusqueda(res); };

    const favBtn = document.createElement('button'); favBtn.className='btn'; favBtn.textContent='Favoritos'; favBtn.onclick = ()=>{ closeModal(); setView('favoritos'); };

    const closeBtn = document.createElement('button'); closeBtn.className='btn'; closeBtn.textContent='Cerrar'; closeBtn.onclick = closeModal;

    card.appendChild(ingBtn); card.appendChild(timeBtn); card.appendChild(diffBtn); card.appendChild(favBtn); card.appendChild(closeBtn);
    m.appendChild(card); document.body.appendChild(m);
  }

  // Buscador input handler (debounced)
  function onSearchInput(ev){
    const q = (ev.target.value || '').trim().toLowerCase();
    if(!q) return;
    const res = recetas.filter(r => ((r.nombre||'') + ' ' + (r.categoria||'')).toLowerCase().includes(q));
    showModalBusqueda(res);
  }
  function debounce(fn, ms=250){ let t; return function(...a){ clearTimeout(t); t=setTimeout(()=>fn.apply(this,a), ms); }; }

  // abrir última receta vista
  function openUltima(){ if(ultimaRecetaId) setView('receta',{id:ultimaRecetaId}); else alert('No hay receta visitada aún'); }

  // inicialización y enlaces
  document.addEventListener('DOMContentLoaded', ()=>{
    document.getElementById('btn-modo').addEventListener('click', ()=> document.body.classList.toggle('modo-oscuro'));
    document.getElementById('btn-menu').addEventListener('click', ()=> setView('menu'));
    document.getElementById('btn-favoritos').addEventListener('click', ()=> setView('favoritos'));
    document.getElementById('btn-notas').addEventListener('click', ()=> {
      const id = recetaActual?.id || Object.keys(notas)[0] || '';
      if(!id) return alert('Abre una receta para ver/crear notas o visita una receta primero');
      setView('notas',{id});
    });
    document.getElementById('btn-buscador-inteligente').addEventListener('click', showBuscadorInteligente);
    document.getElementById('buscador').addEventListener('input', debounce(onSearchInput, 300));
    showPrincipal();
  });

  // make uid
  function uid(prefix='id'){ return prefix + Math.random().toString(36).slice(2,9); }

  // Expose a few functions to the global scope used by inline handlers
  window.setView = setView;
  window.showPrincipal = showPrincipal;
  window.handleBack = handleBack;
  window.createTimerForRecipe = createTimerForRecipe;
  window.toggleFavorito = function(id){
    if(favoritos.includes(id)) favoritos = favoritos.filter(x=>x!==id); else favoritos.push(id);
    localStorage.setItem('favoritos', JSON.stringify(favoritos));
    // refresh view if viewing same recipe
    if(recetaActual && recetaActual.id === id) setView('receta',{id}, false);
  };
  window.compactTimers = function(){ renderTimersPanel(); };

  </script>
</body>
</html>



