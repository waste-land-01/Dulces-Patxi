<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Libro de Recetas Dulces üßÅ</title>
    <style>
        /* Estilos generales */
        :root {
            --color-fondo: #f5f5f5;
            --color-tarjeta: #ffffff;
            --color-texto: #333333;
            --color-primario: #5b483a; /* Marr√≥n oscuro */
            --color-acento: #e9b37c; /* Melocot√≥n/Naranja suave */
            --color-fondo-botones: #e0e0e0;
            --sombra-suave: 0 4px 8px rgba(0, 0, 0, 0.05);
        }

        /* Modo Oscuro */
        body.modo-oscuro {
            --color-fondo: #212121;
            --color-tarjeta: #3a3a3a;
            --color-texto: #e0e0e0;
            --color-primario: #f1f1f1;
            --color-acento: #e9b37c;
            --color-fondo-botones: #505050;
            --sombra-suave: 0 4px 10px rgba(0, 0, 0, 0.5);
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: var(--color-fondo);
            color: var(--color-texto);
            margin: 0;
            padding: 0;
            transition: background-color 0.3s, color 0.3s;
        }

        /* Contenedor principal */
        #pantalla-principal {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            gap: 15px;
            min-height: 100vh;
        }

        /* Barra de navegaci√≥n */
        .header-bar {
            width: 100%;
            max-width: 600px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
        }
        
        /* Botones de navegaci√≥n */
        .nav-button {
            background-color: var(--color-tarjeta);
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 10px 15px;
            cursor: pointer;
            font-weight: bold;
            color: var(--color-texto);
            box-shadow: var(--sombra-suave);
            transition: background-color 0.2s, box-shadow 0.2s;
        }
        .nav-button:hover {
            background-color: var(--color-fondo-botones);
        }

        /* Buscador */
        .buscador-wrap {
            width: 100%;
            max-width: 600px;
            position: relative;
        }
        #buscador {
            width: 100%;
            padding: 12px 40px 12px 15px;
            border: none;
            border-radius: 25px;
            background-color: var(--color-tarjeta);
            box-shadow: var(--sombra-suave);
            color: var(--color-texto);
            box-sizing: border-box;
        }
        #btn-buscador-inteligente {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--color-acento);
            font-size: 1.2em;
            cursor: pointer;
        }

        /* Contenedores de vista (Views) */
        .view {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            min-height: 100%;
            background-color: var(--color-fondo);
            z-index: 100;
            padding-top: 20px;
            box-sizing: border-box;
            overflow-y: auto;
        }
        .view-inner {
            max-width: 600px;
            margin: 0 auto;
            padding: 0 20px 40px;
        }
        .view-title {
            font-size: 1.8em;
            margin-bottom: 20px;
            padding-bottom: 5px;
            border-bottom: 2px solid var(--color-acento);
            display: flex;
            align-items: center;
        }
        .view-back {
            background: none;
            border: none;
            color: var(--color-texto);
            font-size: 1em;
            font-weight: bold;
            margin-bottom: 15px;
            cursor: pointer;
            padding: 0;
        }

        /* Tarjetas de secci√≥n */
        .section-card {
            background-color: var(--color-tarjeta);
            padding: 15px;
            border-radius: 12px;
            box-shadow: var(--sombra-suave);
            margin-bottom: 15px;
        }

        /* Botones gen√©ricos */
        .btn {
            display: block;
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: none;
            border-radius: 8px;
            background-color: var(--color-fondo-botones);
            color: var(--color-texto);
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.2s, opacity 0.2s;
            text-align: left;
        }
        .btn:hover {
            opacity: 0.9;
        }
        .btn-primario {
            background-color: var(--color-primario);
            color: #ffffff;
        }
        .btn-accent {
            background-color: var(--color-acento);
            color: var(--color-primario);
            font-weight: bold;
        }
        
        /* Lista de ingredientes y elaboraci√≥n */
        .ingredientes-lista, .elaboracion-lista {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px dashed var(--color-fondo-botones);
        }
        .ingredientes-lista ul, .elaboracion-lista ol {
            padding-left: 20px;
            margin-top: 8px;
        }
        .ingredientes-lista li, .elaboracion-lista li {
            margin-bottom: 5px;
        }

        /* Notas */
        #nota-txt {
            width: 100%;
            min-height: 200px;
            padding: 10px;
            box-sizing: border-box;
            border: 1px solid var(--color-fondo-botones);
            border-radius: 8px;
            margin-top: 10px;
            background-color: var(--color-tarjeta);
            color: var(--color-texto);
            resize: vertical;
        }
        .notas-toolbar {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .notas-toolbar .notas-btn {
            flex-grow: 1;
            text-align: center;
        }
        
        /* Temporizador */
        .temporizador-panel {
            background-color: var(--color-fondo-botones);
            padding: 15px;
            border-radius: 8px;
        }
        .temporizador-time {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--color-primario);
        }
        .temporizador-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        .temporizador-controls .btn {
            width: auto;
            flex-grow: 1;
            padding: 8px 15px;
            text-align: center;
        }

        /* Modales */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-card {
            background-color: var(--color-tarjeta);
            padding: 20px;
            border-radius: 12px;
            max-width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
            text-align: center;
        }
        .modal-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .modal-list .btn {
            text-align: center;
        }
    </style>
</head>
<body>

    <div id="pantalla-principal">
        <div class="header-bar">
            <button id="btn-menu" class="nav-button">Men√∫ üç∞</button>
            <div>
                <button id="btn-favoritos" class="nav-button">‚òÖ</button>
                <button id="btn-notas" class="nav-button">üóíÔ∏è</button>
                <button id="btn-modo" class="nav-button">‚òÄÔ∏è/üåô</button>
            </div>
        </div>

        <div class="buscador-wrap">
            <input type="text" id="buscador" placeholder="Buscar receta, ingrediente o categor√≠a...">
            <button id="btn-buscador-inteligente" title="Buscador avanzado">üß†</button>
        </div>
        
        <div class="section-card" style="width: 100%; max-width: 600px;">
            <div style="font-weight:900; margin-bottom: 10px;">¬°Bienvenido/a al rinc√≥n dulce!</div>
            <p>Usa el men√∫ para navegar por categor√≠as o el buscador para encontrar tu capricho ideal.</p>
        </div>
    </div>

    <script>
    /* ========================================================== */
    // Datos de recetas
    /* ========================================================== */
    const recetas = [
        {
            "id": "VARIOS 205",
            "nombre": "Crema de turr√≥n",
            "categoria": "Rellenos & Coberturas",
            "ingredientes": [
                { "nombre": "Nata", "cantidad": 500, "unidad": "gr" },
                { "nombre": "Yemas", "cantidad": 4, "unidad": "unidades" },
                { "nombre": "Az√∫car", "cantidad": 50, "unidad": "gr" },
                { "nombre": "Turr√≥n de Jijona", "cantidad": 250, "unidad": "gr" }
            ],
            "elaboracion": [
                "Calentar nata y turr√≥n hasta fundir. Colar.",
                "Hacer una crema inglesa con yemas y az√∫car (sin hervir).",
                "Mezclar y enfriar. Usar para rellenar o como postre."
            ]
        },
        {
            "id": "VARIOS 206",
            "nombre": "Crema de Trufa",
            "categoria": "Rellenos & Coberturas",
            "ingredientes": [
                { "nombre": "Nata", "cantidad": 1000, "unidad": "gr" },
                { "nombre": "Cobertura negra", "cantidad": 300, "unidad": "gr" },
                { "nombre": "Glucosa", "cantidad": 10, "unidad": "gr" }
            ],
            "elaboracion": [
                "Hervir nata y glucosa.",
                "Retirar del fuego, a√±adir cobertura troceada y remover hasta fundir.",
                "Dejar reposar 12 horas en fr√≠o y montar."
            ]
        },
        {
            "id": "VARIOS 182",
            "nombre": "Turr√≥n de Coco",
            "categoria": "Dulces & Confites",
            "ingredientes": [
                { "nombre": "Alm√≠bar", "cantidad": 1, "unidad": "kilo" },
                { "nombre": "Agua", "cantidad": 350, "unidad": "gr" },
                { "nombre": "Coco rallado", "cantidad": 500, "unidad": "gr" },
                { "nombre": "Almendra molida", "cantidad": 500, "unidad": "gr" },
                { "nombre": "Glucosa", "cantidad": 125, "unidad": "gr" }
            ],
            "elaboracion": [
                "Hacer alm√≠bar con az√∫car, agua y glucosa.",
                "A√±adir coco y almendra.",
                "Verter en molde, enfriar y cortar."
            ]
        },
        {
            "id": "VARIOS 183",
            "nombre": "Turr√≥n de Pistachos",
            "categoria": "Dulces & Confites",
            "ingredientes": [
                { "nombre": "Alm√≠bar", "cantidad": 1, "unidad": "kilo" },
                { "nombre": "Agua", "cantidad": 330, "unidad": "gr" },
                { "nombre": "Pistachos molidos", "cantidad": 500, "unidad": "gr" },
                { "nombre": "Almendra molida", "cantidad": 500, "unidad": "gr" }
            ],
            "elaboracion": [
                "Hacer alm√≠bar a punto de hebra floja.",
                "Mezclar con pistachos y almendra.",
                "Moldear, prensar y reposar."
            ]
        },
        {
            "id": "VARIOS 184",
            "nombre": "Guirlache",
            "categoria": "Dulces & Confites",
            "ingredientes": [
                { "nombre": "Az√∫car", "cantidad": 500, "unidad": "gr" },
                { "nombre": "Manteca de cerdo", "cantidad": 10, "unidad": "gr" },
                { "nombre": "Canela", "cantidad": 5, "unidad": "gr" },
                { "nombre": "Zumo de lim√≥n", "cantidad": 1, "unidad": "chorro" },
                { "nombre": "Almendras marcona", "cantidad": 450, "unidad": "gr" }
            ],
            "elaboracion": [
                "Hacer caramelo rubio con az√∫car, manteca, canela y lim√≥n.",
                "A√±adir almendras tostadas.",
                "Extender sobre m√°rmol engrasado.",
                "Cortar en barritas antes de enfriar."
            ]
        },
        {
            "id": "VARIOS 181",
            "nombre": "Turr√≥n de Nata Nuez",
            "categoria": "Dulces & Confites",
            "ingredientes": [
                { "nombre": "Nata", "cantidad": 400, "unidad": "gr" },
                { "nombre": "Az√∫car", "cantidad": 1125, "unidad": "gr" },
                { "nombre": "Almendra molida", "cantidad": 1000, "unidad": "gr" },
                { "nombre": "Nueces", "cantidad": 750, "unidad": "gr" },
                { "nombre": "Vainillina", "cantidad": 1, "unidad": "cda" }
            ],
            "elaboracion": [
                "Hervir nata con az√∫car, a√±adir almendra, nueces y vainillina.",
                "Moldear, prensar y dejar reposar m√≠nimo un d√≠a."
            ]
        },
        // === MASAS & PASTELES ===
        {
            "id": "VARIOS 75",
            "nombre": "Hojaldre (F√≥rmula Tradicional)",
            "categoria": "Masas & Pasteles",
            "ingredientes": [
                { "nombre": "Harina fuerte", "cantidad": 1000, "unidad": "gr" },
                { "nombre": "Agua", "cantidad": 600, "unidad": "gr" },
                { "nombre": "Sal", "cantidad": 20, "unidad": "gr" },
                { "nombre": "Manteca de cerdo o mantequilla", "cantidad": 600, "unidad": "gr" }
            ],
            "elaboracion": [
                "Mezclar harina, agua y sal. Formar un plast√≥n.",
                "Enfriar 30 minutos.",
                "Estirar y colocar la grasa en el centro. Doblar como libro.",
                "Repetir 3-4 vueltas simples, refrigerando entre cada una."
            ]
        },
        {
            "id": "VARIOS 83",
            "nombre": "Palmeras",
            "categoria": "Masas & Pasteles",
            "ingredientes": [
                { "nombre": "Plast√≥n de hojaldre", "cantidad": 1, "unidad": "masa" },
                { "nombre": "Az√∫car en grano", "cantidad": 200, "unidad": "gr" }
            ],
            "elaboracion": [
                "Hacer una masa de hojaldre a la que se dan 6 pliegues sencillos.",
                "En el √∫ltimo pliegue espolvorear con az√∫car en grano y estirar.",
                "Se monta la masa tres veces por cada lado, juntar y cortar en palmeras.",
                "Hornear a 200-210¬∞C hasta dorar."
            ],
            "temperatura": 205,
            "tiempo": 22
        },
        {
            "id": "VARIOS 187",
            "nombre": "Cigarrillos Rusos",
            "categoria": "Masas & Pasteles",
            "ingredientes": [
                { "nombre": "Hojaldre", "cantidad": 1, "unidad": "masa" },
                { "nombre": "Az√∫car glass", "cantidad": 100, "unidad": "gr" },
                { "nombre": "Clara de huevo", "cantidad": 1, "unidad": "unidad" }
            ],
            "elaboracion": [
                "Estirar el hojaldre muy fino y pintar con clara de huevo.",
                "Espolvorear con az√∫car glass.",
                "Enrollar como si fuera un brazo de gitano y cortar en rodajas finas.",
                "Hornear a 200¬∞C hasta dorar."
            ],
            "temperatura": 200,
            "tiempo": 15
        },
        {
            "id": "VARIOS 190",
            "nombre": "Lenguas de Gato",
            "categoria": "Masas & Pasteles",
            "ingredientes": [
                { "nombre": "Mantequilla", "cantidad": 200, "unidad": "gr" },
                { "nombre": "Az√∫car glass", "cantidad": 200, "unidad": "gr" },
                { "nombre": "Harina", "cantidad": 200, "unidad": "gr" }
            ],
            "elaboracion": [
                "Batir mantequilla con az√∫car glass.",
                "Incorporar harina con esp√°tula.",
                "Escudillar en boquilla rizada.",
                "Hornear a 180¬∞C sin abrir el horno."
            ],
            "temperatura": 180,
            "tiempo": 12
        },
        // === POSTRES FR√çOS ===
        {
            "id": "VARIOS 13",
            "nombre": "Flan de Chocolate",
            "categoria": "Postres Fr√≠os",
            "ingredientes": [
                { "nombre": "Leche", "cantidad": 250, "unidad": "ml" },
                { "nombre": "Nata l√≠quida", "cantidad": 250, "unidad": "ml" },
                { "nombre": "Az√∫car", "cantidad": 150, "unidad": "gr" },
                { "nombre": "Cobertura negra", "cantidad": 100, "unidad": "gr" },
                { "nombre": "Huevos", "cantidad": 6, "unidad": "unidades" },
                { "nombre": "Salsa de caramelo", "cantidad": 1, "unidad": "cantidad" }
            ],
            "elaboracion": [
                "Mezclar leche, nata, az√∫car y cobertura fundida.",
                "A√±adir huevos batidos.",
                "Verter en moldes con caramelo.",
                "Cocer al ba√±o Mar√≠a a 160¬∞C durante 45 minutos.",
                "Enfriar y desmoldar."
            ],
            "temperatura": 160,
            "tiempo": 45
        },
        {
            "id": "VARIOS 25",
            "nombre": "Compota de Manzana",
            "categoria": "Postres Fr√≠os",
            "ingredientes": [
                { "nombre": "Manzanas", "cantidad": 1000, "unidad": "gr" },
                { "nombre": "Az√∫car", "cantidad": 150, "unidad": "gr" },
                { "nombre": "Vino blanco", "cantidad": 250, "unidad": "ml" },
                { "nombre": "Orejones", "cantidad": 50, "unidad": "gr" },
                { "nombre": "Pasas", "cantidad": 30, "unidad": "gr" }
            ],
            "elaboracion": [
                "Pelar y cortar manzanas.",
                "Cocer con az√∫car, vino y frutas secas.",
                "Dejar enfriar antes de servir."
            ]
        },
        {
            "id": "VARIOS 26",
            "nombre": "Peras en Alm√≠bar",
            "categoria": "Postres Fr√≠os",
            "ingredientes": [
                { "nombre": "Peras", "cantidad": 1000, "unidad": "gr" },
                { "nombre": "Vino blanco", "cantidad": 500, "unidad": "ml" },
                { "nombre": "Az√∫car", "cantidad": 300, "unidad": "gr" },
                { "nombre": "Agua", "cantidad": 500, "unidad": "ml" },
                { "nombre": "Canela en rama", "cantidad": 1, "unidad": "unidad" },
                { "nombre": "C√°scara de lim√≥n", "cantidad": 1, "unidad": "unidad" }
            ],
            "elaboracion": [
                "Pelar peras y mantener en agua con lim√≥n.",
                "Hervir agua, vino, az√∫car, canela y lim√≥n.",
                "A√±adir peras y cocer a fuego lento 20-30 min.",
                "Dejar enfriar en el alm√≠bar."
            ],
            "tiempo": 25
        },
        {
            "id": "VARIOS 27",
            "nombre": "Arroz con Leche",
            "categoria": "Postres Fr√≠os",
            "ingredientes": [
                { "nombre": "Arroz", "cantidad": 200, "unidad": "gr" },
                { "nombre": "Leche", "cantidad": 1000, "unidad": "ml" },
                { "nombre": "Az√∫car", "cantidad": 150, "unidad": "gr" },
                { "nombre": "Canela en rama", "cantidad": 1, "unidad": "unidad" },
                { "nombre": "C√°scara de lim√≥n", "cantidad": 1, "unidad": "unidad" },
                { "nombre": "Vainilla", "cantidad": 1, "unidad": "unidad" }
            ],
            "elaboracion": [
                "Cocer el arroz en leche con az√∫car, canela, lim√≥n y vainilla.",
                "Dejar enfriar y servir fr√≠o con canela por encima."
            ]
        },
        {
            "id": "VARIOS 28",
            "nombre": "Leche Frita",
            "categoria": "Postres Fr√≠os",
            "ingredientes": [
                { "nombre": "Leche", "cantidad": 1000, "unidad": "ml" },
                { "nombre": "Harina", "cantidad": 100, "unidad": "gr" },
                { "nombre": "Az√∫car", "cantidad": 150, "unidad": "gr" },
                { "nombre": "Canela", "cantidad": 10, "unidad": "gr" },
                { "nombre": "Aceite para fre√≠r", "cantidad": 500, "unidad": "ml" }
            ],
            "elaboracion": [
                "Cocer leche con az√∫car, canela y harina hasta espesar.",
                "Enfriar, cortar en dados y fre√≠r.",
                "Espolvorear con az√∫car y canela."
            ]
        },
        {
            "id": "VARIOS 29",
            "nombre": "Torrijas",
            "categoria": "Postres Fr√≠os",
            "ingredientes": [
                { "nombre": "Pan de brioche", "cantidad": 500, "unidad": "gr" },
                { "nombre": "Leche", "cantidad": 500, "unidad": "ml" },
                { "nombre": "Huevos", "cantidad": 3, "unidad": "unidades" },
                { "nombre": "Az√∫car", "cantidad": 100, "unidad": "gr" },
                { "nombre": "Canela", "cantidad": 10, "unidad": "gr" },
                { "nombre": "Aceite", "cantidad": 300, "unidad": "ml" }
            ],
            "elaboracion": [
                "Remojar pan en leche con canela y az√∫car.",
                "Pasar por huevo y fre√≠r.",
                "Espolvorear con az√∫car y canela."
            ]
        },
        {
            "id": "VARIOS 30",
            "nombre": "Goxua",
            "categoria": "Postres Fr√≠os",
            "ingredientes": [
                { "nombre": "Bizcocho corriente", "cantidad": 1, "unidad": "plancha" },
                { "nombre": "Crema pastelera", "cantidad": 300, "unidad": "gr" },
                { "nombre": "Nata montada", "cantidad": 300, "unidad": "gr" },
                { "nombre": "Caramelo", "cantidad": 100, "unidad": "gr" }
            ],
            "elaboracion": [
                "Cortar el bizcocho en cuadrados.",
                "Rellenar con crema y nata.",
                "Ba√±o de caramelo por encima."
            ]
        },
        {
            "id": "VARIOS 31",
            "nombre": "Pastel Vasco",
            "categoria": "Postres Fr√≠os",
            "ingredientes": [
                { "nombre": "Harina", "cantidad": 500, "unidad": "gr" },
                { "nombre": "Az√∫car", "cantidad": 300, "unidad": "gr" },
                { "nombre": "Mantequilla", "cantidad": 200, "unidad": "gr" },
                { "nombre": "Huevos", "cantidad": 4, "unidad": "unidades" },
                { "nombre": "Crema pastelera", "cantidad": 400, "unidad": "gr" }
            ],
            "elaboracion": [
                "Mezclar harina, az√∫car, mantequilla y huevos hasta formar masa.",
                "Forrar molde y rellenar con crema pastelera.",
                "Hornear a 180¬∞C durante 40 minutos."
            ],
            "temperatura": 180,
            "tiempo": 40
        },
        // === HELADOS & SORBETES ===
        {
            "id": "VARIOS 100",
            "nombre": "Sorbete de Lim√≥n al Champ√°n",
            "categoria": "Helados & Sorbetes",
            "ingredientes": [
                { "nombre": "Alm√≠bar a 28¬∞Brix", "cantidad": 1, "unidad": "litro" },
                { "nombre": "Zumo de lim√≥n", "cantidad": 1, "unidad": "litro" }
            ],
            "elaboracion": [
                "Mezclar ambos ingredientes y enfriar bien.",
                "Introducir en heladora y dejar congelar."
            ]
        },
        {
            "id": "VARIOS 105",
            "nombre": "Sorbete de Lim√≥n",
            "categoria": "Helados & Sorbetes",
            "ingredientes": [
                { "nombre": "Zumo de lim√≥n", "cantidad": 200, "unidad": "gr" },
                { "nombre": "Az√∫car", "cantidad": 200, "unidad": "gr" },
                { "nombre": "Glucosa", "cantidad": 100, "unidad": "gr" },
                { "nombre": "Maicena", "cantidad": 20, "unidad": "gr" },
                { "nombre": "Agua", "cantidad": 480, "unidad": "gr" }
            ],
            "elaboracion": [
                "Mezclar sacarosa con maicena, a√±adir agua y cocer.",
                "Enfriar, a√±adir zumo y helar."
            ]
        },
        {
            "id": "VARIOS 118",
            "nombre": "Mousse de Cava",
            "categoria": "Helados & Sorbetes",
            "ingredientes": [
                { "nombre": "Cava", "cantidad": 750, "unidad": "ml" },
                { "nombre": "Az√∫car", "cantidad": 360, "unidad": "gr" },
                { "nombre": "Gelatina", "cantidad": 24, "unidad": "gr" },
                { "nombre": "Yemas", "cantidad": 3, "unidad": "unidades" },
                { "nombre": "Nata l√≠quida", "cantidad": 400, "unidad": "ml" }
            ],
            "elaboracion": [
                "Calentar cava con az√∫car y gelatina.",
                "A√±adir yemas, enfriar y mezclar con nata montada.",
                "Congelar."
            ]
        },
        {
            "id": "VARIOS 97",
            "nombre": "Sorbete de Naranja",
            "categoria": "Helados & Sorbetes",
            "ingredientes": [
                { "nombre": "Agua", "cantidad": 250, "unidad": "ml" },
                { "nombre": "Az√∫car", "cantidad": 150, "unidad": "gr" },
                { "nombre": "Ralladura de naranja", "cantidad": 1, "unidad": "cantidad" },
                { "nombre": "Zumo de naranja", "cantidad": 500, "unidad": "ml" },
                { "nombre": "Clara de huevo", "cantidad": 1, "unidad": "unidad" }
            ],
            "elaboracion": [
                "Hacer alm√≠bar con agua y az√∫car.",
                "A√±adir ralladura, zumo y clara batida.",
                "Congelar en heladora."
            ]
        },
        {
            "id": "VARIOS 106",
            "nombre": "Bavarois de Chocolate",
            "categoria": "Helados & Sorbetes",
            "ingredientes": [
                { "nombre": "Chocolate negro", "cantidad": 200, "unidad": "gr" },
                { "nombre": "Leche", "cantidad": 500, "unidad": "ml" },
                { "nombre": "Az√∫car", "cantidad": 100, "unidad": "gr" },
                { "nombre": "Huevos", "cantidad": 4, "unidad": "unidades" },
                { "nombre": "Gelatina", "cantidad": 10, "unidad": "gr" }
            ],
            "elaboracion": [
                "Derretir chocolate con leche y az√∫car.",
                "A√±adir yemas, gelatina reblandecida.",
                "Montar claras y nata, incorporar.",
                "Enmoldar y refrigerar."
            ]
        },
        // === RELLENOS & COBERTURAS ===
        {
            "id": "VARIOS 221",
            "nombre": "Coulis de Frutos Rojos",
            "categoria": "Rellenos & Coberturas",
            "ingredientes": [
                { "nombre": "Fruta roja", "cantidad": 1000, "unidad": "gr" },
                { "nombre": "Az√∫car", "cantidad": 400, "unidad": "gr" },
                { "nombre": "Agua", "cantidad": 250, "unidad": "ml" }
            ],
            "elaboracion": [
                "Hervir todos los ingredientes hasta densidad media.",
                "Triturar y colar por chino fino."
            ]
        },
        {
            "id": "VARIOS 215",
            "nombre": "Glassa Antihumedad",
            "categoria": "Decoraci√≥n & Acabados",
            "ingredientes": [
                { "nombre": "Az√∫car glass", "cantidad": 500, "unidad": "gr" },
                { "nombre": "Clara de huevo deshidratada", "cantidad": 20, "unidad": "gr" },
                { "nombre": "Agua", "cantidad": 100, "unidad": "ml" }
            ],
            "elaboracion": [
                "Mezclar todos los ingredientes hasta homogeneidad.",
                "Dejar reposar 12 horas tapado.",
                "Ideal para decorar tartas sin que se humedezcan."
            ]
        },
        {
            "id": "VARIOS 223",
            "nombre": "Coulis de Manzana",
            "categoria": "Rellenos & Coberturas",
            "ingredientes": [
                { "nombre": "Manzanas", "cantidad": 500, "unidad": "gr" },
                { "nombre": "Agua", "cantidad": 375, "unidad": "gr" },
                { "nombre": "Az√∫car", "cantidad": 75, "unidad": "gr" },
                { "nombre": "Zumo de lim√≥n", "cantidad": 1, "unidad": "unidad" },
                { "nombre": "Vainilla", "cantidad": 0.25, "unidad": "vaina" }
            ],
            "elaboracion": [
                "Cocer manzanas con resto de ingredientes.",
                "Triturar, colar y ajustar espesor."
            ]
        },
        {
            "id": "VARIOS 224",
            "nombre": "Coulis de Kiwi",
            "categoria": "Rellenos & Coberturas",
            "ingredientes": [
                { "nombre": "Kiwi", "cantidad": 500, "unidad": "gr" },
                { "nombre": "Az√∫car", "cantidad": 150, "unidad": "gr" },
                { "nombre": "Agua", "cantidad": 100, "unidad": "ml" }
            ],
            "elaboracion": [
                "Pelar y triturar kiwi.",
                "A√±adir az√∫car y agua.",
                "Cocer ligeramente y colar."
            ]
        },
        {
            "id": "VARIOS 216",
            "nombre": "Ba√±o de Cobertura",
            "categoria": "Decoraci√≥n & Acabados",
            "ingredientes": [
                { "nombre": "Cobertura negra", "cantidad": 1000, "unidad": "gr" },
                { "nombre": "Mantequilla", "cantidad": 1000, "unidad": "gr" },
                { "nombre": "Glucosa", "cantidad": 2, "unidad": "cda" }
            ],
            "elaboracion": [
                "Derretir cobertura con mantequilla y glucosa.",
                "Usar como ba√±o para tartas y bombones."
            ]
        },
        // === DECORACI√ìN & ACABADOS ===
        {
            "id": "VARIOS 225",
            "nombre": "Merengue Italiano",
            "categoria": "Decoraci√≥n & Acabados",
            "ingredientes": [
                { "nombre": "Claras de huevo", "cantidad": 100, "unidad": "gr" },
                { "nombre": "Az√∫car", "cantidad": 200, "unidad": "gr" },
                { "nombre": "Agua", "cantidad": 50, "unidad": "ml" },
                { "nombre": "Az√∫car invertido", "cantidad": 10, "unidad": "gr" }
            ],
            "elaboracion": [
                "Calentar az√∫car, agua y az√∫car invertido hasta 118¬∞C.",
                "Verter sobre claras batidas a punto de nieve.",
                "Seguir batiendo hasta enfriar."
            ]
        },
        {
            "id": "VARIOS 226",
            "nombre": "Salsa de Fresa",
            "categoria": "Decoraci√≥n & Acabados",
            "ingredientes": [
                { "nombre": "Fresas", "cantidad": 500, "unidad": "gr" },
                { "nombre": "Az√∫car", "cantidad": 150, "unidad": "gr" },
                { "nombre": "Agua", "cantidad": 100, "unidad": "ml" },
                { "nombre": "Glucosa", "cantidad": 50, "unidad": "gr" },
                { "nombre": "Lim√≥n", "cantidad": 1, "unidad": "unidad" }
            ],
            "elaboracion": [
                "Cocer fresas con az√∫car, agua, glucosa y lim√≥n.",
                "Triturar y colar."
            ]
        },
        {
            "id": "VARIOS 227",
            "nombre": "Salsa de M√≥dena",
            "categoria": "Decoraci√≥n & Acabados",
            "ingredientes": [
                { "nombre": "Vinagre de m√≥dena", "cantidad": 200, "unidad": "gr" },
                { "nombre": "Az√∫car", "cantidad": 400, "unidad": "gr" },
                { "nombre": "Zumo de lim√≥n", "cantidad": 1, "unidad": "chorro" },
                { "nombre": "Agua", "cantidad": 1, "unidad": "chorro" }
            ],
            "elaboracion": [
                "Reducir vinagre. Hacer caramelo rubio con az√∫car.",
                "Mezclar ambas elaboraciones. Debe quedar meloso."
            ]
        },
        // === NUEVAS RECETAS ADICIONALES PARA COMPLETAR 73 ===
        {
            "id": "VARIOS 174",
            "nombre": "Trufa con Leche",
            "categoria": "Dulces & Confites",
            "ingredientes": [
                { "nombre": "Nata", "cantidad": 300, "unidad": "gr" },
                { "nombre": "Cobertura blanca", "cantidad": 500, "unidad": "gr" },
                { "nombre": "Leche condensada", "cantidad": 100, "unidad": "gr" }
            ],
            "elaboracion": [
                "Calentar nata, a√±adir cobertura blanca y leche condensada.",
                "Dejar enfriar, hacer bolas y rodar en cacao."
            ]
        },
        {
            "id": "VARIOS 197",
            "nombre": "Marquesas",
            "categoria": "Bizcochos, Magdalenas & Muffins",
            "ingredientes": [
                { "nombre": "Huevos", "cantidad": 6, "unidad": "unidades" },
                { "nombre": "Az√∫car", "cantidad": 150, "unidad": "gr" },
                { "nombre": "Harina", "cantidad": 150, "unidad": "gr" },
                { "nombre": "Mantequilla", "cantidad": 50, "unidad": "gr" }
            ],
            "elaboracion": [
                "Batir huevos con az√∫car hasta triplicar volumen.",
                "Incorporar harina y mantequilla derretida con cuidado.",
                "Hornear a 180¬∞C durante 25 minutos."
            ],
            "temperatura": 180,
            "tiempo": 25
        },
        {
            "id": "VARIOS 171",
            "nombre": "San Honore",
            "categoria": "Tartas Premium",
            "ingredientes": [
                { "nombre": "Pasta choux", "cantidad": 1, "unidad": "masa" },
                { "nombre": "Pasta sable", "cantidad": 1, "unidad": "masa" },
                { "nombre": "Crema San Honore", "cantidad": 500, "unidad": "gr" },
                { "nombre": "Caramelo", "cantidad": 100, "unidad": "gr" }
            ],
            "elaboracion": [
                "Elaborar profiteroles con pasta choux.",
                "Montar base con pasta sable.",
                "Rellenar con crema, colocar profiteroles y abrillantar con caramelo."
            ]
        },
        {
            "id": "VARIOS 122",
            "nombre": "Tarta de Frambuesas",
            "categoria": "Tartas del Ayer",
            "ingredientes": [
                { "nombre": "Base de galleta", "cantidad": 1, "unidad": "unidad" },
                { "nombre": "Crema pastelera", "cantidad": 300, "unidad": "gr" },
                { "nombre": "Frambuesas", "cantidad": 400, "unidad": "gr" },
                { "nombre": "Gelatina de frambuesa", "cantidad": 1, "unidad": "sobre" }
            ],
            "elaboracion": [
                "Rellenar base con crema pastelera.",
                "Colocar frambuesas encima.",
                "Abrillantar con gelatina."
            ]
        },
        {
            "id": "VARIOS 129",
            "nombre": "Tarta de Queso (2¬™ Forma)",
            "categoria": "Tartas del Ayer",
            "ingredientes": [
                { "nombre": "Queso crema", "cantidad": 500, "unidad": "gr" },
                { "nombre": "Az√∫car", "cantidad": 150, "unidad": "gr" },
                { "nombre": "Huevos", "cantidad": 4, "unidad": "unidades" },
                { "nombre": "Galletas", "cantidad": 200, "unidad": "gr" },
                { "nombre": "Mantequilla", "cantidad": 100, "unidad": "gr" },
                { "nombre": "Coulis de fruta", "cantidad": 200, "unidad": "gr" }
            ],
            "elaboracion": [
                "Base con galletas y mantequilla.",
                "Mezclar queso, az√∫car y huevos.",
                "Verter sobre base y hornear al ba√±o Mar√≠a.",
                "Desmoldar y cubrir con coulis."
            ],
            "temperatura": 160,
            "tiempo": 50
        },
        {
            "id": "VARIOS 46",
            "nombre": "Nata Montada",
            "categoria": "Rellenos & Coberturas",
            "ingredientes": [
                { "nombre": "Nata l√≠quida", "cantidad": 1000, "unidad": "ml" },
                { "nombre": "Az√∫car", "cantidad": 125, "unidad": "gr" }
            ],
            "elaboracion": [
                "Batir nata fr√≠a con az√∫car hasta punto firme."
            ]
        },
        {
            "id": "VARIOS 45",
            "nombre": "Merengue R√°pido",
            "categoria": "Decoraci√≥n & Acabados",
            "ingredientes": [
                { "nombre": "Claritas", "cantidad": 400, "unidad": "gr" },
                { "nombre": "Az√∫car", "cantidad": 600, "unidad": "gr" }
            ],
            "elaboracion": [
                "Mezclar y calentar al ba√±o Mar√≠a hasta disolver az√∫car.",
                "Batir hasta enfriar y tener cuerpo firme."
            ]
        }
    ];
    /* ========================================================== */

    // Estado global
    let favoritos = JSON.parse(localStorage.getItem('favoritos')||"[]");
    let notas = JSON.parse(localStorage.getItem('notas')||"{}");
    let historial = [];                  // stack de vistas
    let recetaActual = null;
    let ultimaRecetaId = null;
    let temporizador = { active:false, time:0, timer:null, originalTime:0, recetaId:null };

    // Utilidades de la interfaz
    function clearViews(){ document.querySelectorAll('.view,.modal').forEach(n=>n.remove()); document.getElementById('pantalla-principal').style.display='none'; }
    function showPrincipal(){ clearViews(); document.getElementById('pantalla-principal').style.display='flex'; historial = []; }
    function pushHistory(view,data){ historial.push({view,data}); }

    // Navegaci√≥n robusta: push opcional
    function setView(view, data={}, push=true){
        if (push) pushHistory(view,data);
        clearViews();

        const container = document.createElement('div');
        container.className = 'view';
        const inner = document.createElement('div');
        inner.className = 'view-inner';

        // Helpers para generar contenido
        function makeBack(){ return `<button class="view-back" onclick="goBack()">‚Üê Atr√°s</button>`; }

        if (view === 'menu'){
            inner.innerHTML = makeBack() + `<div class="view-title" style="font-weight:900;margin-bottom:12px">Men√∫</div>
                <div class="section-card">
                    <button class="btn btn-primario" onclick="setView('categorias')">Categor√≠as</button>
                    <button class="btn" style="background:#b36f3c;color:#fff" onclick="setView('favoritos')">Recetas estrella</button>
                    <button class="btn btn-accent" onclick="openUltima()">√öltima receta</button>
                </div>`;
        }

        else if (view === 'categorias'){
            const cats = [...new Set(recetas.map(r => r.categoria).filter(Boolean))];
            inner.innerHTML = makeBack() + `<div class="view-title">Categor√≠as</div>
                <div class="section-card">${cats.length ? cats.map(c => `<button class="btn" onclick="setView('recetas',{categoria:'${escapeHtml(c)}'})">${escapeHtml(c)}</button>`).join('') : '<div>No hay categor√≠as</div>'}</div>`;
        }

        else if (view === 'recetas'){
            const cat = data.categoria || '';
            const list = recetas.filter(r => r.categoria === cat);
            inner.innerHTML = makeBack() + `<div class="view-title">${escapeHtml(cat)}</div>
                <div class="section-card">${list.length ? list.map(r => `<button class="btn" onclick="setView('receta',{id:'${r.id}'})">${escapeHtml(r.nombre)}</button>`).join('') : '<div>No hay recetas en esta categor√≠a</div>'}</div>`;
        }

        else if (view === 'receta'){
            recetaActual = recetas.find(r => r.id === data.id);
            if (!recetaActual){
                inner.innerHTML = makeBack() + `<div class="view-title">Receta no encontrada</div>`;
            } else {
                ultimaRecetaId = recetaActual.id;
                const porDefault = recetaActual.porciones || 4;
                inner.innerHTML = makeBack() + `<div class="view-title">${escapeHtml(recetaActual.nombre)} 
                    <button style="margin-left:10px;padding:6px 10px;font-weight:900" onclick="toggleFavorito('${recetaActual.id}')">${favoritos.includes(recetaActual.id)?'‚òÖ':'‚òÜ'}</button>
                    </div>
                    <div style="margin-bottom:8px"><strong>Categor√≠a:</strong> ${escapeHtml(recetaActual.categoria||'')}</div>
                    
                    ${recetaActual.tiempo ? `<div style="margin-bottom:8px"><strong>Tiempo estimado:</strong> ${recetaActual.tiempo} minutos</div>` : ''}

                    <div class="section-card">
                        <div style="display:flex;gap:10px;align-items:center;margin-bottom:8px">
                            <label style="font-weight:900">Porciones</label>
                            <input id="calc-input" type="number" min="1" value="${porDefault}" style="width:80px;padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,.08)" />
                        </div>
                        <div class="ingredientes-lista"><strong>Ingredientes</strong>
                            <ul id="ingredientes-list">${renderIngredientes(recetaActual, porDefault)}</ul>
                        </div>
                        <div class="elaboracion-lista"><strong>Elaboraci√≥n</strong>
                            <ol>${(recetaActual.elaboracion||[]).map(p => `<li>${escapeHtml(p)}</li>`).join('')}</ol>
                        </div>

                        <div id="temporizador-panel" class="temporizador-panel section-card" style="text-align:center;margin-top:8px"></div>

                        <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
                            <button class="btn btn-accent" onclick="setView('notas',{id:'${recetaActual.id}'})">Notas personales</button>
                            <button class="btn" style="background:#2d5b2f;color:#fff" onclick="compartirReceta('${recetaActual.id}')">Compartir</button>
                        </div>
                    </div>`;

                // after inner html appended to DOM, attach handlers
                setTimeout(()=>{ 
                    const calc = document.getElementById('calc-input');
                    if (calc) calc.addEventListener('change', ()=>actualizaPorciones(recetaActual.id));
                    
                    temporizador.time = (recetaActual.tiempo ? recetaActual.tiempo*60 : 0);
                    temporizador.originalTime = temporizador.time;
                    temporizador.recetaId = recetaActual.id;
                    updateTemporizadorPanel();
                }, 0);
            }
        }

        else if (view === 'favoritos'){
            const favs = recetas.filter(r => favoritos.includes(r.id));
            inner.innerHTML = makeBack() + `<div class="view-title">Recetas estrella</div>
                <div class="section-card">${favs.length ? favs.map(r => `<button class="btn" onclick="setView('receta',{id:'${r.id}'})">${escapeHtml(r.nombre)}</button>`).join('') : '<div>No hay favoritas</div>'}</div>`;
        }

        else if (view === 'notas'){
            const id = data.id || Object.keys(notas)[0] || '';
            const rec = recetas.find(r=>r.id===id);
            const nombre = rec ? rec.nombre : 'General';
            const txt = notesGet(id);
            inner.innerHTML = makeBack() + `<div class="view-title">Notas sobre ${escapeHtml(nombre)}</div>
                <textarea id="nota-txt">${escapeHtml(txt)}</textarea>
                <div class="notas-toolbar">
                    <button class="notas-btn btn-primario" onclick="guardarNota('${id}')">Guardar</button>
                    <button class="notas-btn btn-accent" onclick="compartirNota('${id}')">Compartir</button>
                </div>`;
        }

        else {
            inner.innerHTML = makeBack() + `<div class="view-title">${escapeHtml(view)}</div>`;
        }

        container.appendChild(inner);
        document.body.appendChild(container);
    }

    // goBack: restaura la vista anterior del historial
    function goBack(){
        // quitar la vista actual
        if (historial.length) historial.pop();
        if (historial.length){
            const prev = historial[historial.length - 1];
            setView(prev.view, prev.data, false);
        } else {
            showPrincipal();
        }
    }

    // Helpers de renderizado y seguridad
    function escapeHtml(s){ if(!s && s!==0) return ''; return String(s).replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c])); }
    function renderIngredientes(rec, personas){
        const por = personas / (rec.porciones || 4);
        return (rec.ingredientes || []).map(i => {
            const cant = Math.round((i.cantidad||0) * por * 100) / 100;
            return `<li>${escapeHtml(i.nombre)} ‚Äî ${cant} ${escapeHtml(i.unidad||'')}</li>`;
        }).join('');
    }

    // Calculadora de porciones
    function actualizaPorciones(id){
        const rec = recetas.find(r=>r.id === id);
        if (!rec) return;
        const val = parseInt(document.getElementById('calc-input').value) || 1;
        const ul = document.getElementById('ingredientes-list');
        if (ul) ul.innerHTML = renderIngredientes(rec, val);
    }

    // Favoritos
    function toggleFavorito(id){
        if (favoritos.includes(id)) favoritos = favoritos.filter(x=>x!==id);
        else favoritos.push(id);
        localStorage.setItem('favoritos', JSON.stringify(favoritos));
        // refresh current receta view without pushing history
        if (recetaActual && recetaActual.id === id) setView('receta',{id}, false);
    }

    // Notas
    function notesGet(id){ return notas[id] || ""; }
    function guardarNota(id){
        if (!id) { alert('Selecciona o abre una receta para asociar la nota.'); return; }
        const val = document.getElementById('nota-txt')?.value || "";
        notas[id] = val;
        localStorage.setItem('notas', JSON.stringify(notas));
        alert('Nota guardada');
    }
    function compartirNota(id){
        const r = recetas.find(x=>x.id===id);
        const nombre = r ? r.nombre : 'Nota de receta';
        const txt = notas[id] || "";
        if (navigator.share) navigator.share({ title: nombre, text: txt });
        else navigator.clipboard.writeText(txt).then(()=> alert('Nota copiada al portapapeles'));
    }

    // Compartir receta (texto plano)
    function compartirReceta(id){
        const r = recetas.find(x=>x.id===id); if(!r) return;
        const txt = `Receta: ${r.nombre}\nCategor√≠a: ${r.categoria}\nIngredientes:\n${(r.ingredientes||[]).map(i=>`${i.nombre}: ${i.cantidad} ${i.unidad||''}`).join('\n')}\n\nElaboraci√≥n:\n${(r.elaboracion||[]).map((p,i)=>`${i+1}. ${p}`).join('\n')}`;
        if (navigator.share) navigator.share({ title: r.nombre, text: txt });
        else navigator.clipboard.writeText(txt).then(()=> alert('Receta copiada al portapapeles'));
    }

    // Temporizador (simple)
    function updateTemporizadorPanel(){
        const panel = document.getElementById('temporizador-panel');
        if(!panel) return;

        const startBtn = `<button class="btn btn-primario temporizador-btn" onclick="startTemporizador()">Iniciar</button>`;
        const pauseBtn = `<button class="btn btn-accent temporizador-btn" onclick="pauseTemporizador()">Pausar</button>`;
        const resetBtn = `<button class="btn temporizador-btn" onclick="resetTemporizador()">Reset</button>`;
        
        // Muestra Iniciar o Pausar dependiendo del estado
        const controlBtn = temporizador.active ? pauseBtn : startBtn;

        if (temporizador.time > 0 || temporizador.originalTime > 0) {
            panel.innerHTML = `<div class="temporizador-time">${formatTime(temporizador.time)}</div>
                <div class="temporizador-controls">
                    ${controlBtn}
                    ${resetBtn}
                </div>`;
        } else {
            // No muestra el panel si no hay tiempo definido para la receta
            panel.innerHTML = `<div style="font-size: 0.9em;">(Tiempo de cocci√≥n no especificado)</div>`;
        }
    }
    function formatTime(s){ s = Math.max(0, Math.floor(s||0)); const m = Math.floor(s/60), sec = s%60; return `${m<10?'0':''}${m}:${sec<10?'0':''}${sec}`; }
    function startTemporizador(){
        if (temporizador.active || temporizador.time <= 0) return;
        temporizador.active = true;
        updateTemporizadorPanel(); // Actualiza el bot√≥n a "Pausar"
        temporizador.timer = setInterval(()=>{ 
            temporizador.time--; 
            updateTemporizadorPanel(); 
            if (temporizador.time <= 0){ 
                clearInterval(temporizador.timer); 
                temporizador.active=false; 
                beep(); 
                alert('¬°Tiempo de cocci√≥n finalizado!'); 
                resetTemporizador(); // Reinicia el tiempo a la duraci√≥n original
            } 
        }, 1000);
    }
    function pauseTemporizador(){ 
        temporizador.active=false; 
        clearInterval(temporizador.timer); 
        updateTemporizadorPanel(); 
    }
    function resetTemporizador(){ 
        temporizador.active=false; 
        clearInterval(temporizador.timer); 
        temporizador.time = temporizador.originalTime || 0; 
        updateTemporizadorPanel(); 
    }
    function beep(){
        try{
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const o = ctx.createOscillator(); const g = ctx.createGain();
            o.type='sine'; o.frequency.value=880; g.gain.value=0.2;
            o.connect(g); g.connect(ctx.destination); o.start();
            setTimeout(()=>{ o.stop(); ctx.close(); }, 800);
        }catch(e){}
    }

    // Buscador modal de resultados
    function showModalBusqueda(items){
        closeModal();
        const m = document.createElement('div'); m.className='modal';
        const card = document.createElement('div'); card.className='modal-card';
        card.innerHTML = `<h3>Resultados (${items.length})</h3>`;
        const list = document.createElement('div'); list.className='modal-list';
        if (items.length === 0) list.innerHTML = `<div>No se encontraron recetas.</div>`;
        else items.forEach(r => {
            const btn = document.createElement('button'); btn.className='btn btn-primario';
            btn.textContent = r.nombre + (r.categoria ? ` (${r.categoria})` : '');
            btn.onclick = ()=>{ closeModal(); setView('receta',{id:r.id}); };
            list.appendChild(btn);
        });
        const closeBtn = document.createElement('button'); closeBtn.className='btn'; closeBtn.textContent='Cerrar'; closeBtn.onclick = closeModal;
        card.appendChild(list); card.appendChild(closeBtn); m.appendChild(card); document.body.appendChild(m);
    }
    function closeModal(){ document.querySelectorAll('.modal').forEach(n=>n.remove()); }

    // Buscador inteligente (overlay)
    function showBuscadorInteligente(){
        closeModal();
        const m = document.createElement('div'); m.className='modal';
        const card = document.createElement('div'); card.className='modal-card';
        card.innerHTML = `<h3>Opciones de B√∫squeda</h3>`;
        const wrap = document.createElement('div'); wrap.className='modal-list';
        const btn1 = document.createElement('button'); btn1.className='btn btn-accent'; btn1.textContent='Filtrar por ingrediente'; btn1.onclick = ()=>{ closeModal(); filtroIngrediente(); };
        const btn2 = document.createElement('button'); btn2.className='btn btn-accent'; btn2.textContent='Filtrar por tiempo m√°ximo'; btn2.onclick = ()=>{ closeModal(); filtroTiempo(); };
        const btn3 = document.createElement('button'); btn3.className='btn btn-accent'; btn3.textContent='Filtrar por dificultad (texto)'; btn3.onclick = ()=>{ closeModal(); filtroDificultad(); };
        const btnFav = document.createElement('button'); btnFav.className='btn btn-primario'; btnFav.textContent='Ver Favoritos'; btnFav.onclick = ()=>{ closeModal(); setView('favoritos'); };
        const btnClose = document.createElement('button'); btnClose.className='btn'; btnClose.textContent='Cerrar'; btnClose.onclick=closeModal;
        wrap.appendChild(btn1); wrap.appendChild(btn2); wrap.appendChild(btn3); wrap.appendChild(btnFav);
        card.appendChild(wrap); card.appendChild(btnClose); m.appendChild(card); document.body.appendChild(m);
    }

    function filtroIngrediente(){
        const q = prompt('Escribe el ingrediente para filtrar (ej: harina):');
        if(!q) return;
        const terms = q.toLowerCase();
        const res = recetas.filter(r => (r.ingredientes||[]).some(i => (i.nombre||'').toLowerCase().includes(terms)));
        showModalBusqueda(res);
    }
    function filtroTiempo(){
        const q = prompt('Tiempo m√°ximo de cocci√≥n (minutos):');
        if(!q) return;
        const n = parseInt(q);
        if (isNaN(n)) return alert('Introduce un n√∫mero v√°lido.');
        const res = recetas.filter(r => (r.tiempo||0) > 0 && (r.tiempo||0) <= n);
        showModalBusqueda(res);
    }
    function filtroDificultad(){
        const q = prompt('Dificultad (ej: facil, media, etc.):');
        if(!q) return;
        const t = q.toLowerCase();
        const res = recetas.filter(r => ((r.dificultad||'') + '').toLowerCase().includes(t));
        showModalBusqueda(res);
    }

    // Util: abrir √∫ltima receta
    function openUltima(){
        if (ultimaRecetaId) setView('receta',{id:ultimaRecetaId});
        else alert('No has visitado ninguna receta a√∫n.');
    }

    // Buscador input handler
    function onSearchInput(ev){
        const q = (ev.target.value || '').trim().toLowerCase();
        if (!q) { closeModal(); return; } // Limpiar si no hay texto
        
        // B√∫squeda por nombre o categor√≠a
        const res = recetas.filter(r => ((r.nombre||'') + ' ' + (r.categoria||'')).toLowerCase().includes(q));
        showModalBusqueda(res);
    }

    // Small debounce helper
    function debounce(fn, wait){ let t; return function(...a){ clearTimeout(t); t = setTimeout(()=>fn.apply(this,a), wait); }; }


    // Inicializaci√≥n de la aplicaci√≥n
    document.addEventListener('DOMContentLoaded', ()=>{
        // Asume modo-oscuro est√° deshabilitado por defecto
        document.getElementById('btn-modo').addEventListener('click', ()=> document.body.classList.toggle('modo-oscuro'));
        document.getElementById('btn-buscador-inteligente').addEventListener('click', showBuscadorInteligente);
        document.getElementById('btn-menu').addEventListener('click', ()=> setView('menu'));
        document.getElementById('btn-favoritos').addEventListener('click', ()=> setView('favoritos'));
        document.getElementById('btn-notas').addEventListener('click', ()=> {
            const id = recetaActual?.id || Object.keys(notas)[0] || '';
            if (!id && Object.keys(notas).length === 0) return alert('Abre una receta para ver o crear notas.');
            setView('notas',{id});
        });
        document.getElementById('buscador').addEventListener('input', debounce(onSearchInput, 300));
        
        // Comienza en la pantalla principal
        showPrincipal();
    });

    </script>
</body>
</html>
