import React, { useState, useMemo } from 'react';
import { Search, SlidersHorizontal, Star, X, Clock, Salad, Utensils, Zap, MinusCircle, Maximize2 } from 'lucide-react';

/**
 * --- Estructura de Estado de Filtros ---
 * Se mantiene la estructura de filtros para la lógica de filtrado.
 */
const initialFilterState = {
    // RANGOS (Min y Max)
    preparationTime: { min: 5, max: 120 },
    cookingTime: { min: 5, max: 120 },
    totalTime: { min: 10, max: 240 },
    ingredientCount: { min: 3, max: 20 },
    // LISTA DE VALORES
    difficulty: [1, 2, 3, 4, 5],
    rating: [1, 2, 3, 4, 5],
    // VALORES ESPECIALES
    excludedIngredient: '', 
};

// Límite de rangos
const filterLimits = {
    totalTime: { min: 10, max: 240, unit: 'min' },
    ingredientCount: { min: 3, max: 20, unit: 'unidades' },
};


// --- Componente para mostrar las estrellas de dificultad ---
const DifficultyStars = ({ rating }) => {
    return (
        <div className="flex items-center space-x-0.5">
            {[1, 2, 3, 4, 5].map((star) => (
                <Star
                    key={star}
                    className={`w-4 h-4 transition-colors duration-150 ${
                        star <= rating ? 'text-yellow-400 fill-yellow-400' : 'text-gray-300'
                    }`}
                />
            ))}
        </div>
    );
};

// --- Componente de Tarjeta de Receta (Mock para visualización) ---
const RecipeCard = ({ recipe }) => (
    <div className="bg-white rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300 overflow-hidden border border-gray-100">
        <div className="relative h-48 sm:h-56">
            <img 
                src={recipe.image} 
                alt={recipe.title} 
                className="w-full h-full object-cover" 
                onError={(e) => { e.target.onerror = null; e.target.src = "https://placehold.co/600x400/1E3A8A/FFFFFF?text=Receta"; }}
            />
            <div className="absolute top-3 right-3 bg-indigo-600 text-white text-xs font-semibold px-3 py-1 rounded-full shadow-md flex items-center">
                <Clock className="w-3 h-3 mr-1" />
                {recipe.totalTime} min
            </div>
        </div>
        <div className="p-4 sm:p-5">
            <h3 className="text-xl font-bold text-gray-800 mb-1 line-clamp-2">{recipe.title}</h3>
            <div className="flex items-center justify-between mb-3">
                <DifficultyStars rating={recipe.difficulty} />
                <span className="text-sm font-medium text-indigo-600">{recipe.category}</span>
            </div>
            <div className="flex justify-between text-sm text-gray-600 border-t border-gray-100 pt-3">
                <div className="flex items-center">
                    <Utensils className="w-4 h-4 mr-1 text-gray-400" />
                    <span>Prep: {recipe.prepTime} min</span>
                </div>
                <div className="flex items-center">
                    <Salad className="w-4 h-4 mr-1 text-gray-400" />
                    <span>Ingr: {recipe.ingredients}</span>
                </div>
            </div>
        </div>
    </div>
);


// --- Mock de Recetas para Visualización ---
const mockRecipes = [
    { id: 1, title: "Lomo Saltado Peruano Auténtico", category: "Carnes", prepTime: 20, cookingTime: 25, totalTime: 45, ingredients: 8, difficulty: 4, rating: 4.5, image: "https://placehold.co/600x400/EF4444/FFFFFF?text=Lomo+Saltado", tags: ["carne", "peruano", "salado"] },
    { id: 2, title: "Sopa de Tomate y Albahaca Rápida", category: "Sopas", prepTime: 10, cookingTime: 15, totalTime: 25, ingredients: 5, difficulty: 2, rating: 3.8, image: "https://placehold.co/600x400/10B981/FFFFFF?text=Sopa+Tomate", tags: ["vegetariano", "sopa", "rápida"] },
    { id: 3, title: "Curry de Garbanzos y Espinacas Vegano", category: "Vegetariano", prepTime: 15, cookingTime: 30, totalTime: 45, ingredients: 12, difficulty: 3, rating: 4.2, image: "https://placehold.co/600x400/3B82F6/FFFFFF?text=Curry+Vegano", tags: ["vegano", "curry", "salado"] },
    { id: 4, title: "Tarta de Manzana Clásica Holandesa", category: "Postres", prepTime: 30, cookingTime: 60, totalTime: 90, ingredients: 10, difficulty: 5, rating: 4.9, image: "https://placehold.co/600x400/F97316/FFFFFF?text=Tarta+Manzana", tags: ["postre", "dulce", "horneado"] },
    { id: 5, title: "Ensalada César con Pollo Grillado", category: "Ensaladas", prepTime: 15, cookingTime: 10, totalTime: 25, ingredients: 8, difficulty: 2, rating: 4.0, image: "https://placehold.co/600x400/D97706/FFFFFF?text=Ensalada+Cesar", tags: ["ensalada", "pollo", "rápida"] },
    { id: 6, title: "Brownies de Chocolate Oscuro", category: "Postres", prepTime: 15, cookingTime: 30, totalTime: 45, ingredients: 7, difficulty: 3, rating: 4.7, image: "https://placehold.co/600x400/9333EA/FFFFFF?text=Brownies", tags: ["postre", "chocolate", "dulce"] },
];

// --- Componente de Botón de Filtro Rápido ---
const QuickFilterButton = ({ label, icon: Icon, colorClass, onClick }) => (
    <button 
        onClick={onClick}
        className={`w-full py-3 px-4 rounded-xl text-lg font-bold shadow-md transition duration-200 transform hover:scale-[1.02] active:scale-[0.98]
            ${colorClass} text-white flex items-center justify-center`}
    >
        {label} <Icon className="w-5 h-5 ml-3" />
    </button>
);


export default function App() {
    // Estado del texto de búsqueda
    const [searchTerm, setSearchTerm] = useState('');
    // Estado de los 5 filtros
    const [filterState, setFilterState] = useState(initialFilterState);
    // Controlar si el panel de filtros está abierto (Lo mantendremos FALSE por ahora)
    const [isFilterPanelOpen, setIsFilterPanelOpen] = useState(false);

    // Función universal para actualizar cualquier filtro (temporalmente solo para mock)
    const updateFilter = (key, value) => {
        setFilterState(prev => ({
            ...prev,
            [key]: value,
        }));
    };

    // Función para restablecer los filtros a su estado inicial
    const resetFilters = () => {
        setFilterState(initialFilterState);
    };

    // --- Lógica de filtrado (useMemo) ---
    const filteredRecipes = useMemo(() => {
        let results = mockRecipes;

        // 1. Filtrado por texto de búsqueda (Título y Tags)
        if (searchTerm) {
            const term = searchTerm.toLowerCase();
            results = results.filter(recipe => 
                recipe.title.toLowerCase().includes(term) ||
                recipe.tags.some(tag => tag.includes(term))
            );
        }

        // 2. Aplicar lógica de filtros (simplificada por ahora, solo para mantener la estructura)
        results = results.filter(recipe => {
            
            // a. Tiempo Total (solo usando el máximo como filtro base)
            if (recipe.totalTime > filterState.totalTime.max) return false;

            // b. Conteo de Ingredientes (solo usando el máximo como filtro base)
            if (recipe.ingredients > filterState.ingredientCount.max) return false;

            // c. Dificultad (Estrellas)
            if (!filterState.difficulty.includes(recipe.difficulty)) return false;

            // d. Rating (Top Puntuación)
            // if (!filterState.rating.includes(Math.floor(recipe.rating))) return false;

            // e. Ingrediente Excluido (simple chequeo de tag)
            if (filterState.excludedIngredient && recipe.tags.includes(filterState.excludedIngredient.toLowerCase())) return false;


            return true;
        });

        return results;
    }, [searchTerm, filterState]);

    // Función para simular la apertura de modales (y probar la lógica)
    const handleFilterClick = (filterName) => {
        console.log(`Abriendo modal para: ${filterName}`);
        // Aquí iría la lógica para mostrar el modal de React que contiene el input.
        // Por ahora, simularemos un cambio de estado para ver el impacto en el filtrado.
        
        if (filterName === 'tiempo') {
            // Ejemplo: Filtrar por tiempo máximo de 40 min
            updateFilter('totalTime', { min: 10, max: 40 });
        } else if (filterName === 'dificultad') {
            // Ejemplo: Filtrar solo dificultad 1 y 2
            updateFilter('difficulty', [1, 2]);
        } else if (filterName === 'excluir') {
            // Ejemplo: Excluir 'dulce'
            updateFilter('excludedIngredient', 'dulce');
        } else if (filterName === 'ingredientes') {
            // Ejemplo: Máximo 7 ingredientes
            updateFilter('ingredientCount', { min: 3, max: 7 });
        }
        
    };


    return (
        <div className="min-h-screen bg-gray-50 font-sans">
            {/* Header / Barra de Búsqueda Fija */}
            <header className="bg-white sticky top-0 z-10 shadow-lg p-4 sm:p-6 border-b border-indigo-100">
                <div className="max-w-4xl mx-auto flex flex-col space-y-4">
                    
                    <h1 className="text-3xl font-extrabold text-center text-indigo-700">
                        Buscador Inteligente <span className="text-pink-500">🧠</span>
                    </h1>

                    {/* Campo de Búsqueda de Texto */}
                    <div className="relative flex-grow">
                        <input
                            type="text"
                            placeholder="Buscar por nombre de receta, ingrediente o categoría..."
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                            className="w-full py-3 pl-10 pr-4 border border-gray-300 rounded-full focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 shadow-sm text-gray-700"
                        />
                        <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400" />
                    </div>

                    {/* Botones de Filtro Rápido (Replicando la estructura de la imagen) */}
                    <div className="grid grid-cols-2 md:grid-cols-5 gap-3">
                        <QuickFilterButton 
                            label="Tiempo Máximo" 
                            icon={Clock} 
                            colorClass="bg-indigo-500 hover:bg-indigo-600"
                            onClick={() => handleFilterClick('tiempo')}
                        />
                        <QuickFilterButton 
                            label="Dificultad" 
                            icon={Zap} 
                            colorClass="bg-yellow-500 hover:bg-yellow-600"
                            onClick={() => handleFilterClick('dificultad')}
                        />
                        <QuickFilterButton 
                            label="Excluir Ingrediente" 
                            icon={MinusCircle} 
                            colorClass="bg-red-500 hover:bg-red-600"
                            onClick={() => handleFilterClick('excluir')}
                        />
                         <QuickFilterButton 
                            label="Máx. Ingredientes" 
                            icon={Salad} 
                            colorClass="bg-green-500 hover:bg-green-600"
                            onClick={() => handleFilterClick('ingredientes')}
                        />
                        <QuickFilterButton 
                            label="Top Puntuación" 
                            icon={Star} 
                            colorClass="bg-purple-500 hover:bg-purple-600"
                            onClick={() => handleFilterClick('puntuacion')}
                        />
                    </div>
                </div>
            </header>

            <main className="max-w-4xl mx-auto p-4 sm:p-6 pt-0">
                
                {/* Indicador de Filtros Aplicados y Reset */}
                <div className="flex justify-between items-center py-4 mt-6 border-b border-gray-200">
                    <h2 className="text-2xl font-bold text-gray-800">
                        Resultados de la Búsqueda 
                        <span className="ml-2 text-indigo-600">({filteredRecipes.length} recetas)</span>
                    </h2>
                    {/* Botón de Resetear Filtros */}
                    <button
                        onClick={resetFilters}
                        className="text-sm font-medium text-red-500 hover:text-red-700 transition duration-150 flex items-center"
                        title="Resetear todos los filtros aplicados"
                    >
                        <X className="w-4 h-4 mr-1" />
                        Resetear
                    </button>
                </div>


                {/* Contenedor de Recetas */}
                <div className="mt-6 grid grid-cols-1 sm:grid-cols-2 gap-6 pb-12">
                    {filteredRecipes.length > 0 ? (
                        filteredRecipes.map(recipe => (
                            <RecipeCard key={recipe.id} recipe={recipe} />
                        ))
                    ) : (
                        <div className="col-span-1 sm:col-span-2 text-center py-10 bg-white rounded-xl shadow-md border border-gray-100">
                            <p className="text-lg text-gray-500 font-medium">
                                No se encontraron recetas que coincidan con los filtros aplicados.
                            </p>
                        </div>
                    )}
                </div>

            </main>
        </div>
    );
}
