<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Dulces Patxi</title>
<style>
:root{
  --bg:#0f1214;
  --panel:#181a1d;
  --card:#0f1113;
  --accent:#0ea5ff;
  --muted:#9aa6b2;
  --text:#eaf2f8;
  --glass:rgba(255,255,255,0.03);
  --radius:14px;
  --gap:16px;
}
html.light { --bg:#f6f7f9; --panel:#ffffff; --card:#ffffff; --accent:#0b6fb0; --muted:#55606a; --text:#101214; --glass:rgba(0,0,0,0.04); }
*{box-sizing:border-box}
body{margin:0;font-family:Inter, "Segoe UI", Roboto, Arial, sans-serif;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased;}
.app{min-height:100vh;display:flex;flex-direction:column;align-items:stretch;}
header{padding:28px 18px 6px 18px;text-align:center}
h1{margin:0;font-size:34px;color:var(--accent)}
.welcome{white-space:pre;font-weight:700;color:var(--muted);line-height:1.05;margin-top:8px}
main{max-width:980px;margin:0 auto;padding:18px;flex:1 1 auto;width:100%}
.search-row{display:flex;justify-content:center;margin-bottom:18px}
.search-input{width:100%;max-width:820px;padding:14px 48px 14px 16px;border-radius:12px;border:0;background:linear-gradient(180deg,var(--panel),#0b0d0f);color:var(--text);font-size:16px;box-shadow:0 8px 24px rgba(0,0,0,0.5)}
.search-icon{position:relative;margin-left:-44px;margin-top:10px;color:var(--muted);font-size:18px}
.grid{display:grid;grid-template-columns:1fr;gap:var(--gap)}
@media(min-width:760px){.grid{grid-template-columns:repeat(2,1fr)}}
.btn{display:flex;align-items:center;justify-content:center;padding:20px;font-size:18px;font-weight:900;border-radius:var(--radius);border:0;cursor:pointer;background:linear-gradient(145deg,var(--card),#0b0d0f);color:var(--accent);min-height:88px;box-shadow:6px 6px 20px rgba(0,0,0,0.6),-6px -6px 18px rgba(255,255,255,0.02)}
.btn.large{font-size:20px;padding:24px;min-height:110px}
.btn:hover{transform:translateY(-4px);transition:transform .14s ease}
.view{display:none}
.view.active{display:block}
.page-head{display:flex;align-items:center;gap:12px;margin-bottom:12px}
.back{border:0;padding:10px 12px;border-radius:10px;background:var(--panel);color:var(--accent);font-weight:800;cursor:pointer}
.title{font-weight:900;font-size:20px;color:var(--accent)}
.list{display:flex;flex-direction:column;gap:12px;margin-top:8px}
.card{background:linear-gradient(180deg,var(--card),#0f1113);padding:14px;border-radius:12px;color:var(--text);box-shadow:0 8px 28px rgba(0,0,0,0.5)}
.muted{color:var(--muted);font-size:13px}
.recipe-body{display:flex;flex-direction:column;gap:12px}
.section-box{padding:12px;border-radius:10px;background:var(--glass)}
.ingredientes ul{margin:0;padding-left:18px}
.elaboracion ol{margin:0;padding-left:18px}
.timer-inline{display:flex;gap:8px;align-items:center}
.timer-select{padding:8px;border-radius:8px;border:0;background:var(--panel);color:var(--text);font-weight:800}
.small-btn{padding:8px 10px;border-radius:8px;border:0;cursor:pointer;background:var(--accent);color:#012;font-weight:900}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:12000}
.modal{background:var(--panel);padding:16px;border-radius:12px;width:calc(100% - 40px);max-width:720px;box-shadow:0 12px 40px rgba(0,0,0,0.6)}
.share-row{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:12px}
.timer-bar{position:fixed;left:0;right:0;bottom:0;z-index:13000;background:linear-gradient(180deg, rgba(2,6,8,0.95), rgba(6,10,12,0.98));color:white;padding:8px 12px;display:flex;gap:10px;align-items:center;overflow:auto;border-top:3px solid rgba(14,165,255,0.12)}
.timer-pill{display:flex;gap:8px;align-items:center;padding:6px 10px;border-radius:10px;background:rgba(255,255,255,0.03);font-weight:800;font-size:14px;white-space:nowrap}
.timer-controls button{margin-left:6px;padding:6px 10px;border-radius:8px;border:0;background:#111;color:var(--accent);cursor:pointer;font-weight:900}
.footer{color:var(--muted);text-align:center;padding:12px 8px}
.note-area{width:100%;min-height:160px;padding:12px;border-radius:10px;border:0;background:var(--panel);color:var(--text)}
.empty{padding:18px;border-radius:12px;background:var(--glass);text-align:center;color:var(--muted)}
</style>
</head>
<body>
  <div class="app" id="app">
    <header>
      <h1>Dulce Patxi</h1>
      <div class="welcome">Bienvenidos en Dulces de Bachir Krai
By  Yahya</div>
    </header>

    <main>
      <!-- MAIN -->
      <section id="view-main" class="view active">
        <div class="search-row">
          <input id="searchInput" class="search-input" placeholder="Buscar receta..." aria-label="Buscar receta">
          <div class="search-icon">üîé</div>
        </div>

        <div class="grid" id="mainButtons">
          <button class="btn large" data-href="#modo" id="btnModo">Modo</button>
          <button class="btn large" data-href="#smart" id="btnSmart">Buscador inteligente</button>
          <button class="btn large" data-href="#menu" id="btnMenuView">menu</button>
          <button class="btn large" data-href="#stars" id="btnEstrella">recetas estrella</button>
          <button class="btn large" data-href="#notes" id="btnNotas">Notas personales</button>
        </div>
      </section>

      <!-- MENU -->
      <section id="view-menu" class="view">
        <div class="page-head">
          <button class="back" data-href="#main">Atr√°s</button>
          <div class="title">Men√∫</div>
        </div>
        <div class="list">
          <div class="card"><button class="btn" data-href="#categories" id="menu_cat">Categor√≠as</button></div>
          <div class="card"><button class="btn" data-href="#stars" id="menu_star">Recetas estrella</button></div>
          <div class="card"><button class="btn" data-href="#last" id="menu_last">√öltima receta</button></div>
        </div>
      </section>

      <!-- SMART -->
      <section id="view-smart" class="view">
        <div class="page-head">
          <button class="back" data-href="#main">Atr√°s</button>
          <div class="title">Buscador inteligente</div>
        </div>
        <div class="list">
          <div class="card">
            <div class="name">Filtrar por tiempo</div>
            <div class="muted">Franjas A (1‚Äì20), B (21‚Äì40), C (41+)</div>
            <div style="margin-top:10px"><button class="btn" id="filterTimeBtn">Seleccionar</button></div>
          </div>

          <div class="card">
            <div class="name">Filtrar por dificultad</div>
            <div class="muted">F (F√°cil), M (Medio), D (Dif√≠cil)</div>
            <div style="margin-top:10px"><button class="btn" id="filterDifficultyBtn">Seleccionar</button></div>
          </div>

          <div class="card">
            <div class="name">Filtrar por ingrediente</div>
            <div class="muted">Escribe el ingrediente</div>
            <div style="margin-top:10px"><button class="btn" id="filterIngredientBtn">Seleccionar</button></div>
          </div>
        </div>
      </section>

      <!-- LIST -->
      <section id="view-list" class="view">
        <div class="page-head">
          <button class="back" data-href="#main">Atr√°s</button>
          <div class="title" id="listTitle">Listado</div>
        </div>
        <div id="listContent" class="list"></div>
      </section>

      <!-- RECIPE -->
      <section id="view-recipe" class="view">
        <div class="page-head" style="align-items:flex-start;">
          <div style="display:flex;gap:10px;align-items:center;">
            <button class="back" data-href="#main">Atr√°s</button>
            <div class="title" id="recipeTitle">Receta</div>
          </div>

          <div style="margin-left:auto;display:flex;gap:8px;align-items:center;">
            <label class="muted" for="customTimerSelect" style="font-weight:700;">Temporizador</label>
            <select id="customTimerSelect" class="timer-select" aria-label="Temporizador minutos"></select>
            <button id="customTimerAdd" class="small-btn">A√±adir</button>
          </div>
        </div>

        <div id="recipeMeta" class="muted" style="margin-bottom:8px"></div>

        <div id="recipeContainer" class="recipe-body card">
          <div id="detectedTimersContainer"></div>

          <div id="ingredientsSection" class="section-box ingredientes"></div>
          <div id="elaboracionSection" class="section-box elaboracion"></div>

          <div style="display:flex;gap:12px;flex-wrap:wrap;margin-top:8px;">
            <button id="shareRecipeBtn" class="btn">Compartir</button>
            <button id="notesRecipeBtn" class="btn">Notas personales</button>
          </div>
        </div>
      </section>

      <!-- NOTES AGG -->
      <section id="view-notes" class="view">
        <div class="page-head">
          <button class="back" data-href="#main">Atr√°s</button>
          <div class="title">Notas y observaciones</div>
        </div>
        <div id="notesContainer" class="list"></div>
      </section>

      <!-- NOTE -->
      <section id="view-note" class="view">
        <div class="page-head">
          <button class="back" data-href="#main">Atr√°s</button>
          <div class="title" id="noteTitle">Nota</div>
        </div>
        <div class="card">
          <textarea id="noteText" class="note-area" placeholder="Escribe tus notas..."></textarea>
          <div style="display:flex;gap:10px;margin-top:12px;">
            <button id="saveNoteBtn" class="btn">Guardar</button>
            <button id="shareNoteBtn" class="btn">Compartir</button>
          </div>
        </div>
      </section>

    </main>

    <div class="footer">¬© Dulces Patxi</div>

    <div id="timerBar" class="timer-bar" style="display:none"></div>
    <div id="overlayRoot" style="display:none"></div>
  </div>





 <script>
    // === DATOS DE LAS RECETAS ===
    const recetas = [
           // === TARTAS DEL AYER ===
      {
        "id": "VARIOS 142",
        "nombre": "Tarta de Manzana",
        "categoria": "Tartas del Ayer",
        "ingredientes": [
          { "nombre": "Pasta sableaux o hojaldre", "cantidad": 1, "unidad": "masa" },
          { "nombre": "Crema pastelera", "cantidad": 250, "unidad": "gr" },
          { "nombre": "Manzanas reinetas", "cantidad": 4, "unidad": "unidades" },
          { "nombre": "Az√∫car grano", "cantidad": 50, "unidad": "gr" },
          { "nombre": "Gelatina de manzana", "cantidad": 1, "unidad": "sobre" }
        ],
        "elaboracion": [
          "Rellenar un molde con pasta sableux y cocer en blanco con alubias.",
          "Retirar las alubias y rellenar con crema pastelera.",
          "Colocar manzana pelada y fileteada de forma decorativa.",
          "Espolvorear con az√∫car y hornear a 190¬∞C durante 35 minutos.",
          "Una vez fr√≠a, abrillantar con gelatina de manzana."
        ],
        "temperatura": 190,
        "tiempo": 35
      },
      {
        "id": "VARIOS 143",
        "nombre": "Tarta San Marcos",
        "categoria": "Tartas del Ayer",
        "ingredientes": [
          { "nombre": "Bizcocho corriente", "cantidad": 1, "unidad": "plancha" },
          { "nombre": "Alm√≠bar para emborrachar", "cantidad": 200, "unidad": "ml" },
          { "nombre": "Nata montada", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Yema pastelera", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Az√∫car en grano", "cantidad": 50, "unidad": "gr" },
          { "nombre": "Gelatina de manzana", "cantidad": 1, "unidad": "sobre" }
        ],
        "elaboracion": [
          "Montar la tarta: disco de bizcocho emborrachado.",
          "Capa de yema pastelera.",
          "Disco de bizcocho emborrachado.",
          "Capa de nata montada.",
          "Disco de bizcocho emborrachado.",
          "Extender yema pastelera, rociar con az√∫car y quemar con soplete.",
          "Decorar laterales con nata y almendra granillo tostada.",
          "Abrillantar con gelatina de manzana."
        ]
      },
      {
        "id": "VARIOS 144",
        "nombre": "Tarta Tatin",
        "categoria": "Tartas del Ayer",
        "ingredientes": [
          { "nombre": "Az√∫car", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 100, "unidad": "ml" },
          { "nombre": "Manzanas reinetas", "cantidad": 1, "unidad": "kg" },
          { "nombre": "Recortes de hojaldre", "cantidad": 1, "unidad": "cantidad suficiente" }
        ],
        "elaboracion": [
          "Ba√±o de caramelo en molde: derretir az√∫car con agua.",
          "Pelar, descorazonar y cortar manzanas por la mitad.",
          "Colocarlas en el molde con parte convexa hacia abajo.",
          "Cubrir con l√°mina de hojaldre, pinchar y hornear a 180¬∞C."
        ],
        "temperatura": 180,
        "tiempo": 40
      },
      {
        "id": "VARIOS 146",
        "nombre": "Tarta de Queso",
        "categoria": "Tartas del Ayer",
        "ingredientes": [
          { "nombre": "Queso tipo Philadelphia", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Huevos", "cantidad": 4, "unidad": "unidades" },
          { "nombre": "Nata l√≠quida", "cantidad": 200, "unidad": "ml" },
          { "nombre": "Galletas trituradas", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Mantequilla", "cantidad": 100, "unidad": "gr" }
        ],
        "elaboracion": [
          "Mezclar galletas con mantequilla derretida y formar base.",
          "Batir queso con az√∫car, a√±adir huevos uno a uno.",
          "Incorporar nata y verter sobre la base.",
          "Hornear a ba√±o Mar√≠a a 160¬∞C durante 50 minutos.",
          "Enfriar y refrigerar toda la noche."
        ],
        "temperatura": 160,
        "tiempo": 50
      },
      {
        "id": "VARIOS 147",
        "nombre": "Tarta de Yema Quemada",
        "categoria": "Tartas del Ayer",
        "ingredientes": [
          { "nombre": "Pasta sableaux", "cantidad": 1, "unidad": "masa" },
          { "nombre": "Yemas de huevo", "cantidad": 20, "unidad": "unidades" },
          { "nombre": "Az√∫car", "cantidad": 600, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 250, "unidad": "ml" }
        ],
        "elaboracion": [
          "Preparar alm√≠bar con az√∫car y agua hasta punto de hebra fina.",
          "Incorporar yemas poco a poco sin dejar de remover.",
          "Verter sobre la masa sableaux previamente cocida.",
          "Cocer al horno suave hasta dorar ligeramente."
        ],
        "temperatura": 170,
        "tiempo": 25
      },
      {
        "id": "VARIOS 150",
        "nombre": "Tarta Sagarroz",
        "categoria": "Tartas del Ayer",
        "ingredientes": [
          { "nombre": "Bizcocho corriente", "cantidad": 1, "unidad": "plancha" },
          { "nombre": "Alm√≠bar aromatizado con sidra", "cantidad": 200, "unidad": "ml" },
          { "nombre": "Nata montada", "cantidad": 400, "unidad": "gr" },
          { "nombre": "Compota de manzana", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Sidra", "cantidad": 100, "unidad": "ml" },
          { "nombre": "Gelatina de manzana", "cantidad": 1, "unidad": "sobre" }
        ],
        "elaboracion": [
          "Emborrar el bizcocho con alm√≠bar de sidra.",
          "Rellenar con capas alternas de nata y compota.",
          "Cubrir con nata y abrillantar con gelatina."
        ]
      },
      {
        "id": "VARIOS 161",
        "nombre": "Tarta de Almendra",
        "categoria": "Tartas del Ayer",
        "ingredientes": [
          { "nombre": "Pasta quebrada", "cantidad": 1, "unidad": "masa" },
          { "nombre": "Az√∫car", "cantidad": 250, "unidad": "gr" },
          { "nombre": "Almendra molida", "cantidad": 250, "unidad": "gr" },
          { "nombre": "Ralladura de lim√≥n", "cantidad": 1, "unidad": "unidad" },
          { "nombre": "Huevos", "cantidad": 3, "unidad": "unidades" },
          { "nombre": "Mantequilla", "cantidad": 250, "unidad": "gr" }
        ],
        "elaboracion": [
          "Forrar molde con pasta quebrada.",
          "Mezclar almendra, az√∫car, ralladura, huevos y mantequilla.",
          "Verter sobre la base y hornear a 180¬∞C durante 45 minutos."
        ],
        "temperatura": 180,
        "tiempo": 45
      },
      {
        "id": "VARIOS 158",
        "nombre": "Tarta de Frutas",
        "categoria": "Tartas del Ayer",
        "ingredientes": [
          { "nombre": "Dos discos de bizcocho", "cantidad": 2, "unidad": "unidades" },
          { "nombre": "Alm√≠bar de emborrachar", "cantidad": 200, "unidad": "ml" },
          { "nombre": "Nata montada", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Yema de naranja", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Frutas variadas", "cantidad": 500, "unidad": "gr" }
        ],
        "elaboracion": [
          "Colocar un disco de bizcocho en molde de aro.",
          "Emborrarlo m√≠nimamente.",
          "Rellenar abundantemente de nata.",
          "Colocar encima el otro disco de bizcocho y emborracharlo.",
          "Extender yema de naranja, rociar con az√∫car y quemar.",
          "Abrillantar con gelatina de manzana.",
          "Colocar frutas decorativamente y abrillantar."
        ]
      },
      // === TARTAS PREMIUM ===
      {
        "id": "VARIOS 148",
        "nombre": "Tronco Navide√±o",
        "categoria": "Tartas Premium",
        "ingredientes": [
          { "nombre": "Bizcocho plancha", "cantidad": 1, "unidad": "unidad" },
          { "nombre": "Trufa", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Alm√≠bar", "cantidad": 150, "unidad": "ml" },
          { "nombre": "Cobertura", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Mantequilla", "cantidad": 50, "unidad": "gr" },
          { "nombre": "Hojas de chocolate", "cantidad": 1, "unidad": "cantidad" },
          { "nombre": "Az√∫car glass", "cantidad": 30, "unidad": "gr" },
          { "nombre": "Canela en polvo", "cantidad": 5, "unidad": "gr" }
        ],
        "elaboracion": [
          "Empapar el bizcocho con alm√≠bar.",
          "Untar con trufa y enrollar con ayuda de papel sulfurizado.",
          "Abrillantar con cobertura mezclada con mantequilla.",
          "Crear textura de corteza con tenedor.",
          "Decorar con hojas de chocolate y canela."
        ]
      },
      {
        "id": "VARIOS 149",
        "nombre": "Tarta Selva Negra",
        "categoria": "Tartas Premium",
        "ingredientes": [
          { "nombre": "Bizcocho de chocolate", "cantidad": 1, "unidad": "plancha" },
          { "nombre": "Cherovia", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Kirsch", "cantidad": 200, "unidad": "ml" },
          { "nombre": "Nata montada", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Cacao en polvo", "cantidad": 50, "unidad": "gr" },
          { "nombre": "Cerezas en alm√≠bar", "cantidad": 1, "unidad": "lata" }
        ],
        "elaboracion": [
          "Cortar el bizcocho en tres discos.",
          "Emborrar cada disco con Kirsch.",
          "Alternar capas de cherovia, nata y cerezas.",
          "Cubrir exterior con nata y espolvorear cacao.",
          "Decorar con cerezas y virutas de chocolate."
        ]
      },
      {
        "id": "VARIOS 151",
        "nombre": "Tarta Mart√≠nica",
        "categoria": "Tartas Premium",
        "ingredientes": [
          { "nombre": "Pasta sableaux", "cantidad": 1, "unidad": "masa" },
          { "nombre": "Crema pastelera", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Pi√±a natural", "cantidad": 1, "unidad": "unidad" },
          { "nombre": "Ron", "cantidad": 50, "unidad": "ml" },
          { "nombre": "Nata montada", "cantidad": 200, "unidad": "gr" }
        ],
        "elaboracion": [
          "Forrar molde con pasta sableaux y cocer en blanco.",
          "Rellenar con crema pastelera y pi√±a macerada en ron.",
          "Cubrir con nata y decorar con trozos de pi√±a."
        ]
      },
      {
        "id": "VARIOS 152",
        "nombre": "Tarta de Moka",
        "categoria": "Tartas Premium",
        "ingredientes": [
          { "nombre": "Bizcocho genov√©s", "cantidad": 1, "unidad": "plancha" },
          { "nombre": "Caf√© expreso", "cantidad": 200, "unidad": "ml" },
          { "nombre": "Mascarpone", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Az√∫car glass", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Chocolate negro", "cantidad": 100, "unidad": "gr" }
        ],
        "elaboracion": [
          "Emborrar el bizcocho con caf√©.",
          "Mezclar mascarpone con az√∫car y cubrir el bizcocho.",
          "Rallar chocolate y espolvorear por encima."
        ]
      },
      {
        "id": "VARIOS 153",
        "nombre": "Tarta √ìpera",
        "categoria": "Tartas Premium",
        "ingredientes": [
          { "nombre": "Bizcocho joconde", "cantidad": 3, "unidad": "discos" },
          { "nombre": "Caf√© concentrado", "cantidad": 150, "unidad": "ml" },
          { "nombre": "Crema de moka", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Cobertura de chocolate", "cantidad": 200, "unidad": "gr" }
        ],
        "elaboracion": [
          "Alternar capas de bizcocho empapado en caf√© y crema de moka.",
          "Cubrir con cobertura de chocolate brillante."
        ]
      },
      {
        "id": "VARIOS 154",
        "nombre": "Tarta Ponche Genov√©s",
        "categoria": "Tartas Premium",
        "ingredientes": [
          { "nombre": "Bizcocho genov√©s", "cantidad": 1, "unidad": "plancha" },
          { "nombre": "Alm√≠bar de vino de M√°laga", "cantidad": 200, "unidad": "ml" },
          { "nombre": "Crema pastelera", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Nata montada", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Chantilly", "cantidad": 200, "unidad": "gr" }
        ],
        "elaboracion": [
          "Cortar el bizcocho en dos capas.",
          "Emborrar con alm√≠bar de vino de M√°laga.",
          "Rellenar con crema pastelera y nata.",
          "Cubrir con chantilly y decorar con guindas."
        ]
      },
      {
        "id": "VARIOS 155",
        "nombre": "Tarta Mascota",
        "categoria": "Tartas Premium",
        "ingredientes": [
          { "nombre": "Bizcocho molde", "cantidad": 1, "unidad": "unidad" },
          { "nombre": "Alm√≠bar de emborrachar", "cantidad": 200, "unidad": "ml" },
          { "nombre": "Crema de mantequilla", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Almendra fileteada", "cantidad": 100, "unidad": "gr" }
        ],
        "elaboracion": [
          "Partimos de un bizcocho relleno de crema de mantequilla.",
          "Cubrimos la superficie y los laterales con crema de mantequilla.",
          "Aplanamos con esp√°tula.",
          "Decoramos con almendra fileteada."
        ]
      },
      {
        "id": "VARIOS 156",
        "nombre": "Terrina de Frutas",
        "categoria": "Tartas Premium",
        "ingredientes": [
          { "nombre": "Plancha de bizcocho", "cantidad": 1, "unidad": "unidad" },
          { "nombre": "Mantequilla", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Az√∫car lustre", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Almendra molida", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Nata l√≠quida", "cantidad": 300, "unidad": "ml" },
          { "nombre": "Kiwi", "cantidad": 3, "unidad": "unidades" },
          { "nombre": "Fresas", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Melocot√≥n en alm√≠bar", "cantidad": 200, "unidad": "gr" }
        ],
        "elaboracion": [
          "Forrar molde con film transparente.",
          "Colocar capa de bizcocho.",
          "Rellenar con mezcla de mantequilla, az√∫car, almendra y nata.",
          "A√±adir frutas cortadas.",
          "Congelar y desmoldar."
        ]
      },
      {
        "id": "VARIOS 157",
        "nombre": "Tarta de Enrejado",
        "categoria": "Tartas Premium",
        "ingredientes": [
          { "nombre": "Recortes de hojaldre", "cantidad": 1, "unidad": "masa" },
          { "nombre": "Crema pastelera", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Frambuesas", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Gelatina de manzana", "cantidad": 1, "unidad": "sobre" }
        ],
        "elaboracion": [
          "Forrar molde con hojaldre.",
          "Rellenar con crema pastelera.",
          "Colocar frambuesas.",
          "Hacer rejilla con tiras de hojaldre.",
          "Hornear a 180¬∞C.",
          "Abrillantar con gelatina."
        ],
        "temperatura": 180,
        "tiempo": 35
      },
      {
        "id": "VARIOS 159",
        "nombre": "Tarta de Chocolatina",
        "categoria": "Tartas Premium",
        "ingredientes": [
          { "nombre": "Bizcocho genov√©s", "cantidad": 1, "unidad": "plancha" },
          { "nombre": "Alm√≠bar de caf√©", "cantidad": 200, "unidad": "ml" },
          { "nombre": "Trufa negra", "cantidad": 400, "unidad": "gr" },
          { "nombre": "Virutas de chocolate", "cantidad": 100, "unidad": "gr" }
        ],
        "elaboracion": [
          "Cortar bizcocho en dos capas.",
          "Emborrar con alm√≠bar de caf√©.",
          "Rellenar con trufa negra.",
          "Cubrir con trufa y decorar con virutas."
        ]
      },
      // === BIZCOCHOS, MAGDALENAS & MUFFINS ===
      {
        "id": "VARIOS 67",
        "nombre": "Sobao Pasiego",
        "categoria": "Bizcochos, Magdalenas & Muffins",
        "ingredientes": [
          { "nombre": "Mantequilla", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Az√∫car glas√©", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Huevos", "cantidad": 15, "unidad": "unidades" },
          { "nombre": "Ron", "cantidad": 50, "unidad": "ml" },
          { "nombre": "Harina floja", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Impulsor", "cantidad": 10, "unidad": "gr" }
        ],
        "elaboracion": [
          "Batir mantequilla con az√∫car, a√±adir huevos uno a uno.",
          "Incorporar harina con impulsor, ron y mezclar delicadamente.",
          "Hornear a 180¬∞C."
        ],
        "temperatura": 180,
        "tiempo": 30
      },
      {
        "id": "VARIOS 202",
        "nombre": "San Blas",
        "categoria": "Bizcochos, Magdalenas & Muffins",
        "ingredientes": [
          { "nombre": "Harina", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 250, "unidad": "gr" },
          { "nombre": "Huevos", "cantidad": 5, "unidad": "unidades" },
          { "nombre": "Mantequilla", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Leche", "cantidad": 100, "unidad": "ml" },
          { "nombre": "Impulsor", "cantidad": 10, "unidad": "gr" }
        ],
        "elaboracion": [
          "Batir mantequilla con az√∫car, a√±adir huevos uno a uno.",
          "Incorporar harina con impulsor y leche.",
          "Hornear a 180¬∞C durante 25 minutos."
        ],
        "temperatura": 180,
        "tiempo": 25
      },
      {
        "id": "VARIOS 58",
        "nombre": "Bizcocho de Chocolate",
        "categoria": "Bizcochos, Magdalenas & Muffins",
        "ingredientes": [
          { "nombre": "Huevos", "cantidad": 4, "unidad": "unidades" },
          { "nombre": "Az√∫car", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Harina", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Cacao en polvo", "cantidad": 50, "unidad": "gr" },
          { "nombre": "Mantequilla", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Leche", "cantidad": 100, "unidad": "ml" },
          { "nombre": "Impulsor", "cantidad": 10, "unidad": "gr" }
        ],
        "elaboracion": [
          "Batir huevos con az√∫car hasta doblar volumen.",
          "A√±adir harina, cacao, mantequilla derretida, leche e impulsor.",
          "Hornear a 180¬∞C durante 30 minutos."
        ],
        "temperatura": 180,
        "tiempo": 30
      },
      {
        "id": "VARIOS 59",
        "nombre": "Bizcocho de Naranja",
        "categoria": "Bizcochos, Magdalenas & Muffins",
        "ingredientes": [
          { "nombre": "Huevos", "cantidad": 4, "unidad": "unidades" },
          { "nombre": "Az√∫car", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Harina", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Zumo de naranja", "cantidad": 100, "unidad": "ml" },
          { "nombre": "Ralladura de naranja", "cantidad": 1, "unidad": "unidad" },
          { "nombre": "Mantequilla", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Impulsor", "cantidad": 10, "unidad": "gr" }
        ],
        "elaboracion": [
          "Batir huevos con az√∫car hasta doblar volumen.",
          "A√±adir harina, zumo, ralladura, mantequilla derretida e impulsor.",
          "Hornear a 180¬∞C durante 30 minutos."
        ],
        "temperatura": 180,
        "tiempo": 30
      },
      {
        "id": "VARIOS 68",
        "nombre": "Magdalenas",
        "categoria": "Bizcochos, Magdalenas & Muffins",
        "ingredientes": [
          { "nombre": "Huevos", "cantidad": 10, "unidad": "unidades" },
          { "nombre": "Az√∫car", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Harina", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Mantequilla", "cantidad": 250, "unidad": "gr" },
          { "nombre": "Leche", "cantidad": 100, "unidad": "ml" },
          { "nombre": "Impulsor", "cantidad": 10, "unidad": "gr" }
        ],
        "elaboracion": [
          "Batir huevos con az√∫car hasta doblar volumen.",
          "Incorporar harina, mantequilla derretida, leche e impulsor.",
          "Escudillar en moldes y hornear a 180¬∞C durante 20 minutos."
        ],
        "temperatura": 180,
        "tiempo": 20
      },
      {
        "id": "VARIOS 61",
        "nombre": "Bizcocho de Manzana",
        "categoria": "Bizcochos, Magdalenas & Muffins",
        "ingredientes": [
          { "nombre": "Huevos", "cantidad": 4, "unidad": "unidades" },
          { "nombre": "Az√∫car", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Harina", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Manzanas", "cantidad": 2, "unidad": "unidades" },
          { "nombre": "Mantequilla", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Impulsor", "cantidad": 10, "unidad": "gr" }
        ],
        "elaboracion": [
          "Batir huevos con az√∫car hasta doblar volumen.",
          "A√±adir harina, manzana rallada, mantequilla derretida e impulsor.",
          "Hornear a 180¬∞C durante 30 minutos."
        ],
        "temperatura": 180,
        "tiempo": 30
      },
      {
        "id": "VARIOS 60",
        "nombre": "Bizcocho de Coco",
        "categoria": "Bizcochos, Magdalenas & Muffins",
        "ingredientes": [
          { "nombre": "Huevos", "cantidad": 4, "unidad": "unidades" },
          { "nombre": "Az√∫car", "cantidad": 400, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 200, "unidad": "cc" },
          { "nombre": "Harina", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Levadura royal", "cantidad": 1, "unidad": "sobre" },
          { "nombre": "Coco rallado", "cantidad": 50, "unidad": "gr" }
        ],
        "elaboracion": [
          "Batir huevos con az√∫car, agregar agua hirviendo, harina, levadura y coco.",
          "Verter en molde engrasado y enharinado.",
          "Hornear a fuego lento los primeros 10 minutos, luego aumentar temperatura."
        ],
        "tiempo": 50
      },
      {
        "id": "VARIOS 195",
        "nombre": "Coquitos",
        "categoria": "Bizcochos, Magdalenas & Muffins",
        "ingredientes": [
          { "nombre": "Huevos", "cantidad": 3, "unidad": "unidades" },
          { "nombre": "Az√∫car", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Coco rallado", "cantidad": 250, "unidad": "gr" }
        ],
        "elaboracion": [
          "Mezclar ingredientes y dejar reposar en frigor√≠fico.",
          "Formar bolas peque√±as y hornear a horno fuerte 20 minutos."
        ],
        "temperatura": 190,
        "tiempo": 20
      },
      {
        "id": "VARIOS 196",
        "nombre": "Macarr√≥n de Almendra",
        "categoria": "Bizcochos, Magdalenas & Muffins",
        "ingredientes": [
          { "nombre": "Almendra molida", "cantidad": 480, "unidad": "gr" },
          { "nombre": "Az√∫car grano", "cantidad": 400, "unidad": "gr" },
          { "nombre": "Claritas", "cantidad": 180, "unidad": "gr" }
        ],
        "elaboracion": [
          "Mezclar todos los ingredientes hasta formar una masa homog√©nea.",
          "Escudillar con manga sobre placa.",
          "Secar a 40-50¬∞C durante varias horas.",
          "Cocer a 140¬∞C cuando est√©n secos."
        ],
        "temperatura": 140,
        "tiempo": 15
      },
      {
        "id": "VARIOS 199",
        "nombre": "Empi√±onadas",
        "categoria": "Bizcochos, Magdalenas & Muffins",
        "ingredientes": [
          { "nombre": "Almendra molida", "cantidad": 250, "unidad": "gr" },
          { "nombre": "Az√∫car lustre", "cantidad": 225, "unidad": "gr" },
          { "nombre": "Claras de huevo", "cantidad": 1, "unidad": "cantidad" },
          { "nombre": "Pi√±ones", "cantidad": 100, "unidad": "gr" }
        ],
        "elaboracion": [
          "Mezclar almendra, az√∫car y claras.",
          "Formar bolas, rebozar con pi√±ones.",
          "Cocer a horno a 180-200¬∞C."
        ],
        "temperatura": 190,
        "tiempo": 18
      },
      // === DULCES & CONFITES ===
      {
        "id": "VARIOS 173",
        "nombre": "Trufa Negra",
        "categoria": "Dulces & Confites",
        "ingredientes": [
          { "nombre": "Nata", "cantidad": 350, "unidad": "gr" },
          { "nombre": "Cobertura negra", "cantidad": 650, "unidad": "gr" },
          { "nombre": "Cognac", "cantidad": 2, "unidad": "cda" }
        ],
        "elaboracion": [
          "Calentar la nata y verter sobre la cobertura.",
          "Disolver con esp√°tula, a√±adir cognac.",
          "Dejar enfriar, hacer bolas y ba√±ar en cobertura o cacao."
        ]
      },
      {
        "id": "VARIOS 48",
        "nombre": "Trufa Cocida",
        "categoria": "Dulces & Confites",
        "ingredientes": [
          { "nombre": "Nata l√≠quida", "cantidad": 1000, "unidad": "ml" },
          { "nombre": "Cobertura negra", "cantidad": 140, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 150, "unidad": "gr" }
        ],
        "elaboracion": [
          "Mezclar todos los ingredientes y llevar al fuego hasta disolver la cobertura.",
          "Enfriar en c√°mara toda la noche.",
          "Al d√≠a siguiente, montar con varilla hasta obtener textura cremosa.",
          "Formar bolas y rodar en cacao en polvo."
        ]
      },
      {
        "id": "VARIOS 49",
        "nombre": "Trufa Cocida Blanca",
        "categoria": "Dulces & Confites",
        "ingredientes": [
          { "nombre": "Nata l√≠quida", "cantidad": 1000, "unidad": "ml" },
          { "nombre": "Cobertura blanca", "cantidad": 400, "unidad": "gr" }
        ],
        "elaboracion": [
          "Cocer de v√≠spera la nata con la cobertura.",
          "Enfriar en c√°mara y al d√≠a siguiente proceder a montarla."
        ]
      },
      {
        "id": "VARIOS 50",
        "nombre": "Toffe",
        "categoria": "Dulces & Confites",
        "ingredientes": [
          { "nombre": "Nata l√≠quida", "cantidad": 1000, "unidad": "ml" },
          { "nombre": "Az√∫car", "cantidad": 250, "unidad": "gr" }
        ],
        "elaboracion": [
          "Hacer caramelo rubio con az√∫car.",
          "A√±adir nata caliente con cuidado.",
          "Hervir hasta disoluci√≥n completa.",
          "Usar como salsa o montar al d√≠a siguiente."
        ]
      },
      {
        "id": "VARIOS 178",
        "nombre": "Mazap√°n",
        "categoria": "Dulces & Confites",
        "ingredientes": [
          { "nombre": "Almendra molida", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 200, "unidad": "ml" },
          { "nombre": "Glucosa", "cantidad": 100, "unidad": "gr" }
        ],
        "elaboracion": [
          "Mezclar todos los ingredientes hasta formar una masa homog√©nea.",
          "Amasar y moldear como se desee.",
          "Secar al aire o en horno muy bajo."
        ]
      },
      {
        "id": "VARIOS 180",
        "nombre": "Turr√≥n de Yema",
        "categoria": "Dulces & Confites",
        "ingredientes": [
          { "nombre": "Nata", "cantidad": 125, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 125, "unidad": "gr" },
          { "nombre": "Yemas", "cantidad": 9, "unidad": "unidades" },
          { "nombre": "Alm√≠bar", "cantidad": 1, "unidad": "kilo" },
          { "nombre": "Almendra molida", "cantidad": 1, "unidad": "kilo" },
          { "nombre": "Glucosa", "cantidad": 50, "unidad": "gr" },
          { "nombre": "Vainillina", "cantidad": 1, "unidad": "cda" }
        ],
        "elaboracion": [
          "Elaborar alm√≠bar a punto de bola floja.",
          "Mezclar con yemas, nata, almendra y glucosa.",
          "Moldear y enfriar."
        ]
      },
      {
        "id": "VARIOS 182",
        "nombre": "Turr√≥n de Coco",
        "categoria": "Dulces & Confites",
        "ingredientes": [
          { "nombre": "Alm√≠bar", "cantidad": 1, "unidad": "kilo" },
          { "nombre": "Agua", "cantidad": 350, "unidad": "gr" },
          { "nombre": "Coco rallado", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Almendra molida", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Glucosa", "cantidad": 125, "unidad": "gr" }
        ],
        "elaboracion": [
          "Hacer alm√≠bar con az√∫car, agua y glucosa.",
          "A√±adir coco y almendra.",
          "Verter en molde, enfriar y cortar."
        ]
      },
      {
        "id": "VARIOS 183",
        "nombre": "Turr√≥n de Pistachos",
        "categoria": "Dulces & Confites",
        "ingredientes": [
          { "nombre": "Alm√≠bar", "cantidad": 1, "unidad": "kilo" },
          { "nombre": "Agua", "cantidad": 330, "unidad": "gr" },
          { "nombre": "Pistachos molidos", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Almendra molida", "cantidad": 500, "unidad": "gr" }
        ],
        "elaboracion": [
          "Hacer alm√≠bar a punto de hebra floja.",
          "Mezclar con pistachos y almendra.",
          "Moldear, prensar y reposar."
        ]
      },
      {
        "id": "VARIOS 184",
        "nombre": "Guirlache",
        "categoria": "Dulces & Confites",
        "ingredientes": [
          { "nombre": "Az√∫car", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Manteca de cerdo", "cantidad": 10, "unidad": "gr" },
          { "nombre": "Canela", "cantidad": 5, "unidad": "gr" },
          { "nombre": "Zumo de lim√≥n", "cantidad": 1, "unidad": "chorro" },
          { "nombre": "Almendras marcona", "cantidad": 450, "unidad": "gr" }
        ],
        "elaboracion": [
          "Hacer caramelo rubio con az√∫car, manteca, canela y lim√≥n.",
          "A√±adir almendras tostadas.",
          "Extender sobre m√°rmol engrasado.",
          "Cortar en barritas antes de enfriar."
        ]
      },
      {
        "id": "VARIOS 181",
        "nombre": "Turr√≥n de Nata Nuez",
        "categoria": "Dulces & Confites",
        "ingredientes": [
          { "nombre": "Nata", "cantidad": 400, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 1125, "unidad": "gr" },
          { "nombre": "Almendra molida", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Nueces", "cantidad": 750, "unidad": "gr" },
          { "nombre": "Vainillina", "cantidad": 1, "unidad": "cda" }
        ],
        "elaboracion": [
          "Hervir nata con az√∫car, a√±adir almendra, nueces y vainillina.",
          "Moldear, prensar y dejar reposar m√≠nimo un d√≠a."
        ]
      },
      // === MASAS & PASTELES ===
      {
        "id": "VARIOS 75",
        "nombre": "Hojaldre (F√≥rmula Tradicional)",
        "categoria": "Masas & Pasteles",
        "ingredientes": [
          { "nombre": "Harina fuerte", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 600, "unidad": "gr" },
          { "nombre": "Sal", "cantidad": 20, "unidad": "gr" },
          { "nombre": "Manteca de cerdo o mantequilla", "cantidad": 600, "unidad": "gr" }
        ],
        "elaboracion": [
          "Mezclar harina, agua y sal. Formar un plast√≥n.",
          "Enfriar 30 minutos.",
          "Estirar y colocar la grasa en el centro. Doblar como libro.",
          "Repetir 3-4 vueltas simples, refrigerando entre cada una."
        ]
      },
      {
        "id": "VARIOS 83",
        "nombre": "Palmeras",
        "categoria": "Masas & Pasteles",
        "ingredientes": [
          { "nombre": "Plast√≥n de hojaldre", "cantidad": 1, "unidad": "masa" },
          { "nombre": "Az√∫car en grano", "cantidad": 200, "unidad": "gr" }
        ],
        "elaboracion": [
          "Hacer una masa de hojaldre a la que se dan 6 pliegues sencillos.",
          "En el √∫ltimo pliegue espolvorear con az√∫car en grano y estirar.",
          "Se monta la masa tres veces por cada lado, juntar y cortar en palmeras.",
          "Hornear a 200-210¬∞C hasta dorar."
        ],
        "temperatura": 205,
        "tiempo": 22
      },
      {
        "id": "VARIOS 187",
        "nombre": "Cigarrillos Rusos",
        "categoria": "Masas & Pasteles",
        "ingredientes": [
          { "nombre": "Hojaldre", "cantidad": 1, "unidad": "masa" },
          { "nombre": "Az√∫car glass", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Clara de huevo", "cantidad": 1, "unidad": "unidad" }
        ],
        "elaboracion": [
          "Estirar el hojaldre muy fino y pintar con clara de huevo.",
          "Espolvorear con az√∫car glass.",
          "Enrollar como si fuera un brazo de gitano y cortar en rodajas finas.",
          "Hornear a 200¬∞C hasta dorar."
        ],
        "temperatura": 200,
        "tiempo": 15
      },
      {
        "id": "VARIOS 190",
        "nombre": "Lenguas de Gato",
        "categoria": "Masas & Pasteles",
        "ingredientes": [
          { "nombre": "Mantequilla", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Az√∫car glass", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Harina", "cantidad": 200, "unidad": "gr" }
        ],
        "elaboracion": [
          "Batir mantequilla con az√∫car glass.",
          "Incorporar harina con esp√°tula.",
          "Escudillar en boquilla rizada.",
          "Hornear a 180¬∞C sin abrir el horno."
        ],
        "temperatura": 180,
        "tiempo": 12
      },
      // === POSTRES FR√çOS ===
      {
        "id": "VARIOS 13",
        "nombre": "Flan de Chocolate",
        "categoria": "Postres Fr√≠os",
        "ingredientes": [
          { "nombre": "Leche", "cantidad": 250, "unidad": "ml" },
          { "nombre": "Nata l√≠quida", "cantidad": 250, "unidad": "ml" },
          { "nombre": "Az√∫car", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Cobertura negra", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Huevos", "cantidad": 6, "unidad": "unidades" },
          { "nombre": "Salsa de caramelo", "cantidad": 1, "unidad": "cantidad" }
        ],
        "elaboracion": [
          "Mezclar leche, nata, az√∫car y cobertura fundida.",
          "A√±adir huevos batidos.",
          "Verter en moldes con caramelo.",
          "Cocer al ba√±o Mar√≠a a 160¬∞C durante 45 minutos.",
          "Enfriar y desmoldar."
        ],
        "temperatura": 160,
        "tiempo": 45
      },
      {
        "id": "VARIOS 25",
        "nombre": "Compota de Manzana",
        "categoria": "Postres Fr√≠os",
        "ingredientes": [
          { "nombre": "Manzanas", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Vino blanco", "cantidad": 250, "unidad": "ml" },
          { "nombre": "Orejones", "cantidad": 50, "unidad": "gr" },
          { "nombre": "Pasas", "cantidad": 30, "unidad": "gr" }
        ],
        "elaboracion": [
          "Pelar y cortar manzanas.",
          "Cocer con az√∫car, vino y frutas secas.",
          "Dejar enfriar antes de servir."
        ]
      },
      {
        "id": "VARIOS 26",
        "nombre": "Peras en Alm√≠bar",
        "categoria": "Postres Fr√≠os",
        "ingredientes": [
          { "nombre": "Peras", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Vino blanco", "cantidad": 500, "unidad": "ml" },
          { "nombre": "Az√∫car", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 500, "unidad": "ml" },
          { "nombre": "Canela en rama", "cantidad": 1, "unidad": "unidad" },
          { "nombre": "C√°scara de lim√≥n", "cantidad": 1, "unidad": "unidad" }
        ],
        "elaboracion": [
          "Pelar peras y mantener en agua con lim√≥n.",
          "Hervir agua, vino, az√∫car, canela y lim√≥n.",
          "A√±adir peras y cocer a fuego lento 20-30 min.",
          "Dejar enfriar en el alm√≠bar."
        ],
        "tiempo": 25
      },
      {
        "id": "VARIOS 27",
        "nombre": "Arroz con Leche",
        "categoria": "Postres Fr√≠os",
        "ingredientes": [
          { "nombre": "Arroz", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Leche", "cantidad": 1000, "unidad": "ml" },
          { "nombre": "Az√∫car", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Canela en rama", "cantidad": 1, "unidad": "unidad" },
          { "nombre": "C√°scara de lim√≥n", "cantidad": 1, "unidad": "unidad" },
          { "nombre": "Vainilla", "cantidad": 1, "unidad": "unidad" }
        ],
        "elaboracion": [
          "Cocer el arroz en leche con az√∫car, canela, lim√≥n y vainilla.",
          "Dejar enfriar y servir fr√≠o con canela por encima."
        ]
      },
      {
        "id": "VARIOS 28",
        "nombre": "Leche Frita",
        "categoria": "Postres Fr√≠os",
        "ingredientes": [
          { "nombre": "Leche", "cantidad": 1000, "unidad": "ml" },
          { "nombre": "Harina", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Canela", "cantidad": 10, "unidad": "gr" },
          { "nombre": "Aceite para fre√≠r", "cantidad": 500, "unidad": "ml" }
        ],
        "elaboracion": [
          "Cocer leche con az√∫car, canela y harina hasta espesar.",
          "Enfriar, cortar en dados y fre√≠r.",
          "Espolvorear con az√∫car y canela."
        ]
      },
      {
        "id": "VARIOS 29",
        "nombre": "Torrijas",
        "categoria": "Postres Fr√≠os",
        "ingredientes": [
          { "nombre": "Pan de brioche", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Leche", "cantidad": 500, "unidad": "ml" },
          { "nombre": "Huevos", "cantidad": 3, "unidad": "unidades" },
          { "nombre": "Az√∫car", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Canela", "cantidad": 10, "unidad": "gr" },
          { "nombre": "Aceite", "cantidad": 300, "unidad": "ml" }
        ],
        "elaboracion": [
          "Remojar pan en leche con canela y az√∫car.",
          "Pasar por huevo y fre√≠r.",
          "Espolvorear con az√∫car y canela."
        ]
      },
      {
        "id": "VARIOS 30",
        "nombre": "Goxua",
        "categoria": "Postres Fr√≠os",
        "ingredientes": [
          { "nombre": "Bizcocho corriente", "cantidad": 1, "unidad": "plancha" },
          { "nombre": "Crema pastelera", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Nata montada", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Caramelo", "cantidad": 100, "unidad": "gr" }
        ],
        "elaboracion": [
          "Cortar el bizcocho en cuadrados.",
          "Rellenar con crema y nata.",
          "Ba√±o de caramelo por encima."
        ]
      },
      {
        "id": "VARIOS 31",
        "nombre": "Pastel Vasco",
        "categoria": "Postres Fr√≠os",
        "ingredientes": [
          { "nombre": "Harina", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Mantequilla", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Huevos", "cantidad": 4, "unidad": "unidades" },
          { "nombre": "Crema pastelera", "cantidad": 400, "unidad": "gr" }
        ],
        "elaboracion": [
          "Mezclar harina, az√∫car, mantequilla y huevos hasta formar masa.",
          "Forrar molde y rellenar con crema pastelera.",
          "Hornear a 180¬∞C durante 40 minutos."
        ],
        "temperatura": 180,
        "tiempo": 40
      },
      // === HELADOS & SORBETES ===
      {
        "id": "VARIOS 100",
        "nombre": "Sorbete de Lim√≥n al Champ√°n",
        "categoria": "Helados & Sorbetes",
        "ingredientes": [
          { "nombre": "Alm√≠bar a 28¬∞Brix", "cantidad": 1, "unidad": "litro" },
          { "nombre": "Zumo de lim√≥n", "cantidad": 1, "unidad": "litro" }
        ],
        "elaboracion": [
          "Mezclar ambos ingredientes y enfriar bien.",
          "Introducir en heladora y dejar congelar."
        ]
      },
      {
        "id": "VARIOS 105",
        "nombre": "Sorbete de Lim√≥n",
        "categoria": "Helados & Sorbetes",
        "ingredientes": [
          { "nombre": "Zumo de lim√≥n", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Glucosa", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Maicena", "cantidad": 20, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 480, "unidad": "gr" }
        ],
        "elaboracion": [
          "Mezclar sacarosa con maicena, a√±adir agua y cocer.",
          "Enfriar, a√±adir zumo y helar."
        ]
      },
      {
        "id": "VARIOS 118",
        "nombre": "Mousse de Cava",
        "categoria": "Helados & Sorbetes",
        "ingredientes": [
          { "nombre": "Cava", "cantidad": 750, "unidad": "ml" },
          { "nombre": "Az√∫car", "cantidad": 360, "unidad": "gr" },
          { "nombre": "Gelatina", "cantidad": 24, "unidad": "gr" },
          { "nombre": "Yemas", "cantidad": 3, "unidad": "unidades" },
          { "nombre": "Nata l√≠quida", "cantidad": 400, "unidad": "ml" }
        ],
        "elaboracion": [
          "Calentar cava con az√∫car y gelatina.",
          "A√±adir yemas, enfriar y mezclar con nata montada.",
          "Congelar."
        ]
      },
      {
        "id": "VARIOS 97",
        "nombre": "Sorbete de Naranja",
        "categoria": "Helados & Sorbetes",
        "ingredientes": [
          { "nombre": "Agua", "cantidad": 250, "unidad": "ml" },
          { "nombre": "Az√∫car", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Ralladura de naranja", "cantidad": 1, "unidad": "cantidad" },
          { "nombre": "Zumo de naranja", "cantidad": 500, "unidad": "ml" },
          { "nombre": "Clara de huevo", "cantidad": 1, "unidad": "unidad" }
        ],
        "elaboracion": [
          "Hacer alm√≠bar con agua y az√∫car.",
          "A√±adir ralladura, zumo y clara batida.",
          "Congelar en heladora."
        ]
      },
      {
        "id": "VARIOS 106",
        "nombre": "Bavarois de Chocolate",
        "categoria": "Helados & Sorbetes",
        "ingredientes": [
          { "nombre": "Chocolate negro", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Leche", "cantidad": 500, "unidad": "ml" },
          { "nombre": "Az√∫car", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Huevos", "cantidad": 4, "unidad": "unidades" },
          { "nombre": "Gelatina", "cantidad": 10, "unidad": "gr" }
        ],
        "elaboracion": [
          "Derretir chocolate con leche y az√∫car.",
          "A√±adir yemas, gelatina reblandecida.",
          "Montar claras y nata, incorporar.",
          "Enmoldar y refrigerar."
        ]
      },
      // === RELLENOS & COBERTURAS ===
      {
        "id": "VARIOS 221",
        "nombre": "Coulis de Frutos Rojos",
        "categoria": "Rellenos & Coberturas",
        "ingredientes": [
          { "nombre": "Fruta roja", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 400, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 250, "unidad": "ml" }
        ],
        "elaboracion": [
          "Hervir todos los ingredientes hasta densidad media.",
          "Triturar y colar por chino fino."
        ]
      },
      {
        "id": "VARIOS 215",
        "nombre": "Glassa Antihumedad",
        "categoria": "Decoraci√≥n & Acabados",
        "ingredientes": [
          { "nombre": "Az√∫car glass", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Clara de huevo deshidratada", "cantidad": 20, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 100, "unidad": "ml" }
        ],
        "elaboracion": [
          "Mezclar todos los ingredientes hasta homogeneidad.",
          "Dejar reposar 12 horas tapado.",
          "Ideal para decorar tartas sin que se humedezcan."
        ]
      },
      {
        "id": "VARIOS 223",
        "nombre": "Coulis de Manzana",
        "categoria": "Rellenos & Coberturas",
        "ingredientes": [
          { "nombre": "Manzanas", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 375, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 75, "unidad": "gr" },
          { "nombre": "Zumo de lim√≥n", "cantidad": 1, "unidad": "unidad" },
          { "nombre": "Vainilla", "cantidad": 0.25, "unidad": "vaina" }
        ],
        "elaboracion": [
          "Cocer manzanas con resto de ingredientes.",
          "Triturar, colar y ajustar espesor."
        ]
      },
      {
        "id": "VARIOS 224",
        "nombre": "Coulis de Kiwi",
        "categoria": "Rellenos & Coberturas",
        "ingredientes": [
          { "nombre": "Kiwi", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 100, "unidad": "ml" }
        ],
        "elaboracion": [
          "Pelar y triturar kiwi.",
          "A√±adir az√∫car y agua.",
          "Cocer ligeramente y colar."
        ]
      },
      {
        "id": "VARIOS 216",
        "nombre": "Ba√±o de Cobertura",
        "categoria": "Decoraci√≥n & Acabados",
        "ingredientes": [
          { "nombre": "Cobertura negra", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Mantequilla", "cantidad": 1000, "unidad": "gr" },
          { "nombre": "Glucosa", "cantidad": 2, "unidad": "cda" }
        ],
        "elaboracion": [
          "Derretir cobertura con mantequilla y glucosa.",
          "Usar como ba√±o para tartas y bombones."
        ]
      },
      // === DECORACI√ìN & ACABADOS ===
      {
        "id": "VARIOS 225",
        "nombre": "Merengue Italiano",
        "categoria": "Decoraci√≥n & Acabados",
        "ingredientes": [
          { "nombre": "Claras de huevo", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 50, "unidad": "ml" },
          { "nombre": "Az√∫car invertido", "cantidad": 10, "unidad": "gr" }
        ],
        "elaboracion": [
          "Calentar az√∫car, agua y az√∫car invertido hasta 118¬∞C.",
          "Verter sobre claras batidas a punto de nieve.",
          "Seguir batiendo hasta enfriar."
        ]
      },
      {
        "id": "VARIOS 226",
        "nombre": "Salsa de Fresa",
        "categoria": "Decoraci√≥n & Acabados",
        "ingredientes": [
          { "nombre": "Fresas", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Agua", "cantidad": 100, "unidad": "ml" },
          { "nombre": "Glucosa", "cantidad": 50, "unidad": "gr" },
          { "nombre": "Lim√≥n", "cantidad": 1, "unidad": "unidad" }
        ],
        "elaboracion": [
          "Cocer fresas con az√∫car, agua, glucosa y lim√≥n.",
          "Triturar y colar."
        ]
      },
      {
        "id": "VARIOS 227",
        "nombre": "Salsa de M√≥dena",
        "categoria": "Decoraci√≥n & Acabados",
        "ingredientes": [
          { "nombre": "Vinagre de m√≥dena", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 400, "unidad": "gr" },
          { "nombre": "Zumo de lim√≥n", "cantidad": 1, "unidad": "chorro" },
          { "nombre": "Agua", "cantidad": 1, "unidad": "chorro" }
        ],
        "elaboracion": [
          "Reducir vinagre. Hacer caramelo rubio con az√∫car.",
          "Mezclar ambas elaboraciones. Debe quedar meloso."
        ]
      },
      // === NUEVAS RECETAS ADICIONALES PARA COMPLETAR 73 ===
      {
        "id": "VARIOS 174",
        "nombre": "Trufa con Leche",
        "categoria": "Dulces & Confites",
        "ingredientes": [
          { "nombre": "Nata", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Cobertura blanca", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Leche condensada", "cantidad": 100, "unidad": "gr" }
        ],
        "elaboracion": [
          "Calentar nata, a√±adir cobertura blanca y leche condensada.",
          "Dejar enfriar, hacer bolas y rodar en cacao."
        ]
      },
      {
        "id": "VARIOS 197",
        "nombre": "Marquesas",
        "categoria": "Bizcochos, Magdalenas & Muffins",
        "ingredientes": [
          { "nombre": "Huevos", "cantidad": 6, "unidad": "unidades" },
          { "nombre": "Az√∫car", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Harina", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Mantequilla", "cantidad": 50, "unidad": "gr" }
        ],
        "elaboracion": [
          "Batir huevos con az√∫car hasta triplicar volumen.",
          "Incorporar harina y mantequilla derretida con cuidado.",
          "Hornear a 180¬∞C durante 25 minutos."
        ],
        "temperatura": 180,
        "tiempo": 25
      },
      {
        "id": "VARIOS 171",
        "nombre": "San Honore",
        "categoria": "Tartas Premium",
        "ingredientes": [
          { "nombre": "Pasta choux", "cantidad": 1, "unidad": "masa" },
          { "nombre": "Pasta sable", "cantidad": 1, "unidad": "masa" },
          { "nombre": "Crema San Honore", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Caramelo", "cantidad": 100, "unidad": "gr" }
        ],
        "elaboracion": [
          "Elaborar profiteroles con pasta choux.",
          "Montar base con pasta sable.",
          "Rellenar con crema, colocar profiteroles y abrillantar con caramelo."
        ]
      },
      {
        "id": "VARIOS 122",
        "nombre": "Tarta de Frambuesas",
        "categoria": "Tartas del Ayer",
        "ingredientes": [
          { "nombre": "Base de galleta", "cantidad": 1, "unidad": "unidad" },
          { "nombre": "Crema pastelera", "cantidad": 300, "unidad": "gr" },
          { "nombre": "Frambuesas", "cantidad": 400, "unidad": "gr" },
          { "nombre": "Gelatina de frambuesa", "cantidad": 1, "unidad": "sobre" }
        ],
        "elaboracion": [
          "Rellenar base con crema pastelera.",
          "Colocar frambuesas encima.",
          "Abrillantar con gelatina."
        ]
      },
      {
        "id": "VARIOS 129",
        "nombre": "Tarta de Queso (2¬™ Forma)",
        "categoria": "Tartas del Ayer",
        "ingredientes": [
          { "nombre": "Queso crema", "cantidad": 500, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 150, "unidad": "gr" },
          { "nombre": "Huevos", "cantidad": 4, "unidad": "unidades" },
          { "nombre": "Galletas", "cantidad": 200, "unidad": "gr" },
          { "nombre": "Mantequilla", "cantidad": 100, "unidad": "gr" },
          { "nombre": "Coulis de fruta", "cantidad": 200, "unidad": "gr" }
        ],
        "elaboracion": [
          "Base con galletas y mantequilla.",
          "Mezclar queso, az√∫car y huevos.",
          "Verter sobre base y hornear al ba√±o Mar√≠a.",
          "Desmoldar y cubrir con coulis."
        ],
        "temperatura": 160,
        "tiempo": 50
      },
      {
        "id": "VARIOS 46",
        "nombre": "Nata Montada",
        "categoria": "Rellenos & Coberturas",
        "ingredientes": [
          { "nombre": "Nata l√≠quida", "cantidad": 1000, "unidad": "ml" },
          { "nombre": "Az√∫car", "cantidad": 125, "unidad": "gr" }
        ],
        "elaboracion": [
          "Batir nata fr√≠a con az√∫car hasta punto firme."
        ]
      },
      {
        "id": "VARIOS 45",
        "nombre": "Merengue R√°pido",
        "categoria": "Decoraci√≥n & Acabados",
        "ingredientes": [
          { "nombre": "Claritas", "cantidad": 400, "unidad": "gr" },
          { "nombre": "Az√∫car", "cantidad": 600, "unidad": "gr" }
        ],
        "elaboracion": [
          "Mezclar y calentar al ba√±o Mar√≠a hasta disolver az√∫car.",
          "Batir hasta enfriar y tener cuerpo firme."
        ]
      }
    ];




const STORAGE = { NOTES:'dp_notes_v3', FAVS:'dp_favs_v3', TIMERS:'dp_timers_v3', LAST:'dp_last_v3' };
let notes = JSON.parse(localStorage.getItem(STORAGE.NOTES) || '{}');
let favs = JSON.parse(localStorage.getItem(STORAGE.FAVS) || '[]');
let timers = JSON.parse(localStorage.getItem(STORAGE.TIMERS) || '[]'); // array of {id, recipeId, label, remaining, running, endAt}
let timerTicker = null;

const qs = sel => document.querySelector(sel);
const $ = id => document.getElementById(id);

function normalize(s){ return String(s||'').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,''); }
function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
function saveNotes(){ localStorage.setItem(STORAGE.NOTES, JSON.stringify(notes)); }
function saveFavs(){ localStorage.setItem(STORAGE.FAVS, JSON.stringify(favs)); }
function saveTimers(){ localStorage.setItem(STORAGE.TIMERS, JSON.stringify(timers)); }

/* Router */
const routes = {
  '': ()=> showMain(),
  '#main': ()=> showMain(),
  '#menu': ()=> showMenu(),
  '#smart': ()=> showSmart(),
  '#categories': ()=> showCategories(),
  '#stars': ()=> showStars(),
  '#notes': ()=> showNotesAgg(),
  '#last': ()=> showLast(),
};
function route(){
  const h = location.hash || '#main';
  // route with param support: #recipe:id   or #receta:id
  if(h.startsWith('#recipe:') || h.startsWith('#receta:')){
    const id = h.split(':')[1];
    renderRecipeView({ id });
    return;
  }
  // note editor: #note:id
  if(h.startsWith('#note:')){
    const id = h.split(':')[1];
    renderNoteEditor({ id });
    return;
  }
  // list by category: #list:category
  if(h.startsWith('#list:')){
    const cat = decodeURIComponent(h.split(':')[1]||'');
    renderListView({ title: cat, list: recetas.filter(r=> normalize(r.categoria) === normalize(cat) ) });
    return;
  }
  // generic routes
  if(routes[h]) routes[h]();
  else showMain();
}
window.addEventListener('hashchange', route);

/* Views helpers */
function hideAllViews(){ document.querySelectorAll('.view').forEach(v => v.classList.remove('active')); }
function showMain(){ hideAllViews(); $('view-main').classList.add('active'); $('searchInput').value = ''; }
function showMenu(){ hideAllViews(); $('view-menu').classList.add('active'); }
function showSmart(){ hideAllViews(); $('view-smart').classList.add('active'); }
function showCategories(){ // build category list then route to #list:category when clicked
  const categories = [...new Set(recetas.map(r => r.categoria || 'Sin categor√≠a'))].sort();
  renderListView({ title: 'Categor√≠as', list: categories.map(c=>({name:c})) , isCategoryList:true});
  location.hash = '#categories';
}
function showStars(){ const list = recetas.filter(r=> favs.includes(r.id)); renderListView({ title:'Recetas estrella', list }); location.hash = '#stars'; }
function showNotesAgg(){ renderNotesAggregated(); location.hash = '#notes'; }
function showLast(){ const last = localStorage.getItem(STORAGE.LAST); if(last) location.hash = '#recipe:'+last; else alert('No hay √∫ltima receta'); }

/* attach header buttons */
document.addEventListener('click', (ev)=>{
  const btn = ev.target.closest('[data-href]');
  if(btn){ ev.preventDefault(); location.hash = btn.getAttribute('data-href'); return; }
  const back = ev.target.closest('.back');
  if(back && back.getAttribute('data-href')){ ev.preventDefault(); location.hash = back.getAttribute('data-href'); return; }
});

/* Search */
$('searchInput').addEventListener('keydown', (e)=>{ if(e.key === 'Enter'){ const q = $('searchInput').value.trim(); if(q) performSearch(q); }});
$('searchInput').addEventListener('input', (e)=>{ const q = e.target.value.trim(); if(!q) return; const matches = recetas.filter(r => normalize(r.nombre).includes(normalize(q)) || normalize(r.categoria||'').includes(normalize(q)) || (r.ingredientes && r.ingredientes.some(i=> normalize(i.nombre).includes(normalize(q))))); if(matches.length) showSearchModal(matches); });

/* Search modal */
function showSearchModal(list){
  const root = $('overlayRoot'); root.innerHTML=''; root.style.display='block';
  const ov = document.createElement('div'); ov.className='overlay';
  const md = document.createElement('div'); md.className='modal';
  md.innerHTML = `<h3 style="margin:0 0 8px 0;">Resultados</h3><div id="modalResults" style="display:flex;flex-direction:column;gap:8px;max-height:50vh;overflow:auto"></div><div style="text-align:center;margin-top:12px;"><button class="btn" id="closeModalBtn">Cerrar</button></div>`;
  ov.appendChild(md); root.appendChild(ov);
  const container = md.querySelector('#modalResults');
  container.innerHTML = list.map(r => {
    return `<div class="card"><div style="display:flex;justify-content:space-between;align-items:center"><div><div class="name">${escapeHtml(r.nombre)}</div><div class="muted">${escapeHtml(r.categoria||'')}</div></div><div><button class="btn" data-open="${escapeHtml(r.id)}">Abrir</button></div></div></div>`;
  }).join('');
  md.querySelectorAll('[data-open]').forEach(b => b.addEventListener('click', (ev)=>{ const id = ev.currentTarget.getAttribute('data-open'); closeOverlay(); location.hash = '#recipe:'+id; }));
  md.querySelector('#closeModalBtn').addEventListener('click', closeOverlay);
  ov.addEventListener('click', (ev)=>{ if(ev.target === ov) closeOverlay(); });
}
function closeOverlay(){ $('overlayRoot').innerHTML=''; $('overlayRoot').style.display='none'; }

/* Smart filters (accept uppercase/lowercase) */
$('filterTimeBtn').addEventListener('click', ()=>{
  const raw = prompt('Elige franja: A (1-20), B (21-40), C (41+)\nEscribe A, B o C:') || '';
  const c = raw.trim().toLowerCase();
  if(!['a','b','c'].includes(c)){ alert('Opci√≥n no v√°lida'); return; }
  const list = recetas.filter(r => {
    const m = recipeMaxMinutes(r);
    if(c==='a') return m <=20;
    if(c==='b') return m >=21 && m <=40;
    return m >=41;
  });
  renderListView({ title: `Franja ${c.toUpperCase()}`, list }); location.hash = '#list';
});
$('filterDifficultyBtn').addEventListener('click', ()=>{
  const raw = prompt('¬ø A que nivel de dificultad te atreves, Facil, Medio o Dificil ?\nElige: F, M, D:') || '';
  const c = raw.trim().toLowerCase();
  if(!['f','m','d'].includes(c)){ alert('Opci√≥n no v√°lida'); return; }
  const list = recetas.filter(r => {
    const m = recipeMaxMinutes(r);
    if(c==='f') return m === 0 || m <=20;
    if(c==='m') return m >=21 && m <=30;
    return m > 30;
  });
  renderListView({ title: `Nivel ${c.toUpperCase()}`, list }); location.hash = '#list';
});
$('filterIngredientBtn').addEventListener('click', ()=>{
  const raw = prompt('¬øQu√© ingrediente? Escribe su nombre:') || '';
  const q = raw.trim();
  if(!q) return;
  const list = recetas.filter(r => r.ingredientes && r.ingredientes.some(i=> normalize(i.nombre).includes(normalize(q))));
  renderListView({ title: `Ingrediente: ${q}`, list }); location.hash = '#list';
});

/* Render list view (recipes or categories) */
function renderListView(data){
  hideAllViews();
  $('view-list').classList.add('active');
  const container = $('listContent');
  const title = data?.title || 'Listado';
  $('listTitle').textContent = title;
  container.innerHTML = '';
  if(!data || !data.list) { container.innerHTML = '<div class="empty">No hay elementos.</div>'; return; }
  // if category list (string entries)
  if(data.isCategoryList){
    container.innerHTML = data.list.map(c => `<div class="card"><div style="display:flex;justify-content:space-between;align-items:center"><div class="name">${escapeHtml(c.name)}</div><div><button class="btn" data-cat="${escapeHtml(c.name)}">Abrir</button></div></div></div>`).join('');
    container.querySelectorAll('[data-cat]').forEach(b => b.addEventListener('click', e => { const cat = e.currentTarget.getAttribute('data-cat'); const list = recetas.filter(r=> (r.categoria||'').trim() === cat); renderListView({ title: cat, list }); }));
    return;
  }
  const list = data.list;
  if(!list.length){ container.innerHTML = '<div class="empty">No hay resultados.</div>'; return; }
  container.innerHTML = list.map(r => `<div class="card"><div style="display:flex;justify-content:space-between;align-items:center"><div><div class="name">${escapeHtml(r.nombre)}</div><div class="muted">${escapeHtml(r.categoria||'')}</div></div><div style="display:flex;gap:8px;align-items:center"><button class="btn" data-open="${escapeHtml(r.id)}">Abrir</button><button class="btn" data-fav="${escapeHtml(r.id)}">${favs.includes(r.id)?'‚òÖ':'‚òÜ'}</button></div></div></div>`).join('');
  container.querySelectorAll('[data-open]').forEach(b => b.addEventListener('click', e => { const id = e.currentTarget.getAttribute('data-open'); location.hash = '#recipe:'+id; }));
  container.querySelectorAll('[data-fav]').forEach(b => b.addEventListener('click', e => { const id = e.currentTarget.getAttribute('data-fav'); toggleFav(id); e.currentTarget.textContent = favs.includes(id)?'‚òÖ':'‚òÜ'; }));
}

/* Recipe rendering */
function renderRecipeView(data){
  hideAllViews();
  $('view-recipe').classList.add('active');
  const id = data?.id;
  const recipe = recetas.find(r=> r.id === id);
  if(!recipe){ $('recipeTitle').textContent = 'Receta no encontrada'; $('recipeContainer').innerHTML = '<div class="empty">Receta no encontrada</div>'; return; }
  localStorage.setItem(STORAGE.LAST, id);
  $('recipeTitle').textContent = recipe.nombre;
  $('recipeMeta').textContent = `${recipe.categoria || ''}${recipe.porciones ? ' ¬∑ ' + recipe.porciones + ' porciones' : ''}`;
  // ingredients
  const ing = (recipe.ingredientes || []).map(i=>`<li>${escapeHtml(i.nombre)}${i.cantidad? ' <strong>(' + escapeHtml(String(i.cantidad)) + (i.unidad? ' ' + escapeHtml(i.unidad):'') + ')</strong>':''}</li>`).join('');
  $('ingredientsSection').innerHTML = `<b>Ingredientes:</b><ul>${ing}</ul>`;
  const el = (recipe.elaboracion || []).map(s=>`<li>${escapeHtml(s)}</li>`).join('');
  $('elaboracionSection').innerHTML = `<b>Elaboraci√≥n:</b><ol>${el}</ol>`;
  // detected timers
  const detected = detectTimersFromElaboracion(recipe);
  const detCont = $('detectedTimersContainer'); detCont.innerHTML = '';
  if(detected.length){
    detCont.innerHTML = `<div class="muted"><strong>Temporizadores sugeridos:</strong></div>` + detected.map((d,idx)=>`<div style="display:flex;align-items:center;gap:8px;margin:8px 0"><div style="flex:1">${escapeHtml(d.label)} ‚Äî ${d.minutes} min</div><div><button class="small-btn" data-add="${recipe.id}#${idx}">A√±adir</button></div></div>`).join('');
    detCont.querySelectorAll('[data-add]').forEach(b=> b.addEventListener('click', ev=>{ const val = ev.currentTarget.getAttribute('data-add'); const [rid, idx] = val.split('#'); const d = detected[Number(idx)]; addTimer(rid, `${recipe.nombre} (${d.minutes}m)`, d.minutes, true); showToast('Temporizador a√±adido: ' + d.minutes + ' min'); }));
  }
  // custom timer select
  const sel = $('customTimerSelect'); sel.innerHTML=''; for(let i=1;i<=90;i++){ const o = document.createElement('option'); o.value=i; o.textContent = `${i} min`; sel.appendChild(o); }
  $('customTimerAdd').onclick = ()=> { const mins = parseInt(sel.value,10) || 1; addTimer(recipe.id, `${recipe.nombre} (${mins}m)`, mins, true); showToast('Temporizador a√±adido: ' + mins + ' min'); };
  // share and notes
  $('shareRecipeBtn').onclick = ()=> shareRecipeFormatted(recipe);
  $('notesRecipeBtn').onclick = ()=> { location.hash = '#note:'+recipe.id; };
}

/* Notes */
function renderNoteEditor(data){
  hideAllViews(); $('view-note').classList.add('active');
  const id = data?.id; const rec = recetas.find(r=>r.id===id);
  $('noteTitle').textContent = rec? rec.nombre : (id || 'Nota');
  $('noteText').value = notes[id] || '';
  $('saveNoteBtn').onclick = ()=> { notes[id] = $('noteText').value || ''; saveNotes(); showToast('Nota guardada'); };
  $('shareNoteBtn').onclick = ()=> { const txt = `Nota - ${rec?.nombre || id}\n\n${notes[id] || ''}`; shareText(txt); };
}
function renderNotesAggregated(){
  hideAllViews(); $('view-notes').classList.add('active');
  const container = $('notesContainer'); const entries = Object.entries(notes||{});
  if(!entries.length){ container.innerHTML = '<div class="empty">No hay notas guardadas.</div>'; return; }
  container.innerHTML = entries.map(([rid, txt])=>{ const rec = recetas.find(r=>r.id===rid); return `<div class="card"><div style="display:flex;justify-content:space-between;align-items:flex-start"><div><div class="name">${escapeHtml(rec?.nombre || rid)}</div><div class="muted">${escapeHtml(rec?.categoria || '')}</div><div style="margin-top:8px;">${escapeHtml(txt).replace(/\n/g,'<br>')}</div></div><div style="display:flex;flex-direction:column;gap:8px"><button class="btn" data-open="${escapeHtml(rid)}">Abrir</button><button class="btn" data-share="${escapeHtml(rid)}">Compartir</button></div></div></div>`; }).join('');
  container.querySelectorAll('[data-open]').forEach(b=> b.addEventListener('click', e=> { const id = e.currentTarget.getAttribute('data-open'); location.hash = '#recipe:'+id; }));
  container.querySelectorAll('[data-share]').forEach(b=> b.addEventListener('click', e=> { const id = e.currentTarget.getAttribute('data-share'); const rec = recetas.find(r=>r.id===id); const txt = `Notas - ${rec?.nombre || id}\n\n${notes[id] || ''}`; shareText(txt); }));
}

/* Favorites */
function toggleFav(id){ if(favs.includes(id)) favs = favs.filter(x=>x!==id); else favs.push(id); saveFavs(); }

/* Timers */
function addTimer(recipeId, label, minutes, autoStart){
  const id = 't' + Date.now() + Math.floor(Math.random()*9999);
  const sec = Math.max(1, Math.floor(minutes*60));
  const t = { id, recipeId, label: String(label), remaining: sec, running: !!autoStart, endAt: autoStart ? Date.now() + sec*1000 : null, createdAt: Date.now() };
  timers.push(t); saveTimers(); renderTimerBar();
}
function startTimer(id){ const t = timers.find(x=>x.id===id); if(!t) return; if(!t.running){ t.endAt = Date.now() + (t.remaining||0)*1000; t.running = true; saveTimers(); renderTimerBar(); } }
function pauseTimer(id){ const t = timers.find(x=>x.id===id); if(!t) return; if(t.running){ t.remaining = Math.max(0, Math.ceil((t.endAt - Date.now())/1000)); t.endAt = null; t.running = false; saveTimers(); renderTimerBar(); } }
function removeTimer(id){ timers = timers.filter(x=>x.id!==id); saveTimers(); renderTimerBar(); }
function tickTimers(){ const now = Date.now(); let changed=false; timers.forEach(t=>{ if(t.running && t.endAt){ const rem = Math.ceil((t.endAt - now)/1000); if(rem <= 0){ t.running=false; t.remaining=0; t.endAt=null; changed=true; showToast('Temporizador terminado: '+t.label); try{ navigator.vibrate && navigator.vibrate(300); }catch(e){} } } }); if(changed) saveTimers(); renderTimerBar(); }
function renderTimerBar(){ const bar = $('timerBar'); if(!timers.length){ bar.style.display='none'; bar.innerHTML=''; return; } bar.style.display='flex'; const now = Date.now(); bar.innerHTML = timers.map(t=>{ const remaining = t.running && t.endAt ? Math.max(0, Math.ceil((t.endAt - now)/1000)) : (t.remaining||0); const mm = Math.floor(remaining/60); const ss = remaining%60; return `<div class="timer-pill" title="${escapeHtml(t.label)}"><div style="font-weight:900">${escapeHtml(t.label)}</div><div style="opacity:0.9">${mm}:${String(ss).padStart(2,'0')}</div><div class="timer-controls">${t.running?`<button data-pause="${t.id}">Pausar</button>`:`<button data-start="${t.id}">Iniciar</button>`}<button data-remove="${t.id}">Eliminar</button></div></div>`; }).join('');
  bar.querySelectorAll('[data-start]').forEach(b=> b.onclick = (ev)=> startTimer(ev.currentTarget.getAttribute('data-start')) );
  bar.querySelectorAll('[data-pause]').forEach(b=> b.onclick = (ev)=> pauseTimer(ev.currentTarget.getAttribute('data-pause')) );
  bar.querySelectorAll('[data-remove]').forEach(b=> b.onclick = (ev)=> removeTimer(ev.currentTarget.getAttribute('data-remove')) );
}
if(!timerTicker) timerTicker = setInterval(()=>{ tickTimers(); }, 800);

/* Parser for durations */
function detectTimersFromElaboracion(recipe){
  const steps = recipe.elaboracion || []; const found = [];
  const rxMin = /(\d{1,3})\s*(?:min(?:uto)?s?|m\b)/i;
  const rxHour = /(\d{1,2})\s*(?:h(?:ora)?s?)/i;
  for(const s of steps){
    let minutes = 0;
    const hm = s.match(rxHour); const mm = s.match(rxMin);
    if(hm && !mm){ minutes = parseInt(hm[1],10)*60; } else if(mm){ minutes = parseInt(mm[1],10); if(hm) minutes += parseInt(hm[1],10)*60; } else continue;
    const label = s.length>80 ? (s.slice(0,80) + '...') : s;
    if(!found.some(f=> Math.abs(f.minutes-minutes)<1 && f.label===label)) found.push({ label, minutes });
  }
  return found;
}
function recipeMaxMinutes(r){ if(r.tiempo) return Number(r.tiempo)||0; const d = detectTimersFromElaboracion(r); if(!d.length) return 0; return Math.max(...d.map(x=>x.minutes)); }

/* Sharing */
function shareRecipeFormatted(recipe){
  const header = `${recipe.nombre}\n\n`; const ing = (recipe.ingredientes||[]).map(i=>`- ${i.nombre}${i.cantidad? ' ('+i.cantidad+(i.unidad? ' '+i.unidad:'')+')':''}`).join('\n'); const el = (recipe.elaboracion||[]).map((s,i)=>`${i+1}. ${s}`).join('\n\n'); const txt = `${header}Ingredientes:\n${ing}\n\nElaboraci√≥n:\n${el}`;
  if(navigator.share) navigator.share({ title: recipe.nombre, text: txt }).catch(()=> showShareFallback(txt)); else showShareFallback(txt);
}
function shareText(text){ if(navigator.share) navigator.share({ text }).catch(()=> showShareFallback(text)); else showShareFallback(text); }
function showShareFallback(text){
  const root = $('overlayRoot'); root.innerHTML=''; root.style.display='block';
  const ov = document.createElement('div'); ov.className='overlay'; const md = document.createElement('div'); md.className='modal';
  md.innerHTML = `<h3>Compartir</h3><div style="max-height:40vh;overflow:auto;padding:8px;border-radius:8px;background:rgba(0,0,0,0.15);margin-top:8px">${escapeHtml(text).replace(/\n/g,'<br>')}</div><div class="share-row"><button id="wa" class="small-btn">WhatsApp</button><button id="tg" class="small-btn">Telegram</button><button id="mail" class="small-btn">Email</button><button id="sms" class="small-btn">SMS</button><button id="copy" class="small-btn">Copiar</button></div><div style="text-align:center;margin-top:12px;"><button class="btn" id="closeShare">Cerrar</button></div>`;
  ov.appendChild(md); root.appendChild(ov);
  md.querySelector('#wa').onclick = ()=> window.open('https://wa.me/?text=' + encodeURIComponent(text), '_blank');
  md.querySelector('#tg').onclick = ()=> window.open('https://t.me/share/url?text=' + encodeURIComponent(text), '_blank');
  md.querySelector('#mail').onclick = ()=> window.open('mailto:?subject=' + encodeURIComponent('Receta') + '&body=' + encodeURIComponent(text), '_self');
  md.querySelector('#sms').onclick = ()=> window.open('sms:?body=' + encodeURIComponent(text), '_self');
  md.querySelector('#copy').onclick = ()=> { navigator.clipboard.writeText(text).then(()=> alert('Copiado al portapapeles')); };
  md.querySelector('#closeShare').onclick = closeOverlay;
  ov.addEventListener('click',(e)=>{ if(e.target===ov) closeOverlay(); });
}

/* Utilities */
function showToast(msg, time=2200){ const existing = document.getElementById('dp_toast'); if(existing) existing.remove(); const t=document.createElement('div'); t.id='dp_toast'; t.style.position='fixed'; t.style.bottom='90px'; t.style.left='50%'; t.style.transform='translateX(-50%)'; t.style.background='rgba(0,0,0,0.75)'; t.style.color='white'; t.style.padding='10px 14px'; t.style.borderRadius='10px'; t.style.zIndex='14000'; t.textContent=msg; document.body.appendChild(t); setTimeout(()=> t.remove(), time); }

/* Init */
function init(){
  // wire back links in header already handled by click delegate
  // wire some static buttons
  document.getElementById('menu_cat').addEventListener('click', ()=> { showCategories(); location.hash = '#categories'; });
  document.getElementById('menu_star').addEventListener('click', ()=> { showStars(); });
  document.getElementById('menu_last').addEventListener('click', ()=> { showLast(); });
  document.getElementById('btnEstrella').addEventListener('click', ()=> { showStars(); location.hash = '#stars'; });
  document.getElementById('btnNotas').addEventListener('click', ()=> { showNotesAgg(); location.hash = '#notes'; });
  document.getElementById('btnSmart').addEventListener('click', ()=> { location.hash = '#smart'; });
  document.getElementById('btnMenuView').addEventListener('click', ()=> { location.hash = '#menu'; });

  route();
  renderTimerBar();
  setInterval(()=> tickTimers(), 800);
}
document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
